# å®Ÿè£…è¨ˆç”»: Local Yielding Research Aide (Lyra)

## 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½ç½®ã¥ã‘

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Lyraãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**å®Ÿè£…è¨ˆç”»æ›¸**ã§ã‚ã‚‹ã€‚

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | å½¹å‰² | å‚ç…§ |
|-------------|------|------|
| `docs/REQUIREMENTS.md` | ä»•æ§˜æ›¸ï¼ˆè¦ä»¶å®šç¾©ï¼‰ | Â§1-8ã§æ©Ÿèƒ½ãƒ»éæ©Ÿèƒ½è¦ä»¶ã‚’å®šç¾© |
| `docs/PUBLICATION_PLAN.md` | è«–æ–‡åŸ·ç­†æº–å‚™ãƒ¡ãƒ¢ | SoftwareXæŠ•ç¨¿ã€ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£è¨­è¨ˆ |
| **`docs/IMPLEMENTATION_PLAN.md`**ï¼ˆæœ¬æ–‡æ›¸ï¼‰ | **å®Ÿè£…è¨ˆç”»æ›¸** | Phaseåˆ¥ã®å®Ÿè£…çŠ¶æ³ãƒ»çŸ¥è¦‹ã‚’ç®¡ç† |

**ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦**: ä¿¡é ¼æ€§ãŒé«˜ã„ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒªã‚µãƒ¼ãƒã‚’Cursor AIã¨å”èª¿ã—ã¦å®Ÿè¡Œã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€‚**Podmanã‚³ãƒ³ãƒ†ãƒŠç’°å¢ƒ**ã§ç¨¼åƒã—ã€MCPã‚’é€šã˜ã¦Cursorã¨é€£æºã™ã‚‹ã€‚

---

## 2. å®Ÿè£…å®Œæˆåº¦ã‚µãƒãƒªï¼ˆ2025-12-15 æ›´æ–°ï¼‰

| Phase | å†…å®¹ | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | E2Eæ¤œè¨¼ | çŠ¶æ…‹ | ã‚»ã‚¯ã‚·ãƒ§ãƒ³ |
|-------|------|:-------------:|:-------:|:----:|:----------:|
| A-H | åŸºç›¤ã€œæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å¤šæ§˜åŒ– | âœ… | âœ… | å®Œäº† | Â§4 |
| I | ä¿å®ˆæ€§æ”¹å–„ | âœ… | - | å®Œäº† | Â§5 |
| K.3 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆL1-L8ï¼‰ | âœ… | âœ… | å®Œäº† | Â§5 |
| M | MCPãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° | âœ… | âœ… | å®Œäº† | Â§6 |
| N | E2Eã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ | - | â³ | é€²è¡Œä¸­ï¼ˆN.2-5å®Œäº†ï¼‰ | Â§6 |
| **O** | **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆãƒªãƒ•ã‚¡ã‚¯ã‚¿** | âœ… | âœ… | **å®Œäº†ï¼ˆO.2-O.8ï¼‰** | Â§6 |
| **P** | **ãƒˆãƒ©ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«ãƒ»ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•è¨­è¨ˆå¤‰æ›´** | - | - | â³ | Â§6 |

**ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆæ•°**: 3228ä»¶ï¼ˆå…¨ãƒ‘ã‚¹ã€Phase 2ã§ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼‰

---

## 3. Phaseæ§‹æˆã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### 3.1 Phaseä¸€è¦§

| ã‚«ãƒ†ã‚´ãƒª | Phase | å†…å®¹ | çŠ¶æ…‹ | ã‚»ã‚¯ã‚·ãƒ§ãƒ³ |
|---------|-------|------|:----:|:----------:|
| **ã‚³ã‚¢å®Ÿè£…** | A | åŸºç›¤æ§‹ç¯‰ | âœ… | Â§4 |
| | B | å“è³ªå¼·åŒ– | âœ… | Â§4 |
| | C | æ¤œç´¢çµŒè·¯å†è¨­è¨ˆ | âœ… | Â§4 |
| | D | æŠ—å …æ€§ãƒ»ã‚¹ãƒ†ãƒ«ã‚¹æ€§å¼·åŒ– | âœ… | Â§4 |
| | E | å­¦è¡“æƒ…å ±å“è³ªå¼·åŒ– | âœ… | Â§4 |
| | F | è¿½åŠ æ©Ÿèƒ½ | âœ… | Â§4 |
| | G | ãƒ†ã‚¹ãƒˆåŸºç›¤ | âœ… | Â§4 |
| | H | æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å¤šæ§˜åŒ– | âœ… | Â§4 |
| **ä¿å®ˆãƒ»æ‹¡å¼µ** | I | ä¿å®ˆæ€§æ”¹å–„ | âœ… | Â§5 |
| | J | å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹çµ±åˆ | â³ | Â§5 |
| | K | ãƒ­ãƒ¼ã‚«ãƒ«LLMå¼·åŒ– | âœ… | Â§5 |
| **æ¤œè¨¼ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿** | L | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | â³ | Â§6 |
| | M | MCPãƒ„ãƒ¼ãƒ«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° | âœ… | Â§6 |
| | N | E2Eã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ | â³ | Â§6 |
| | **O** | **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆãƒªãƒ•ã‚¡ã‚¯ã‚¿** | âœ… | Â§6 |
| | **P** | **ãƒˆãƒ©ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«ãƒ»ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•è¨­è¨ˆå¤‰æ›´** | â³ | Â§6 |

### 3.2 å„ªå…ˆåº¦

#### MVPå¿…é ˆï¼ˆåˆæœŸãƒªãƒªãƒ¼ã‚¹ï¼‰
- Phase A-H: åŸºç›¤ã€œæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å¤šæ§˜åŒ– âœ…
- Phase I: ä¿å®ˆæ€§æ”¹å–„ âœ…
- Phase K: ãƒ­ãƒ¼ã‚«ãƒ«LLMé–¢é€£å®Ÿè£…å¼·åŒ– âœ…
- Phase M: MCPãƒ„ãƒ¼ãƒ«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° âœ…
- **Phase P: ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚·ã‚¹ãƒ†ãƒ åˆ·æ–°ï¼ˆå¼•ç”¨è¿½è·¡ãƒ»ä¿¡é ¼åº¦ãƒ¢ãƒ‡ãƒ«ï¼‰â³**
- **Phase N: E2Eã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼ˆè«–æ–‡æŠ•ç¨¿å‘ã‘ï¼‰â³**

#### Phase 2ï¼ˆè«–æ–‡æŠ•ç¨¿å¾Œï¼‰
- Phase J.1, J.3-J.5: æ—¥æœ¬æ”¿åºœAPI/ç‰¹è¨±/é˜²è¡›æƒ…å ±
- Phase L: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

#### å°†æ¥ã®æ‹¡å¼µ
- ã‚¯ã‚¨ãƒªA/Bãƒ†ã‚¹ãƒˆï¼ˆÂ§3.1.1ã‹ã‚‰å‰Šé™¤æ¸ˆã¿ï¼‰
- å¤‰æ›´æ¤œçŸ¥/å·®åˆ†ã‚¢ãƒ©ãƒ¼ãƒˆ
- IPv6/HTTP3ã®é«˜åº¦ãªå­¦ç¿’

---

## 4. ã‚³ã‚¢å®Ÿè£… (Phase A-H)

### Phase A: åŸºç›¤æ§‹ç¯‰ âœ…

#### A.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤ âœ…

| é …ç›® | æˆæœç‰© | ä»•æ§˜å‚ç…§ |
|------|--------|----------|
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€  | `src/`, `config/`, `tests/` ç­‰ | - |
| ä¾å­˜é–¢ä¿‚ | `requirements.txt`, `pyproject.toml`, Dockerfile | - |
| è¨­å®šç®¡ç† | `config/settings.yaml`, `config/engines.yaml`, `config/domains.yaml` | - |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | SQLiteã‚¹ã‚­ãƒ¼ãƒ (`src/storage/schema.sql`)ã€FTS5å…¨æ–‡æ¤œç´¢ | Â§5.1.2 |
| ãƒ­ã‚®ãƒ³ã‚° | æ§‹é€ åŒ–ãƒ­ã‚° (structlog)ã€å› æœãƒˆãƒ¬ãƒ¼ã‚¹ (cause_id) | Â§4.6 |

#### A.2 MCPã‚µãƒ¼ãƒãƒ¼ âœ…

**MCPãƒ„ãƒ¼ãƒ«ï¼ˆ11ãƒ„ãƒ¼ãƒ«ï¼‰**: Phase Mã§30å€‹â†’11å€‹ã«ç°¡ç´ åŒ–å®Œäº†

| ã‚«ãƒ†ã‚´ãƒª | ãƒ„ãƒ¼ãƒ« |
|---------|--------|
| ã‚¿ã‚¹ã‚¯ç®¡ç† | `create_task`, `get_status` |
| èª¿æŸ»å®Ÿè¡Œ | `search`, `stop_task` |
| æˆæœç‰© | `get_materials` |
| æ ¡æ­£ | `calibrate`, `calibrate_rollback` |
| èªè¨¼ã‚­ãƒ¥ãƒ¼ | `get_auth_queue`, `resolve_auth` |
| é€šçŸ¥ | `notify_user`, `wait_for_user` |

è©³ç´°ã¯ Phase M å‚ç…§ã€‚

#### A.3 æ¤œç´¢æ©Ÿèƒ½ âœ…

**å½“åˆè¨­è¨ˆï¼ˆSearXNGçµŒç”±ï¼‰â†’ å»ƒæ­¢**: è©³ç´°ã¯ã€ŒPhase C.1 æ¤œç´¢çµŒè·¯ã®å†è¨­è¨ˆã€å‚ç…§

**ç¾åœ¨ã®å®Ÿè£…ï¼ˆBrowserSearchProviderï¼‰**:
- Playwright CDPæ¥ç¶šã«ã‚ˆã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ç›´æ¥æ¤œç´¢
- å¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³: DuckDuckGo, Mojeek, Qwant, Brave, Google, Ecosia, Startpage
- CAPTCHAæ¤œçŸ¥â†’èªè¨¼ã‚­ãƒ¥ãƒ¼é€£æº

#### A.4 ã‚¯ãƒ­ãƒ¼ãƒªãƒ³ã‚°/å–å¾— âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | curl_cffi (impersonate=chrome) | Â§4.3 |
| ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ– | Playwright CDPæ¥ç¶š | Â§3.2 |
| ãƒ˜ãƒƒãƒ‰ãƒ•ãƒ«åˆ‡æ›¿ | è‡ªå‹•ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | Â§4.3 |
| Torãƒ—ãƒ­ã‚­ã‚· | Stemé€£æºã€Circuitæ›´æ–° | Â§4.3 |
| ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ä¿å­˜ | WARC (warcio)ã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ | Â§4.3.2 |

#### A.5 ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æŠ½å‡º âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| HTMLæŠ½å‡º | trafilatura | Â§5.1 |
| PDFæŠ½å‡º | PyMuPDF | Â§5.1.1 |
| OCR | PaddleOCR + Tesseract | Â§5.1.1 |
| é‡è¤‡æ¤œå‡º | MinHash + SimHash | Â§3.3.1 |

#### A.6 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°/è©•ä¾¡ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| BM25ãƒ©ãƒ³ã‚­ãƒ³ã‚° | rank-bm25 | Â§3.3 |
| åŸ‹ã‚è¾¼ã¿ | bge-m3 (ONNX/FP16) | Â§5.1 |
| ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚° | bge-reranker-v2-m3 | Â§5.1 |
| LLMæŠ½å‡º | Ollama (Qwen2.5-3B/7B) | Â§5.1 |
| NLIåˆ¤å®š | tiny-DeBERTa | Â§3.3.1 |
| ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ• | NetworkX + SQLite | Â§3.3.1 |

#### A.7 ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ© âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼ | å„ªå…ˆåº¦ç®¡ç†ã€ã‚¹ãƒ­ãƒƒãƒˆåˆ¶å¾¡ | Â§3.2.2 |
| æ’ä»–åˆ¶å¾¡ | gpu/browser_headfulæ’ä»– | Â§3.2.2 |
| äºˆç®—åˆ¶å¾¡ | ãƒšãƒ¼ã‚¸æ•°/æ™‚é–“ä¸Šé™ | Â§3.1 |

**æ—¢å®šå€¤ï¼ˆÂ§3.2.2ï¼‰**:
- `network_client`: åŒæ™‚å®Ÿè¡Œ=4ã€ãƒ‰ãƒ¡ã‚¤ãƒ³åŒæ™‚å®Ÿè¡Œ=1
- å„ªå…ˆåº¦: serp(100) > prefetch(90) > extract(80) > embed(70) > rerank(60) > llm_fast(50) > llm_slow(40)
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: æ¤œç´¢30ç§’ã€å–å¾—60ç§’ã€LLMæŠ½å‡º120ç§’

#### A.8 é€šçŸ¥/æ‰‹å‹•ä»‹å…¥ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| é€šçŸ¥ | Windows Toast / Linux notify-send | Â§3.6 |
| èªè¨¼å¾…ã¡ã‚­ãƒ¥ãƒ¼ | InterventionQueue | Â§3.6.1 |
| ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å‰é¢åŒ– | OS API (SetForegroundWindow) | Â§3.6.1 |
| ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼ | åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€æ‹¬è§£æ±º | Â§3.6.1 |

**Â§3.6.1å®‰å…¨é‹ç”¨æ–¹é‡**:
- CDPè¨±å¯: `Page.navigate`, `Page.bringToFront`
- CDPç¦æ­¢: `Runtime.evaluate`, `DOM.*`, `Input.*`, `Emulation.*`
- å®Œäº†æ¤œçŸ¥: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ˜ç¤ºå ±å‘Šã®ã¿ï¼ˆDOMç›£è¦–ç¦æ­¢ï¼‰

**Â§2.1.5åˆ¤æ–­å§”è­²ã®ä¾‹å¤–**:
- Cursor AIç„¡å¿œç­”æ™‚ï¼ˆ60ç§’æ—¢å®šï¼‰: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®‰å…¨åœæ­¢ã€çŠ¶æ…‹ä¿å­˜ã€å¾©å¸°å¾…æ©Ÿ
  - **å®Ÿè£…çŠ¶æ³**: âœ… **å®Ÿè£…æ¸ˆã¿**ã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ60ç§’ï¼‰ã¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£è¿½è·¡ã‚’å®Ÿè£…ã€‚`get_status`ã§`idle_seconds`ã¨è­¦å‘Šã‚’è¿”å´ã€‚

#### A.9 ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | Markdown / JSON | Â§3.4 |
| å¼•ç”¨ç®¡ç† | æ·±ã„ãƒªãƒ³ã‚¯ç”Ÿæˆã€ä¸€æ¬¡/äºŒæ¬¡åˆ†é¡ | Â§3.4 |

---

### Phase B: å“è³ªå¼·åŒ– âœ…

#### B.1 ãƒ¡ãƒˆãƒªã‚¯ã‚¹/è‡ªå‹•é©å¿œ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† | MetricsCollector, TaskMetrics | Â§4.6 |
| ãƒãƒªã‚·ãƒ¼è‡ªå‹•æ›´æ–° | PolicyEngine (EMAã€ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹) | Â§4.6 |
| ãƒªãƒ—ãƒ¬ã‚¤ãƒ¢ãƒ¼ãƒ‰ | DecisionLogger, ReplayEngine | Â§4.6 |

**ãƒãƒªã‚·ãƒ¼è‡ªå‹•æ›´æ–°ã®æ—¢å®šå€¤ï¼ˆÂ§4.6ï¼‰**:
- å‘¨æœŸè£œå®Œ: 60ç§’
- EMAä¿‚æ•°: çŸ­æœŸÎ±=0.3ã€é•·æœŸÎ±=0.1
- Toråˆ©ç”¨ä¸Šé™: 20%
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åè»¢é˜²æ­¢: 5åˆ†æœªæº€ã¯åè»¢ã•ã›ãªã„

#### B.2 æ¢ç´¢åˆ¶å¾¡ âœ…

**Â§2.1è²¬ä»»åˆ†ç•Œ**: ã‚¯ã‚¨ãƒªè¨­è¨ˆã¯Cursor AIã€Lyraã¯å®Ÿè¡Œã®ã¿

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| è¨­è¨ˆæ”¯æ´æƒ…å ± | ResearchContext | Â§2.1.2 |
| ã‚µãƒ–ã‚¯ã‚¨ãƒªå®Ÿè¡Œ | SubqueryExecutor | Â§2.1.2 |
| å……è¶³åº¦åˆ¤å®š | ExplorationState | Â§3.1.7.3 |
| åè¨¼æ¢ç´¢ | RefutationExecutor (æ©Ÿæ¢°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿) | Â§3.1.7.5 |

#### B.3 ã‚¯ãƒ­ãƒ¼ãƒªãƒ³ã‚°æ‹¡å¼µ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| robots.txt/sitemap | RobotsChecker, SitemapParser | Â§3.1.2 |
| ãƒ‰ãƒ¡ã‚¤ãƒ³å†…BFS | DomainBFSCrawler | Â§3.1.2 |
| ã‚µã‚¤ãƒˆå†…æ¤œç´¢ | SiteSearchManager | Â§3.1.5 |
| Waybackå·®åˆ† | WaybackExplorer | Â§3.1.6 |

#### B.4 ä¿¡é ¼åº¦ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ç¢ºç‡æ ¡æ­£ | Platt/æ¸©åº¦ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° | Â§3.3.4 |
| ãƒ‡ã‚°ãƒ¬æ¤œçŸ¥ | Brierã‚¹ã‚³ã‚¢ç›£è¦– | Â§4.6.1 |
| ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | CalibrationHistory | Â§4.6.1 |

---

### Phase C: æ¤œç´¢çµŒè·¯å†è¨­è¨ˆ âœ…

#### C.1 SearXNGå»ƒæ­¢ã®èƒŒæ™¯

**å•é¡Œ**: SearXNGã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§å‹•ä½œã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®æŠ€è¡“çš„æ¬ é™¥ãŒã‚ã£ãŸï¼š

1. **Cookie/æŒ‡ç´‹ä½¿ç”¨ä¸å¯**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã§ããªã„
2. **botæ¤œçŸ¥ã•ã‚Œã‚„ã™ã„**: Cookie/æŒ‡ç´‹ãªã—ã®ç´ ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
3. **CAPTCHAè§£æ±ºä¸å¯**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒCAPTCHAè§£æ±ºã—ã¦ã‚‚ã€SearXNGã«Cookieã¯æ¸¡ã‚‰ãªã„
4. **Â§3.6.1ã¨ã®çŸ›ç›¾**: èªè¨¼å¾…ã¡ã‚­ãƒ¥ãƒ¼ã®è¨­è¨ˆæ„å›³ãŒæˆç«‹ã—ãªã„

**æ ¹æœ¬åŸå› **: SearXNGã¯ã€Œä¾¿åˆ©ã€ã ã£ãŸãŒã€æŠ—å …æ€§ï¼ˆÂ§4.3ï¼‰ã‚’çŠ ç‰²ã«ã™ã‚‹è¨­è¨ˆã ã£ãŸã€‚

#### C.2 æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆBrowserSearchProviderï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lyra       â”‚ â†’  â”‚ Playwright   â”‚ â†’ DuckDuckGoç­‰
â”‚ (ç›´æ¥æ¤œç´¢)   â”‚    â”‚ (ãƒ–ãƒ©ã‚¦ã‚¶)   â”‚
â”‚              â”‚    â”‚ Cookie: ã‚ã‚Š â”‚
â”‚              â”‚    â”‚ æŒ‡ç´‹: ã‚ã‚Š   â”‚    â†’ äººé–“ã‚‰ã—ã„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚
        â–¼                  â–¼
   æ¤œç´¢çµæœãƒ‘ãƒ¼ã‚µãƒ¼   ã‚»ãƒƒã‚·ãƒ§ãƒ³è»¢é€ï¼ˆÂ§3.1.2ï¼‰
   (BeautifulSoup)    ãŒæ¤œç´¢ã«ã‚‚é©ç”¨å¯èƒ½
```

**å®Ÿè£…å®Œäº†é …ç›®**:
- `BrowserSearchProvider`: Playwright CDPæ¥ç¶šã€ã‚¨ãƒ³ã‚¸ãƒ³åˆ¥URLæ§‹ç¯‰ã€CAPTCHAæ¤œçŸ¥â†’èªè¨¼ã‚­ãƒ¥ãƒ¼é€£æº
- `BaseSearchParser` + ã‚¨ãƒ³ã‚¸ãƒ³åˆ¥ãƒ‘ãƒ¼ã‚µãƒ¼: DuckDuckGo, Mojeek, Google, Brave, Qwant, Ecosia, Startpage
- `config/search_parsers.yaml`: ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å¤–éƒ¨åŒ–ã€AIä¿®æ­£ç”¨è¨ºæ–­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

#### C.3 docs/REQUIREMENTS.mdä¿®æ­£å†…å®¹

**Â§3.2 ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œæ©Ÿèƒ½**:
```
ã€æ—§ã€‘æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆ: ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¨¼åƒã™ã‚‹SearXNGï¼ˆãƒ¡ã‚¿æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰ã«å¯¾ã—ã‚¯ã‚¨ãƒªã‚’é€ä¿¡

ã€æ–°ã€‘æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆ: PlaywrightçµŒç”±ã§æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ç›´æ¥æ¤œç´¢ã™ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCookie/æŒ‡ç´‹ï¼‰ã‚’ä½¿ç”¨
- å¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³: DuckDuckGo, Google, Mojeek, Qwant, Brave
- CAPTCHAç™ºç”Ÿæ™‚ã¯æ‰‹å‹•ä»‹å…¥ãƒ•ãƒ­ãƒ¼ï¼ˆÂ§3.6.1ï¼‰ã«ç§»è¡Œ
- ã‚»ãƒƒã‚·ãƒ§ãƒ³è»¢é€ï¼ˆÂ§3.1.2ï¼‰ãŒæ¤œç´¢ã«ã‚‚é©ç”¨
```

**Â§4.3.3 ã‚¹ãƒ†ãƒ«ã‚¹è¨­è¨ˆæ–¹é‡** ã«è¿½è¨˜:
```
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ç¦æ­¢:
  - SearXNG/å…¬é–‹SearXã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç­‰ã¯ä½¿ç”¨ã—ãªã„
  - ç†ç”±: Cookie/æŒ‡ç´‹ä½¿ç”¨ä¸å¯ã€CAPTCHAè§£æ±ºä¸å¯ã€IPæ±šæŸ“ãƒªã‚¹ã‚¯
  - ã™ã¹ã¦ã®æ¤œç´¢ãƒ»å–å¾—ã¯ãƒ–ãƒ©ã‚¦ã‚¶çµŒç”±ã§å®Ÿè¡Œ
```

**Â§5.1 ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
```
ã€æ—§ã€‘Search Engine: SearXNG (Podmanã‚³ãƒ³ãƒ†ãƒŠ)

ã€æ–°ã€‘Search Engine: PlaywrightçµŒç”±ã®ç›´æ¥ãƒ–ãƒ©ã‚¦ã‚¶æ¤œç´¢ï¼ˆBrowserSearchProviderï¼‰
- å¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³: DuckDuckGo, Mojeek, Qwant, Brave, Google
- ã‚¨ãƒ³ã‚¸ãƒ³allowlistï¼ˆæ—¢å®šï¼‰: DuckDuckGo, Mojeek, Qwantã€‚Googleã¯ä½é‡ã¿
```

---

### Phase D: æŠ—å …æ€§ãƒ»ã‚¹ãƒ†ãƒ«ã‚¹æ€§å¼·åŒ– âœ…

#### D.1 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/IPå±¤ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| IPv6é‹ç”¨ | IPv6ConnectionManager | Â§4.3 |
| DNSæ–¹é‡ | DNSPolicyManager (socks5h://ã§ãƒªãƒ¼ã‚¯é˜²æ­¢) | Â§4.3 |
| HTTP/3æ–¹é‡ | HTTP3PolicyManager | Â§4.3 |

#### D.2 ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆ/TLSå±¤ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| sec-fetch-*ãƒ˜ãƒƒãƒ€ãƒ¼ | SecFetchHeaders | Â§4.3 |
| sec-ch-ua*ãƒ˜ãƒƒãƒ€ãƒ¼ | SecCHUAHeaders | Â§4.3 |

#### D.3 ãƒ–ãƒ©ã‚¦ã‚¶/JSå±¤ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| webdriverã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ | stealth.py (STEALTH_JS) | Â§4.3 |
| undetected-chromedriverãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ | UndetectedChromeFetcher | Â§4.3 |
| viewportã‚¸ãƒƒã‚¿ãƒ¼ | ViewportJitter | Â§4.3 |

#### D.4 ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¥å…¨æ€§ç›£æŸ» âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| å·®åˆ†æ¤œçŸ¥ | ProfileAuditor (UA/ãƒ•ã‚©ãƒ³ãƒˆ/è¨€èª/æŒ‡ç´‹) | Â§4.3.1 |
| è‡ªå‹•ä¿®å¾© | attempt_repair (Chromeå†èµ·å‹•ç­‰) | Â§4.3.1 |
| ç›£æŸ»ãƒ­ã‚° | JSONLå½¢å¼ | Â§4.3.1 |

#### D.5 ã‚»ãƒƒã‚·ãƒ§ãƒ³ç§»é€ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| Cookie/ETagç§»é€ | SessionTransferManager | Â§3.1.2 |
| åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶ç´„ | capture_from_browser | Â§3.1.2 |

#### D.6 ãƒ–ãƒ©ã‚¦ã‚¶çµŒè·¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| CDXJé¢¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ | CDXJGenerator | Â§4.3.2 |
| ç°¡æ˜“HARç”Ÿæˆ | HARGenerator | Â§4.3.2 |

#### D.7 ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ãƒ©ã‚¤ã‚¯æ“ä½œ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒã‚¦ã‚¹è»Œè·¡ | MouseTrajectory (Bezieræ›²ç·š) | Â§4.3.4 |
| ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒªã‚ºãƒ  | HumanTyping (ã‚¬ã‚¦ã‚¹åˆ†å¸ƒ) | Â§4.3.4 |
| ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ…£æ€§ | InertialScroll (easing) | Â§4.3.4 |
| è¨­å®šå¤–éƒ¨åŒ– | config/human_behavior.yaml | Â§4.3.4 |

---

### Phase E: å­¦è¡“æƒ…å ±å“è³ªå¼·åŒ– âœ…

#### E.1 æ¤œç´¢æˆ¦ç•¥ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| UCB1é¢¨äºˆç®—å†é…åˆ† | UCBAllocator | Â§3.1.1 |
| ãƒ”ãƒœãƒƒãƒˆæ¢ç´¢ | PivotExpander | Â§3.1.1 |

> **æ³¨æ„**: ã‚¯ã‚¨ãƒªA/Bãƒ†ã‚¹ãƒˆï¼ˆABTestExecutorï¼‰ã¯Â§3.1.1ã‹ã‚‰å‰Šé™¤ã•ã‚Œã€ã€Œå°†æ¥ã®æ‹¡å¼µã€ã«ç§»å‹•ã—ãŸã€‚

#### E.2 ã‚¤ãƒ³ãƒ•ãƒ©/ãƒ¬ã‚¸ã‚¹ãƒˆãƒªé€£æº âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| RDAP/WHOIS | RDAPClient, WHOISParser | Â§3.1.2 |
| è¨¼æ˜æ›¸é€æ˜æ€§ | CertTransparencyClient (crt.sh) | Â§3.1.2 |
| ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£KB | EntityKB, NameNormalizer | Â§3.1.2 |

#### E.3 ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å“è³ª âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—åˆ¤å®š | PageClassifier | Â§3.1.2 |
| ä½å“è³ªæ¤œå‡º | ContentQualityAnalyzer | Â§3.3.3 |
| AIç”Ÿæˆæ¤œå‡º | 23ãƒ‘ã‚¿ãƒ¼ãƒ³ + æ–‡é•·å‡ä¸€æ€§ | Â§3.3.3 |
| æ™‚ç³»åˆ—æ•´åˆ | TemporalConsistencyChecker | Â§3.3.3 |

#### E.4 ä¸»å¼µåˆ†æ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| å•ã„â†’ä¸»å¼µåˆ†è§£ | ClaimDecomposer | Â§3.3.1 |
| Chain-of-Densityåœ§ç¸® | ChainOfDensityCompressor | Â§3.3.1 |

---

### Phase F: è¿½åŠ æ©Ÿèƒ½ âœ…

#### F.1 æ ¡æ­£ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒ‡ã‚°ãƒ¬æ¤œçŸ¥ | CalibrationHistory.check_degradation() | Â§4.6.1 |
| ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | Calibrator.rollback() | Â§4.6.1 |
| è©•ä¾¡æ°¸ç¶šåŒ– | calibration_evaluations ãƒ†ãƒ¼ãƒ–ãƒ« | Â§4.6.1 |

#### F.2 ãƒ—ãƒ­ã‚»ã‚¹ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒ–ãƒ©ã‚¦ã‚¶ç ´æ£„ | ProcessLifecycleManager | Â§4.2 |
| LLMè§£æ”¾ | OllamaClient.unload_model() | Â§4.2 |

#### F.3 åŠè‡ªå‹•é‹ç”¨UX âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| èªè¨¼å¾…ã¡æƒ…å ±çµ±åˆ | get_exploration_status ã« authentication_queue è¿½åŠ  | Â§3.6.1 |
| é–¾å€¤ã‚¢ãƒ©ãƒ¼ãƒˆ | warningsé…åˆ—ã¸ã®è¿½åŠ  (â‰¥3ä»¶ã§è­¦å‘Š) | Â§3.6.1 |

#### F.4 ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ä¸»å¼µã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ | ClaimTimeline, TimelineEvent | Â§3.4 |
| Waybacké€£æº | integrate_wayback_result() | Â§3.1.6 |
| ã‚«ãƒãƒ¬ãƒƒã‚¸ç®—å‡º | get_timeline_coverage() | Â§7 |

#### F.5 Waybackãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ | fetcher.pyçµ±åˆ (403/CAPTCHAæ™‚) | Â§3.1.6 |
| å·®åˆ†æ¤œå‡º | ArchiveDiffResult | Â§3.1.6 |
| é®®åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ | apply_freshness_penalty() | Â§3.1.6 |

---

### Phase G: ãƒ†ã‚¹ãƒˆåŸºç›¤ âœ…

#### G.1 ãƒ†ã‚¹ãƒˆåˆ†é¡

| åˆ†é¡ | ãƒãƒ¼ã‚«ãƒ¼ | å¤–éƒ¨ä¾å­˜ | å®Ÿè¡Œç’°å¢ƒ |
|------|----------|----------|----------|
| unit | `@pytest.mark.unit` | ãªã— | ã©ã“ã§ã‚‚ |
| integration | `@pytest.mark.integration` | ãƒ¢ãƒƒã‚¯ | ã©ã“ã§ã‚‚ |
| e2e | `@pytest.mark.e2e` | å®Ÿã‚µãƒ¼ãƒ“ã‚¹ | ä½ãƒªã‚¹ã‚¯IPé™å®š |

**è¿½åŠ ãƒãƒ¼ã‚«ãƒ¼**:
- `@external`: å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨ï¼ˆMojeek, Qwantç­‰ï¼‰
- `@rate_limited`: ãƒ¬ãƒ¼ãƒˆåˆ¶é™å³ã—ã„ï¼ˆDuckDuckGo, Googleç­‰ï¼‰
- `@manual`: äººæ‰‹ä»‹å…¥å¿…é ˆï¼ˆCAPTCHAè§£æ±ºç­‰ï¼‰

#### G.2 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**å®Ÿè¡Œç’°å¢ƒ**:
- **WSL venvï¼ˆæ¨å¥¨ï¼‰**: `requirements-mcp.txt`ã§åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¯èƒ½
- **ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ä¾å­˜é–¢ä¿‚**: ML/PDF/OCRæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã«ã¯è¿½åŠ ä¾å­˜é–¢ä¿‚ãŒå¿…è¦ï¼ˆÂ§K.4å‚ç…§ï¼‰

```bash
# WSL venvã‹ã‚‰å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
source .venv/bin/activate
pytest tests/ -m 'not e2e' --tb=short -q

# ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆ
pip install -r requirements-ml.txt

# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆdevã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œï¼‰
podman exec lyra pytest tests/

# ç°¡æ½”ãªå‡ºåŠ›
podman exec lyra pytest tests/ --tb=no -q

# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿
podman exec lyra pytest tests/test_robots.py -v
```

**ä¾å­˜é–¢ä¿‚ç¢ºèª**ï¼ˆå›å¸°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ï¼‰:
```bash
# MLé–¢é€£ä¾å­˜é–¢ä¿‚ã®ç¢ºèª
python -c "import sentence_transformers, transformers, torch" 2>/dev/null && echo "ML deps OK" || echo "ML deps MISSING"

# PDF/OCRé–¢é€£ä¾å­˜é–¢ä¿‚ã®ç¢ºèª
python -c "import fitz, PIL" 2>/dev/null && echo "PDF/OCR deps OK" || echo "PDF/OCR deps MISSING"
```

**ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆæ•°**: 2886ä»¶ï¼ˆä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ç’°å¢ƒã§å…¨ãƒ‘ã‚¹ã€ä¾å­˜é–¢ä¿‚ä¸è¶³æ™‚ã¯ä¸€éƒ¨ã‚¹ã‚­ãƒƒãƒ—ï¼‰

#### G.3 E2Eã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆtests/scripts/ï¼‰

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | æ¤œè¨¼å†…å®¹ | ä»•æ§˜ | çŠ¶æ…‹ |
|-----------|----------|------|:----:|
| `verify_duckduckgo_search.py` | DuckDuckGoæ¤œç´¢ã€ãƒ‘ãƒ¼ã‚µãƒ¼ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ | Â§3.2 | âœ… 5/5 |
| `verify_ecosia_search.py` | Ecosiaæ¤œç´¢ï¼ˆBingå†è²©ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_startpage_search.py` | Startpageæ¤œç´¢ï¼ˆGoogleå†è²©ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_mojeek_search.py` | Mojeekæ¤œç´¢ï¼ˆç‹¬ç«‹ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_qwant_search.py` | Qwantæ¤œç´¢ï¼ˆEUç³»ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_brave_search.py` | Braveæ¤œç´¢ï¼ˆç‹¬è‡ªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_google_search.py` | Googleæ¤œç´¢ï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_bing_search.py` | Bingæ¤œç´¢ï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_captcha_flow.py` | CAPTCHAâ†’é€šçŸ¥â†’æ‰‹å‹•è§£æ±ºâ†’ç¶™ç¶š | Â§3.6.1 | âœ… |
| `verify_session_transfer.py` | ãƒ–ãƒ©ã‚¦ã‚¶â†’HTTPé–“ã‚»ãƒƒã‚·ãƒ§ãƒ³ç§»é€ | Â§3.1.2 | âœ… |
| `verify_search_then_fetch.py` | æ¤œç´¢â†’å–å¾—ã®ä¸€è²«æ€§ | Â§3.2 | âœ… |
| `verify_network_resilience.py` | IPv6ã€DNSãƒªãƒ¼ã‚¯ã€304æ´»ç”¨ | Â§7 | âœ… |
| `verify_profile_health.py` | ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¥å…¨æ€§ã€è‡ªå‹•ä¿®å¾© | Â§7 | âœ… |

---

### Phase H: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å¤šæ§˜åŒ– âœ…

#### H.1 å®Ÿè£…çŠ¶æ³ãƒãƒˆãƒªã‚¯ã‚¹

| ã‚¨ãƒ³ã‚¸ãƒ³ | ä»•æ§˜æ›¸Â§3.2 | engines.yaml | ãƒ‘ãƒ¼ã‚µãƒ¼ | E2Eã‚¹ã‚¯ãƒªãƒ—ãƒˆ | E2Eæ¤œè¨¼ | çŠ¶æ…‹ |
|----------|:----------:|:------------:|:--------:|:-------------:|:-------:|------|
| DuckDuckGo | âœ… | âœ… | âœ… | âœ… | âœ… 5/5 | **å®Œäº†** |
| Mojeek | âœ… | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Google | âœ… | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Brave | âœ… | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Ecosia | - | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Startpage | - | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Bing | - | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |

#### H.2 E2Eæ¤œè¨¼ã§åˆ¤æ˜ã—ãŸçŸ¥è¦‹

##### H.2.1 MetaGerå‰Šé™¤

**å•é¡Œ**: ãƒ­ã‚°ã‚¤ãƒ³ã‚²ãƒ¼ãƒˆãŒå­˜åœ¨ã—ã€å…¨ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒå¤±æ•—
**ç—‡çŠ¶**: æ¤œç´¢çµæœãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚èªè¨¼ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
**æ±ºå®š**: ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‚‰å®Œå…¨å‰Šé™¤ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã‚²ãƒ¼ãƒˆã¯CAPTCHAã¨ç•°ãªã‚Šå›é¿å›°é›£ï¼‰

**å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«**:
- `config/engines.yaml`: metagerã‚»ã‚¯ã‚·ãƒ§ãƒ³
- `config/search_parsers.yaml`: metagerã‚»ã‚¯ã‚·ãƒ§ãƒ³
- `src/search/search_parsers.py`: MetaGerParserã‚¯ãƒ©ã‚¹
- `src/search/parser_config.py`: metagerãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- `tests/test_search_parsers.py`: MetaGeré–¢é€£ãƒ†ã‚¹ãƒˆ
- `tests/fixtures/search_html/metager_results.html`
- `tests/scripts/verify_metager_search.py`

##### H.2.2 ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ä¿å®ˆã®æ•™è¨“

**å•é¡Œ**: Ecosia/Startpageã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒå®Ÿéš›ã®HTMLã¨ä¸ä¸€è‡´
**åŸå› **: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã¯HTMLã‚’äºˆå‘Šãªãå¤‰æ›´ã™ã‚‹
**å¯¾ç­–**:
1. E2Eå¤±æ•—æ™‚ã«`debug/search_html/`ã¸HTMLè‡ªå‹•ä¿å­˜
2. `config/search_parsers.yaml`ã§ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å¤–éƒ¨åŒ–
3. æ§‹é€ åŒ–ãƒ­ã‚°ã§å¤±æ•—ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼åã‚’æ˜ç¤º

**Ecosiaä¿®æ­£å¾Œã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼**:
```yaml
results_container: ".mainline__result-wrapper"
title: "a[data-test-id='result-link'], .result-title__heading"
url: "a[data-test-id='result-link']"
snippet: ".result__description"
```

**Startpageä¿®æ­£å¾Œã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼**:
```yaml
results_container: ".result"
title: ".wgl-title, .result-title"
url: "a.result-title, a.result-link"
snippet: ".description"
```

##### H.2.3 E2Eæ¤œè¨¼ã§åˆ¤æ˜ã—ãŸè¿½åŠ å•é¡Œ

**Qwantåœ°åŸŸåˆ¶é™**:
- ç—‡çŠ¶: ã€ŒUnfortunately we are not yet available in your countryã€
- åŸå› : Qwantã¯æ—¥æœ¬ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã—ã¦ã„ã‚‹
- å¯¾å¿œ: engines.yamlã‹ã‚‰Qwantã‚’å‰Šé™¤ï¼ˆåœ°åŸŸåˆ¶é™ã¯CAPTCHAã¨ç•°ãªã‚Šå›é¿å›°é›£ï¼‰

**Braveã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: âœ… ä¿®æ­£æ¸ˆã¿
- ç—‡çŠ¶: `networkidle`å¾…æ©Ÿã§10ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- åŸå› : Braveã¯JSã§å¸¸æ™‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹
- å¯¾å¿œ: `networkidle`ã‚’5ç§’tryå¾Œã€`asyncio.sleep(2)`ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

**BrowserSearchProvider CDPãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å•é¡Œ**: âœ… ä¿®æ­£æ¸ˆã¿
- ç—‡çŠ¶: ChromeãŒèµ·å‹•ã—ã¦ã„ãªã„æ™‚ã«ã€ŒCAPTCHA detectedã€ã¨å ±å‘Šã•ã‚Œã¦ã„ãŸ
- æ ¹æœ¬åŸå› : CDPæ¥ç¶šå¤±æ•—æ™‚ã«ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç”Ÿï¼ˆä»•æ§˜é•åï¼‰
- ä¿®æ­£å†…å®¹:
  1. ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‰Šé™¤ï¼ˆÂ§4.3.3ã€Œå®Ÿãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è²«æ€§ã€ã«æº–æ‹ ï¼‰
  2. CDPæ¥ç¶šå¤±æ•—æ™‚ã¯æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™
  3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«`./scripts/chrome.sh start`ã®æ¡ˆå†…ã‚’å«ã‚ã‚‹
  4. `SearchResponse.connection_mode`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆè¨ºæ–­ç”¨ï¼‰
- å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«:
  - `src/search/provider.py`: `SearchResponse`ã«`connection_mode`è¿½åŠ 
  - `src/search/browser_search_provider.py`: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‰Šé™¤ã€`CDPConnectionError`è¿½åŠ 
  - `tests/test_browser_search_provider.py`: CDPæ¥ç¶šãƒ†ã‚¹ãƒˆè¿½åŠ 

**Brave CAPTCHAèª¤æ¤œå‡ºå•é¡Œ**: âœ… ä¿®æ­£æ¸ˆã¿
- ç—‡çŠ¶: æ­£å¸¸ãªæ¤œç´¢çµæœãƒšãƒ¼ã‚¸ã§ã€ŒCAPTCHA detectedã€ã¨èª¤å ±å‘Š
- æ ¹æœ¬åŸå› : `captcha_patterns`ã®`"captcha"`ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒJSå¤‰æ•°åï¼ˆ`captchacookiename`ç­‰ï¼‰ã«ãƒãƒƒãƒ
- ä¿®æ­£å†…å®¹: `config/search_parsers.yaml`ã®Braveç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚ˆã‚Šå…·ä½“çš„ã«å¤‰æ›´
  - `"captcha"` â†’ `"please complete the captcha"`, `"verify you are human"`

**Bing URLãƒ‡ã‚³ãƒ¼ãƒ‰å•é¡Œ**: âœ… ä¿®æ­£æ¸ˆã¿
- ç—‡çŠ¶: Bingæ¤œç´¢çµæœãŒ0ä»¶ã¨ã—ã¦è¿”ã•ã‚Œã‚‹
- æ ¹æœ¬åŸå› : Bingã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLï¼ˆ`u=a1aHR0cHM6...`ï¼‰ãŒbase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ãŒã€ãƒ‡ã‚³ãƒ¼ãƒ‰å‡¦ç†ãŒæ¬ è½
- ä¿®æ­£å†…å®¹: `src/search/search_parsers.py`ã®`_clean_bing_url`ã«base64ãƒ‡ã‚³ãƒ¼ãƒ‰è¿½åŠ 

##### H.2.4 E2Eã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å…±é€šä¿®æ­£

**å•é¡Œ1**: `SearchResponse`ã«`captcha_detected`å±æ€§ãŒãªã„
**ä¿®æ­£**: `result.error`æ–‡å­—åˆ—ã‹ã‚‰"CAPTCHA detected"ã‚’æ¤œç´¢ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’è¿½åŠ 
```python
def _is_captcha_detected(result: SearchResponse) -> tuple[bool, Optional[str]]:
    if result.error and "CAPTCHA detected" in result.error:
        match = re.search(r"CAPTCHA detected: (\w+)", result.error)
        captcha_type = match.group(1) if match else "unknown"
        return True, captcha_type
    return False, None
```

**å•é¡Œ2**: `FetchPolicy`ã‚¯ãƒ©ã‚¹ãŒå­˜åœ¨ã—ãªã„
**ä¿®æ­£**: `BrowserFetcher.fetch(headful=False)`ã«ç›´æ¥å¤‰æ›´

**å•é¡Œ3**: `FetchResult.content`å±æ€§ãŒãªã„
**ä¿®æ­£**: `result.html_path or result.content_hash`ã§åˆ¤å®š

##### H.2.5 E2Eã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆã®å®Œäº†

**å„ªå…ˆåº¦ä¸­ï¼ˆE2Eã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šï¼‰**:
- [x] `verify_mojeek_search.py`ä½œæˆ âœ…
- [x] ~~`verify_qwant_search.py`ä½œæˆ~~ â†’ Qwantå‰Šé™¤ï¼ˆåœ°åŸŸåˆ¶é™ã€H.2.3å‚ç…§ï¼‰
- [x] `verify_brave_search.py`ä½œæˆ âœ…

**å„ªå…ˆåº¦ä½ï¼ˆé«˜ãƒªã‚¹ã‚¯ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰**:
- [x] `verify_google_search.py`ä½œæˆ âœ…ï¼ˆCAPTCHAé«˜é »åº¦ï¼‰
- [x] `verify_bing_search.py`ä½œæˆ âœ…

**æ³¨**: Bingãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…ã¯H.1ã®ãƒãƒˆãƒªã‚¯ã‚¹ã«åæ˜ æ¸ˆã¿ã€‚CDPãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å•é¡Œã®ä¿®æ­£ã¯H.2.3ã«æ—¢ã«è¨˜è¼‰ã€‚

##### H.2.6 MCPã‚µãƒ¼ãƒçµŒç”±ã§ã®å‹•ä½œç¢ºèª

---

#### G.4 å®Ÿè£…ã®çŠ¶æ³ç¢ºèªã‚¿ã‚¹ã‚¯

**ç›®çš„**: å®Ÿè£…è¨ˆç”»æ›¸ã®è¨˜è¿°ã¨å®Ÿéš›ã®å®Ÿè£…çŠ¶æ³ã«ä¸ä¸€è‡´ãŒãªã„ã‹å®šæœŸçš„ã«ç¢ºèªã™ã‚‹ã€‚

**ç¢ºèªé …ç›®**:

1. **ä¾å­˜é–¢ä¿‚ã®æ•´åˆæ€§**
   - å®Ÿè£…è¨ˆç”»æ›¸ã§ã€Œä¾å­˜é–¢ä¿‚ä¸è¦ã€ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆãŒã€å®Ÿéš›ã«ã¯ä¾å­˜é–¢ä¿‚ã‚’å¿…è¦ã¨ã—ã¦ã„ãªã„ã‹
   - ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å†…ã§ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ç®‡æ‰€ãŒãªã„ã‹ï¼ˆãƒ¢ãƒƒã‚¯ã‚’ä½¿ã†å‰ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
   - ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªä¾å­˜é–¢ä¿‚ã®ä¸è¶³ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆå¤±æ•—ãŒé©åˆ‡ã«æ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹

2. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒã®æ•´åˆæ€§**
   - WSL venvã¨ã‚³ãƒ³ãƒ†ãƒŠç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡ŒçµæœãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹
   - ãƒ†ã‚¹ãƒˆãƒãƒ¼ã‚«ãƒ¼ï¼ˆ`@pytest.mark.skip`ç­‰ï¼‰ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
   - E2Eãƒ†ã‚¹ãƒˆãŒé©åˆ‡ãªç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹

3. **å®Ÿè£…è¨ˆç”»æ›¸ã®æ›´æ–°**
   - å®Ÿè£…å®Œäº†å¾Œã®çŸ¥è¦‹ãŒå®Ÿè£…è¨ˆç”»æ›¸ã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹
   - è¨­è¨ˆæ–¹é‡ã¨å®Ÿéš›ã®å®Ÿè£…ã«ä¸ä¸€è‡´ãŒãªã„ã‹
   - ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ãŒè¿½è¨˜ã•ã‚Œã¦ã„ã‚‹ã‹

**å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**:
- æ–°æ©Ÿèƒ½å®Ÿè£…å®Œäº†æ™‚
- å›å¸°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚
- å®Ÿè£…è¨ˆç”»æ›¸ã®æ›´æ–°æ™‚

**å®Ÿè¡Œæ–¹æ³•**:
```bash
# 1. å›å¸°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
./scripts/test.sh run tests/

# 2. ãƒ†ã‚¹ãƒˆçµæœç¢ºèª
./scripts/test.sh check

# 3. å¤±æ•—ãƒ†ã‚¹ãƒˆã®åŸå› åˆ†æ
# - ä¾å­˜é–¢ä¿‚ã®ä¸è¶³ã‹ï¼ˆÂ§G.2ã€Œä¾å­˜é–¢ä¿‚ç¢ºèªã€ã‚’å‚ç…§ï¼‰
# - å®Ÿè£…è¨ˆç”»æ›¸ã¨ã®ä¸ä¸€è‡´ã‹ï¼ˆÂ§K.4.7å‚ç…§ï¼‰
# - ãƒã‚°ã‹

# 4. å®Ÿè£…è¨ˆç”»æ›¸ã®æ›´æ–°
# - çŸ¥è¦‹ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½è¨˜
# - è¨­è¨ˆæ–¹é‡ã¨ã®ä¸ä¸€è‡´ã‚’æ˜è¨˜
# - ä¾å­˜é–¢ä¿‚è¦ä»¶ã‚’æ›´æ–°
```

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] å›å¸°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«ä¾å­˜é–¢ä¿‚ã‚’ç¢ºèªï¼ˆÂ§G.2å‚ç…§ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆå¤±æ•—ã®åŸå› ã‚’åˆ†æï¼ˆä¾å­˜é–¢ä¿‚ä¸è¶³ / å®Ÿè£…è¨ˆç”»æ›¸ã¨ã®ä¸ä¸€è‡´ / ãƒã‚°ï¼‰
- [ ] å®Ÿè£…è¨ˆç”»æ›¸ã¨ã®ä¸ä¸€è‡´ãŒã‚ã‚Œã°ã€è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½è¨˜
- [ ] ä¾å­˜é–¢ä¿‚è¦ä»¶ãŒå®Ÿè£…è¨ˆç”»æ›¸ã«æ˜è¨˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒã®é•ã„ï¼ˆWSL venv / ã‚³ãƒ³ãƒ†ãƒŠï¼‰ãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

**éå»ã®äº‹ä¾‹**:
- **Phase K.4**: MLãƒ¢ãƒ‡ãƒ«ã¯åˆ¥ã‚³ãƒ³ãƒ†ãƒŠã§å®Ÿè¡Œã•ã‚Œã‚‹è¨­è¨ˆã ãŒã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å†…ã§ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãŸã‚ã€WSL venvã«ã‚‚ä¾å­˜é–¢ä¿‚ãŒå¿…è¦ï¼ˆÂ§K.4.7å‚ç…§ï¼‰

- [x] **MCPãƒ„ãƒ¼ãƒ«ãƒãƒ³ãƒ‰ãƒ©æ¤œè¨¼** âœ…
  - `tests/scripts/verify_mcp_tools.py`ä½œæˆ
  - `search_serp`ãƒ„ãƒ¼ãƒ«çµŒç”±ã§ã®æ¤œç´¢ãŒæ­£å¸¸å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - ãƒã‚°ä¿®æ­£: `search_parsers._classify_source`ãŒæ–‡å­—åˆ—ã‚’è¿”ã—ã¦ã„ãŸå•é¡Œã‚’ä¿®æ­£ï¼ˆSourceTag Enumã«å¤‰æ›ï¼‰

---

## 5. ä¿å®ˆãƒ»æ‹¡å¼µ (Phase I-K)

### Phase I: ä¿å®ˆæ€§æ”¹å–„ âœ…

#### I.1 ãƒ—ãƒ­ãƒã‚¤ãƒ€æŠ½è±¡åŒ– âœ…

| ãƒ—ãƒ­ãƒã‚¤ãƒ€ | å®Ÿè£… | çŠ¶æ…‹ |
|-----------|------|:----:|
| SearchProvider | BrowserSearchProvider | âœ… |
| LLMProvider | OllamaProvider | âœ… |
| BrowserProvider | PlaywrightProvider, UndetectedChromeProvider | âœ… |
| NotificationProvider | LinuxNotifyProvider, WindowsToastProvider, WSLBridgeProvider | âœ… |

#### I.2 è¨­å®šãƒ»ãƒãƒªã‚·ãƒ¼ã®å¤–éƒ¨åŒ– âœ…

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ | DomainPolicyManager + config/domains.yaml | âœ… |
| æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³è¨­å®š | SearchEngineConfigManager + config/engines.yaml | âœ… |
| ã‚¹ãƒ†ãƒ«ã‚¹è¨­å®š | - | æœªå®Ÿè£… |

#### I.3 æ±ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| é …ç›® | çŠ¶æ…‹ |
|------|:----:|
| æ±ç”¨ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚« | âœ… |
| æ±ç”¨ãƒªãƒˆãƒ©ã‚¤/ãƒãƒƒã‚¯ã‚ªãƒ• | âœ… |
| æ±ç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¤ãƒ¤ | æœªå®Ÿè£… |

##### I.3.1 æ±ç”¨ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚« âœ…

**å®Ÿè£…å†…å®¹**:
- `src/utils/circuit_breaker.py`: ä¾å­˜ã‚¼ãƒ­ã®è»½é‡ã‚³ã‚¢
  - `CircuitBreaker`: åŒæœŸç‰ˆã€ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ï¼ˆthreading.Lockï¼‰
  - `CircuitState`: å…±æœ‰enumï¼ˆCLOSED/OPEN/HALF_OPENï¼‰
  - `AsyncCircuitBreaker`: éåŒæœŸãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£å¯¾å¿œï¼‰
  - `CircuitBreakerError`: ä¾‹å¤–ã‚¯ãƒ©ã‚¹
- `src/search/circuit_breaker.py`: å…±æœ‰enumã‚’ä½¿ç”¨ã€æ¤œç´¢å›ºæœ‰æ©Ÿèƒ½ã¯ç¶­æŒ
  - EMAãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆsuccess_rate_1h, latency_ema, captcha_rateï¼‰
  - DBæ°¸ç¶šåŒ–ï¼ˆdatetimeåŸºæº–cooldownï¼‰
  - æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆfailure historyãƒ™ãƒ¼ã‚¹ï¼‰

**ãƒ†ã‚¹ãƒˆ**: `tests/test_utils_circuit_breaker.py`ï¼ˆ32ä»¶ï¼‰

##### I.3.2 æ±ç”¨ãƒªãƒˆãƒ©ã‚¤/ãƒãƒƒã‚¯ã‚ªãƒ• âœ…

**å®Ÿè£…å†…å®¹**:
- `src/utils/backoff.py`: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•è¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  - `BackoffConfig`: è¨­å®šï¼ˆbase_delay, max_delay, exponential_base, jitter_factorï¼‰
  - `calculate_backoff()`: ãƒªãƒˆãƒ©ã‚¤é…å»¶è¨ˆç®—ï¼ˆÂ§4.3.5æº–æ‹ ï¼‰
  - `calculate_cooldown_minutes()`: ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³è¨ˆç®—ï¼ˆÂ§4.3, Â§3.1.4æº–æ‹ ï¼‰
  - `calculate_total_delay()`: ç·é…å»¶æ™‚é–“è¨ˆç®—ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¦‹ç©ã‚‚ã‚Šç”¨ï¼‰
- `src/utils/api_retry.py`: å…¬å¼APIå°‚ç”¨ãƒªãƒˆãƒ©ã‚¤ï¼ˆÂ§3.1.3, Â§4.3.5æº–æ‹ ï¼‰
  - `APIRetryPolicy`: ãƒãƒªã‚·ãƒ¼è¨­å®šï¼ˆretryable_exceptions, retryable_status_codesï¼‰
  - `retry_api_call()`: éåŒæœŸãƒªãƒˆãƒ©ã‚¤é–¢æ•°
  - `@with_api_retry`: ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿
  - äº‹å‰è¨­å®šãƒãƒªã‚·ãƒ¼: `JAPAN_GOV_API_POLICY`, `ACADEMIC_API_POLICY`, `ENTITY_API_POLICY`
- `src/search/circuit_breaker.py`: å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†æ›´æ–°
  - `_calculate_cooldown()` â†’ `calculate_cooldown_minutes()` ã‚’ä½¿ç”¨

**ä»•æ§˜æ›¸æ›´æ–°**: `docs/REQUIREMENTS.md` Â§4.3.5ã€Œãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥ã®åˆ†é¡ã€ã‚’è¿½åŠ 
- ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ï¼ˆæ¤œç´¢/å–å¾—å‘ã‘ï¼‰: åŒä¸€çµŒè·¯ã§ã®å˜ç´”ãƒªãƒˆãƒ©ã‚¤ç¦æ­¢
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/APIãƒªãƒˆãƒ©ã‚¤ï¼ˆãƒˆãƒ©ãƒ³ã‚¸ã‚§ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼å‘ã‘ï¼‰: å…¬å¼APIã®ã¿é©ç”¨å¯

**ãƒ†ã‚¹ãƒˆ**: `tests/test_utils_backoff.py`ï¼ˆ26ä»¶ï¼‰ã€`tests/test_utils_api_retry.py`ï¼ˆ28ä»¶ï¼‰

#### I.4 ãƒ‘ãƒ¼ã‚µãƒ¼è‡ªå·±ä¿®å¾©ï¼ˆAIé§†å‹•ï¼‰âœ…

**ç›®çš„**: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã®HTMLå¤‰æ›´ã«å¯¾ã—ã¦AIãŒè‡ªå‹•ä¿®å¾©

**æ—¢å­˜åŸºç›¤**:
- `debug/search_html/`: å¤±æ•—æ™‚ã®HTMLè‡ªå‹•ä¿å­˜
- `config/search_parsers.yaml`: ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å¤–éƒ¨åŒ–
- æ§‹é€ åŒ–ãƒ­ã‚°: å¤±æ•—ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼åã‚’æ˜ç¤º

**ã‚¿ã‚¹ã‚¯**:
- [x] å¤±æ•—æ™‚ãƒ­ã‚° + HTMLä¿å­˜ï¼ˆæ—¢å­˜ï¼‰
- [x] AIãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªå¤±æ•—ãƒ­ã‚°å¼·åŒ–
- [x] ä¿®æ­£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­è¨ˆï¼ˆCursorã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ï¼‰

**å®Ÿè£…å†…å®¹**:

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---------|------|
| `src/search/parser_diagnostics.py` | è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆHTMLAnalyzer, YAML fixç”Ÿæˆï¼‰ |
| `src/search/search_parsers.py` | è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆçµ±åˆï¼ˆparse()å¤±æ•—æ™‚ã«è‡ªå‹•ç”Ÿæˆï¼‰ |
| `.cursor/commands/parser-repair.md` | Cursorã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ï¼ˆ/parser-repairï¼‰ |
| `tests/test_parser_diagnostics.py` | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ30ä»¶ï¼‰ |

**æ©Ÿèƒ½**:
- `ParserDiagnosticReport`: å¤±æ•—ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã€å€™è£œè¦ç´ ã€YAMLä¿®æ­£æ¡ˆã‚’å«ã‚€æ§‹é€ åŒ–ãƒ¬ãƒãƒ¼ãƒˆ
- `HTMLAnalyzer`: HTMLæ§‹é€ åˆ†æã€çµæœã‚³ãƒ³ãƒ†ãƒŠ/ã‚¿ã‚¤ãƒˆãƒ«/ã‚¹ãƒ‹ãƒšãƒƒãƒˆ/URLå€™è£œæ¤œå‡º
- `generate_yaml_fix()`: ä¿®æ­£æ¡ˆã‚’YAMLå½¢å¼ã§ç”Ÿæˆ
- `/parser-repair`ã‚³ãƒãƒ³ãƒ‰: æœ€æ–°ã®å¤±æ•—HTMLã‚’åˆ†æã—ä¿®æ­£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œ

---

### Phase J: å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹çµ±åˆ ğŸ”„ï¼ˆJ.2å„ªå…ˆï¼‰

#### J.0 APIä»•æ§˜èª¿æŸ»ï¼ˆå„ªå…ˆï¼‰

| API | èª¿æŸ»é …ç›® | çŠ¶æ…‹ |
|-----|----------|:----:|
| e-Stat | èªè¨¼ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | æœªç€æ‰‹ |
| æ³•ä»¤APIï¼ˆe-Govï¼‰ | åŒä¸Š | æœªç€æ‰‹ |
| å›½ä¼šä¼šè­°éŒ²API | åŒä¸Š | æœªç€æ‰‹ |
| gBizINFO | åŒä¸Š | æœªç€æ‰‹ |
| EDINET | åŒä¸Š | æœªç€æ‰‹ |
| **OpenAlex** | åŒä¸Š | âœ… **å®Ÿè£…å®Œäº†** |
| **Semantic Scholar** | åŒä¸Š | âœ… **å®Ÿè£…å®Œäº†** |
| **Crossref** | åŒä¸Š | âœ… **å®Ÿè£…å®Œäº†** |
| **arXiv** | åŒä¸Š | âœ… **å®Ÿè£…å®Œäº†** |
| **Unpaywall** | åŒä¸Š | âœ… **å®Ÿè£…å®Œäº†** |
| Wikidata | åŒä¸Š | æœªç€æ‰‹ |

#### J.1 æ—¥æœ¬æ”¿åºœAPIçµ±åˆ

**å¯¾è±¡ï¼ˆÂ§3.1.3ï¼‰**:
- e-Stat API: çµ±è¨ˆãƒ‡ãƒ¼ã‚¿
- æ³•ä»¤APIï¼ˆe-Govï¼‰: æ³•ä»¤å…¨æ–‡æ¤œç´¢
- å›½ä¼šä¼šè­°éŒ²API: å›½ä¼šè­°äº‹éŒ²
- gBizINFO API: æ³•äººåŸºæœ¬æƒ…å ±
- EDINET API: æœ‰ä¾¡è¨¼åˆ¸å ±å‘Šæ›¸

#### J.2 å­¦è¡“APIçµ±åˆ âœ…å®Œäº†

**çŠ¶æ…‹**: âœ… å®Ÿè£…å®Œäº†  
**è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `docs/archive/J2_ACADEMIC_API_INTEGRATION.md`
**å®Œäº†æ—¥**: 2025-12-18

**å¯¾è±¡ï¼ˆÂ§3.1.3ã€Â§5.1.1ã€æ±ºå®š6ï¼‰**:
- Semantic Scholar API: è«–æ–‡/å¼•ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆå¼•ç”¨ã‚°ãƒ©ãƒ•ä¸»APIã€PMIDâ†’DOIå¤‰æ›ã‚‚å¯¾å¿œï¼‰
- OpenAlex API: è«–æ–‡ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿/å¼•ç”¨ã‚°ãƒ©ãƒ•ï¼ˆå¤§è¦æ¨¡æ¤œç´¢ï¼‰
- **è£œåŠ©APIå‰Šé™¤ï¼ˆPhase 2 / Task 2.8ï¼‰**: Crossref / arXiv / Unpaywall ã¯å®Œå…¨å‰Šé™¤ï¼ˆS2/OpenAlexã§ä»£æ›¿å¯èƒ½ï¼‰

**å„ªå…ˆåº¦ã‚’ä¸Šã’ãŸç†ç”±**:
- ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•å¼·åŒ–ã«ç›´çµï¼ˆå¼•ç”¨ãƒã‚§ãƒ¼ãƒ³ã«ã‚ˆã‚‹ä¸»å¼µã®è£ä»˜ã‘ï¼‰
- å…¨APIç„¡æ–™ã€botæ¤œçŸ¥å•é¡Œãªã—ï¼ˆZero OpExåŸå‰‡ã«é©åˆï¼‰
- è«–æ–‡ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼ˆPhase Nï¼‰ã§æœ‰ç”¨

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | çŠ¶æ…‹ |
|--------|------|:----:|
| J.2.1 | `AcademicSearchProvider` è¨­è¨ˆ | âœ… å®Œäº† |
| J.2.2 | Semantic Scholar APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | âœ… å®Œäº† |
| J.2.3 | OpenAlex APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | âœ… å®Œäº† |
| J.2.4 | Crossref APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | âœ… å®Œäº† â†’ **å‰Šé™¤**ï¼ˆPhase 2 / Task 2.8ï¼‰ |
| J.2.5 | arXiv APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | âœ… å®Œäº† â†’ **å‰Šé™¤**ï¼ˆPhase 2 / Task 2.8ï¼‰ |
| J.2.9 | Unpaywall APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | âœ… å®Œäº† â†’ **å‰Šé™¤**ï¼ˆPhase 2 / Task 2.8ï¼‰ |
| J.2.6 | ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•æ‹¡å¼µï¼ˆCITESã‚¨ãƒƒã‚¸ã«is_academicå±æ€§è¿½åŠ ã€is_influentialã¯Phase 2ã§å‰Šé™¤ï¼‰ | âœ… å®Œäº† |
| J.2.7 | æ¤œç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆï¼ˆè£œå®Œçš„æ¤œç´¢æˆ¦ç•¥ï¼‰ | âœ… å®Œäº† |
| J.2.8 | ãƒ†ã‚¹ãƒˆãƒ»E2Eæ¤œè¨¼ | âœ… å®Œäº† |

**æˆæœç‰©**:
- `src/search/apis/`: 2ã¤ã®APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆsemantic_scholar, openalexï¼‰ã®ã¿ï¼ˆæ±ºå®š6ã€Phase 2 / Task 2.8ï¼‰
- `src/search/academic_provider.py`: çµ±åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ï¼ˆè£œåŠ©APIå‰Šé™¤æ¸ˆã¿ï¼‰
- `src/search/canonical_index.py`: DOIãƒ™ãƒ¼ã‚¹é‡è¤‡æ’é™¤
- `src/search/identifier_extractor.py`: URL/DOIè­˜åˆ¥å­æŠ½å‡º
- `src/search/id_resolver.py`: PMID/arXivâ†’DOIè§£æ±ºï¼ˆPMIDã¯S2 APIä½¿ç”¨ï¼‰
- `src/filter/evidence_graph.py`: å­¦è¡“å¼•ç”¨ã‚¨ãƒƒã‚¸å¯¾å¿œ
- `config/academic_apis.yaml`: APIè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆS2/OpenAlexã®ã¿ï¼‰
- `migrations/002_add_academic_columns.sql`: DBã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ
- ãƒ†ã‚¹ãƒˆ: æ›´æ–°æ¸ˆã¿ï¼ˆtest_pipeline_academic.py, test_evidence_graph_academic.py, test_academic_apis_config.py, test_id_resolver.pyï¼‰
- E2Eæ¤œè¨¼: `tests/scripts/debug_academic_api_flow.py`

**è¨­è¨ˆå¤‰æ›´**:
- **Abstract Onlyæˆ¦ç•¥æ¡ç”¨**: PDFãƒ•ãƒ«ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ã‚’æ’é™¤ã—ã€æŠ„éŒ²ï¼‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿è‡ªå‹•å–å¾—
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ–¹å¼**: Paperâ†’Pageçµ±åˆï¼ˆpaper_metadataã¯JSONåˆ—ã¨ã—ã¦æ ¼ç´äºˆå®šï¼‰
- **è£œå®Œçš„æ¤œç´¢**: å­¦è¡“ã‚¯ã‚¨ãƒªæ™‚ã¯ãƒ–ãƒ©ã‚¦ã‚¶æ¤œç´¢ã¨APIæ¤œç´¢ã‚’ä¸¦åˆ—å®Ÿè¡Œ

#### J.3 ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£è§£æ±ºå¼·åŒ–

**å¯¾è±¡ï¼ˆÂ§3.1.3ï¼‰**:
- Wikidata API
- DBpedia SPARQL

#### J.4 ç‰¹è¨±APIçµ±åˆ

**å¯¾è±¡ï¼ˆÂ§3.1.3æ‹¡å……ï¼‰**:
- USPTO PAIR API: ç±³å›½ç‰¹è¨±å‡ºé¡˜çŠ¶æ³
- USPTO PTAB API: å¯©åˆ¤éƒ¨æ±ºå®š
- EPO OPS API: æ¬§å·ç‰¹è¨±ãƒ‡ãƒ¼ã‚¿
- J-PlatPat: HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆAPIéå…¬é–‹ï¼‰
- CNIPA: HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆä¸­å›½ç‰¹è¨±ï¼‰

| API | èª¿æŸ»é …ç›® | çŠ¶æ…‹ |
|-----|----------|:----:|
| USPTO PAIR | èªè¨¼ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | æœªç€æ‰‹ |
| USPTO PTAB | åŒä¸Š | æœªç€æ‰‹ |
| EPO OPS | OAuth2èªè¨¼ | æœªç€æ‰‹ |
| J-PlatPat | ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­è¨ˆ | æœªç€æ‰‹ |
| CNIPA | è¨€èªå¯¾å¿œã€ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ | æœªç€æ‰‹ |

#### J.5 é˜²è¡›ãƒ»èª¿é”æƒ…å ±é€£æº

**å¯¾è±¡ï¼ˆÂ§3.1.3æ‹¡å……ï¼‰**:
- é˜²è¡›çœè£…å‚™åº: èª¿é”å…¬å‘Šï¼ˆHTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼‰
- ç±³DoDå¥‘ç´„: SAM.govï¼ˆæ”¿åºœèª¿é”DBï¼‰
- DTIC: Defense Technical Information Center

| ã‚½ãƒ¼ã‚¹ | æ–¹å¼ | çŠ¶æ…‹ |
|--------|------|:----:|
| é˜²è¡›çœè£…å‚™åº | HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚° | æœªç€æ‰‹ |
| SAM.gov | APIï¼ˆç„¡æ–™ï¼‰ | æœªç€æ‰‹ |
| DTIC | HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚° | æœªç€æ‰‹ |

---

### Phase K: ãƒ­ãƒ¼ã‚«ãƒ«LLMå¼·åŒ– âœ…

#### K.1 3Bå˜ä¸€ãƒ¢ãƒ‡ãƒ«åŒ– âœ…

**ç›®çš„**: ãƒ­ãƒ¼ã‚«ãƒ«LLMã‚’3B/7Bã®2ãƒ¢ãƒ‡ãƒ«ä½“åˆ¶ã‹ã‚‰3Bå˜ä¸€ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›´ã—ã€ã‚³ãƒ¼ãƒ‰ã‚’ç°¡ç´ åŒ–ã™ã‚‹ã€‚VRAMåˆ¶ç´„ï¼ˆ8GBï¼‰ã‚’è€ƒæ…®ã—ã€3Bãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã€‚

**å¤‰æ›´å†…å®¹**:
- [x] ä»•æ§˜æ›¸ãƒ»å®Ÿè£…è¨ˆç”»æ›¸ä¿®æ­£: docs/REQUIREMENTS.mdã¨docs/IMPLEMENTATION_PLAN.mdã‚’æ›´æ–°
- [x] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£: `config/settings.yaml`ã¨`src/utils/config.py`ã‚’æ›´æ–°
- [x] LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ä¿®æ­£: `src/filter/ollama_provider.py`ã‚’æ›´æ–°
- [x] LLMæŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£: `src/filter/llm.py`ã‹ã‚‰`use_slow_model`ã¨`should_promote_to_slow_model()`ã‚’å‰Šé™¤
- [x] ä¸»å¼µåˆ†è§£ä¿®æ­£: `src/filter/claim_decomposition.py`ã‹ã‚‰`use_slow_model`ã‚’å‰Šé™¤
- [x] ã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ä¿®æ­£: `src/scheduler/jobs.py`ã§`LLM_FAST`/`LLM_SLOW`ã‚’`LLM`ã«çµ±åˆ
- [x] Calibratoré–¢é€£å‰Šé™¤: `src/utils/calibration.py`ã‹ã‚‰`EscalationDecider`ã‚’å‰Šé™¤
- [x] å‘¼ã³å‡ºã—å´ä¿®æ­£: `src/research/executor.py`ç­‰ã§`use_slow_model`ã‚’å‰Šé™¤
- [x] ãƒ†ã‚¹ãƒˆä¿®æ­£: `tests/`é…ä¸‹ã®`fast_model`/`slow_model`é–¢é€£ãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£

**VRAMä½¿ç”¨é‡ï¼ˆæ¨å®šï¼‰**:
- 3Bï¼ˆç´„2.5GBï¼‰+ åŸ‹ã‚è¾¼ã¿ï¼ˆç´„1GBï¼‰+ ãƒªãƒ©ãƒ³ã‚«ãƒ¼ï¼ˆç´„1GBï¼‰+ NLIï¼ˆç´„0.5GBï¼‰= ç´„5GBï¼ˆä½™è£•ã‚ã‚Šï¼‰

#### K.2 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤–éƒ¨åŒ– âœ…

**ç›®çš„**: LLMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’Pythonã‚³ãƒ¼ãƒ‰ã‹ã‚‰å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆJinja2ï¼‰ã«åˆ†é›¢ã—ã€ä¿å®ˆæ€§ã¨æŸ”è»Ÿæ€§ã‚’å‘ä¸Šã€‚

**å®Ÿè£…å†…å®¹**:

| é …ç›® | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ |
|------|---------|:----:|
| ä¾å­˜é–¢ä¿‚ | `requirements-mcp.txt` (jinja2>=3.1.0è¿½åŠ ) | âœ… |
| PromptManager | `src/utils/prompt_manager.py` | âœ… |
| extract_facts | `config/prompts/extract_facts.j2` | âœ… |
| extract_claims | `config/prompts/extract_claims.j2` | âœ… |
| summarize | `config/prompts/summarize.j2` | âœ… |
| translate | `config/prompts/translate.j2` | âœ… |
| decompose | `config/prompts/decompose.j2` | âœ… |
| llm.pyä¿®æ­£ | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®šæ•°å‰Šé™¤ã€`render_prompt()`ä½¿ç”¨ | âœ… |
| claim_decomposition.pyä¿®æ­£ | `DECOMPOSE_PROMPT`å‰Šé™¤ã€`render_prompt()`ä½¿ç”¨ | âœ… |

**ãƒ†ã‚¹ãƒˆ**: `tests/test_prompt_manager.py`ï¼ˆ45ä»¶ï¼‰

**ä½¿ç”¨æ–¹æ³•**:
```python
from src.utils.prompt_manager import render_prompt

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
prompt = render_prompt("extract_facts", text="...")
prompt = render_prompt("extract_claims", text="...", context="ãƒªã‚µãƒ¼ãƒã‚¯ã‚¨ã‚¹ãƒãƒ§ãƒ³")
```

**æ³¨æ„**: L4æ¤œå‡ºç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ`EXTRACT_FACTS_INSTRUCTION`ç­‰ï¼‰ã¯`TASK_INSTRUCTIONS`è¾æ›¸ã§ç®¡ç†ã•ã‚Œã¦ãŠã‚Šã€å¤–éƒ¨åŒ–å¯¾è±¡å¤–ã€‚

#### K.3 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­– âœ…

åé›†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å«ã¾ã‚Œã‚‹æ‚ªæ„ã‚ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«LLMã‚’é˜²å¾¡ã™ã‚‹å¤šå±¤é˜²å¾¡ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**é˜²å¾¡å±¤ã‚µãƒãƒª**:

| å±¤ | ç›®çš„ | çŠ¶æ…‹ |
|----|------|:----:|
| L1: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢ | LLMã‹ã‚‰å¤–éƒ¨ã¸ã®ç›´æ¥é€ä¿¡ã‚’é®æ–­ | âœ… |
| L2: å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚º | å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³ã®é™¤å» | âœ… |
| L3: ã‚¿ã‚°åˆ†é›¢ | ã‚·ã‚¹ãƒ†ãƒ /ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®åˆ†é›¢ | âœ… |
| L4: å‡ºåŠ›æ¤œè¨¼ | URL/IP/ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–­ç‰‡ã®æ¤œå‡º | âœ… |
| L5: MCPå¿œç­”ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ | ä¿¡é ¼åº¦æƒ…å ±ã®ä»˜ä¸ | âœ… |
| L6: ã‚½ãƒ¼ã‚¹æ¤œè¨¼ãƒ•ãƒ­ãƒ¼ | è‡ªå‹•æ˜‡æ ¼/é™æ ¼ | âœ… |
| **L7: MCPå¿œç­”ã‚µãƒ‹ã‚¿ã‚¤ã‚º** | Cursor AIçµŒç”±æµå‡ºé˜²æ­¢ | âœ… |
| **L8: ãƒ­ã‚°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | ãƒ­ã‚°/DB/ã‚¨ãƒ©ãƒ¼ã‹ã‚‰ã®æ¼æ´©é˜²æ­¢ | âœ… |

##### K.3.1 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢ï¼ˆL1ï¼‰âœ…

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| Ollamaå†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å°‚ç”¨åŒ– | `podman-compose.yml`ä¿®æ­£ | âœ… |
| å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹é®æ–­ | `internal: true` è¨­å®š | âœ… |
| ãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒˆå…¬é–‹ç¦æ­¢ | `ports`ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤ | âœ… |

##### K.3.2 ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ï¼ˆL3ï¼‰âœ…

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ãƒ©ãƒ³ãƒ€ãƒ ã‚¿ã‚°ç”Ÿæˆ | `src/filter/llm_security.py` | âœ… |
| ã‚¿ã‚°ã®ãƒ­ã‚°éå‡ºåŠ› | ãƒãƒƒã‚·ãƒ¥å…ˆé ­8æ–‡å­—ã®ã¿DEBUGå‡ºåŠ› | âœ… |
| ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ”¹ä¿® | `src/filter/llm.py` | âœ… |

##### K.3.3 å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆL2ï¼‰âœ…

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| Unicode NFKCæ­£è¦åŒ– | `sanitize_llm_input()` | âœ… |
| HTMLã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ‡ã‚³ãƒ¼ãƒ‰ | åŒä¸Š | âœ… |
| ã‚¼ãƒ­å¹…æ–‡å­—é™¤å» | åŒä¸Š | âœ… |
| åˆ¶å¾¡æ–‡å­—é™¤å» | åŒä¸Š | âœ… |
| ã‚¿ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³é™¤å» | `LYRA-`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ | âœ… |
| å±é™ºå˜èªæ¤œå‡ºãƒ»è­¦å‘Š | ãƒ­ã‚°å‡ºåŠ› | âœ… |
| å…¥åŠ›é•·åˆ¶é™ | 4000æ–‡å­— | âœ… |

##### K.3.4 å‡ºåŠ›æ¤œè¨¼ï¼ˆL4ï¼‰âœ…

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| å¤–éƒ¨URLãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º | `validate_llm_output()` | âœ… |
| IPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º | åŒä¸Š | âœ… |
| ç•°å¸¸é•·å‡ºåŠ›åˆ‡ã‚Šæ¨ã¦ | æœŸå¾…é•·ã®10å€è¶… | âœ… |
| **ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–­ç‰‡æ¤œå‡º** | `detect_prompt_leakage()` | âœ… |
| **æ–­ç‰‡ãƒã‚¹ã‚¯å‡¦ç†** | `mask_prompt_fragments()` | âœ… |

**å®Ÿè£…å†…å®¹ï¼ˆÂ§4.4.1 L4å¼·åŒ–ï¼‰**:
- n-gramä¸€è‡´æ¤œå‡ºï¼ˆé€£ç¶š20æ–‡å­—ä»¥ä¸Šï¼‰
- ã‚¿ã‚°åãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºï¼ˆ`LYRA-`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰
- æ¤œå‡ºæ™‚ã®ãƒã‚¹ã‚¯å‡¦ç†ï¼ˆ`[REDACTED]`ç½®æ›ï¼‰
- æ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆã®ç›£æŸ»ãƒ­ã‚°å‡ºåŠ›
- `LeakageDetectionResult`ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹è¿½åŠ 
- `OutputValidationResult`ã«`leakage_detected`, `leakage_result`, `was_masked`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- `LLMSecurityContext`ã«`_leakage_count`ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¿½åŠ 
- `llm_extract()`ã«å‡ºåŠ›æ¤œè¨¼ã‚’çµ±åˆ

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/filter/llm_security.py`: `detect_prompt_leakage()`, `mask_prompt_fragments()` è¿½åŠ 
- `src/filter/llm.py`: å‡ºåŠ›å‡¦ç†ã«æ–­ç‰‡æ¤œå‡ºã‚’çµ„ã¿è¾¼ã¿
- `tests/test_llm_security.py`: L4å¼·åŒ–ãƒ†ã‚¹ãƒˆ22ä»¶è¿½åŠ 

##### K.3.5 MCPå¿œç­”ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆL5ï¼‰âœ…

å…¨MCPå¿œç­”ã«æ¤œè¨¼çŠ¶æ…‹ã‚’ä»˜ä¸ã—ã€Cursor AIãŒä¿¡é ¼åº¦ã‚’åˆ¤æ–­å¯èƒ½ã«ã™ã‚‹ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| `_lyra_meta` ä»˜ä¸ | `src/mcp/response_meta.py` (æ–°è¦) | âœ… |
| claimæ¤œè¨¼çŠ¶æ…‹ä»˜ä¸ | `source_domain_category`, `verification_status` | âœ… |
| `create_task` å¿œç­”æ‹¡å¼µ | `src/mcp/server.py` | âœ… |
| `get_status` å¿œç­”æ‹¡å¼µ | `src/mcp/server.py` | âœ… |

**å®Ÿè£…å†…å®¹:**
- `src/mcp/response_meta.py`: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
  - `VerificationStatus` enum: pending/verified/rejected
  - `LyraMeta` dataclass: timestamp, security_warnings, blocked_domains, unverified_domains
  - `ClaimMeta` dataclass: per-claimæ¤œè¨¼æƒ…å ±
  - `ResponseMetaBuilder`: æµæš¢ãªãƒ“ãƒ«ãƒ€ãƒ¼API
  - `attach_meta()`, `create_minimal_meta()`: ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
- `src/mcp/server.py`: `create_task`, `get_status`ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«`_lyra_meta`è¿½åŠ 

**ãƒ†ã‚¹ãƒˆ:** `tests/test_response_meta.py` (16ä»¶)

##### K.3.6 ã‚½ãƒ¼ã‚¹æ¤œè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆL6ï¼‰âœ…

EvidenceGraphé€£æºã«ã‚ˆã‚‹è‡ªå‹•æ¤œè¨¼ã¨æ˜‡æ ¼/é™æ ¼ãƒ­ã‚¸ãƒƒã‚¯ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ | `src/filter/source_verification.py` (æ–°è¦) | âœ… |
| EvidenceGraphé€£æº | `calculate_claim_confidence`, `find_contradictions` åˆ©ç”¨ | âœ… |
| è‡ªå‹•æ˜‡æ ¼ï¼ˆâ†’LOWï¼‰ | ç‹¬ç«‹ã‚½ãƒ¼ã‚¹â‰¥2, çŸ›ç›¾ãªã— | âœ… |
| è‡ªå‹•é™æ ¼ï¼ˆâ†’BLOCKEDï¼‰ | çŸ›ç›¾æ¤œå‡º/å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³ | âœ… |
| ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼çŠ¶æ…‹è¿½è·¡ | `DomainVerificationState` | âœ… |

**å®Ÿè£…å†…å®¹:**
- `src/filter/source_verification.py`: ã‚½ãƒ¼ã‚¹æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
  - `SourceVerifier` ã‚¯ãƒ©ã‚¹: æ¤œè¨¼ã®ä¸­å¿ƒ
  - `verify_claim()`: EvidenceGraphã‚’ä½¿ã£ãŸæ¤œè¨¼
  - `_determine_verification_outcome()`: æ˜‡æ ¼/é™æ ¼åˆ¤å®š
  - `DomainVerificationState`: ãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã®æ¤œè¨¼çŠ¶æ…‹è¿½è·¡
  - `build_response_meta()`: MCPå¿œç­”ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
- æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯:
  - ç‹¬ç«‹ã‚½ãƒ¼ã‚¹â‰¥2 + çŸ›ç›¾ãªã— â†’ `VERIFIED`, `UNVERIFIED`â†’`LOW`ã«æ˜‡æ ¼
  - çŸ›ç›¾æ¤œå‡º or å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³ â†’ `REJECTED`, `BLOCKED`ã«é™æ ¼
  - è¨¼æ‹ ä¸è¶³ â†’ `PENDING`, trust levelç¶­æŒ
- ä¿¡é ¼åº¦ã®é«˜ã„ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆTRUSTEDä»¥ä¸Šï¼‰ã¯è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„

**ãƒ†ã‚¹ãƒˆ:** `tests/test_source_verification.py` (27ä»¶)

##### K.3.7 DomainCategoryå¤‰æ›´ âœ…

`UNKNOWN` / `SUSPICIOUS` ã‚’å»ƒæ­¢ã—ã€æ¤œè¨¼çŠ¶æ…‹ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚ã¾ãŸ`DomainCategory`ã¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°èª¿æ•´å°‚ç”¨ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºåŒ–ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| DomainCategory enumå†å®šç¾© | `src/utils/domain_policy.py` | âœ… |
| ã‚«ãƒ†ã‚´ãƒªã‚¦ã‚§ã‚¤ãƒˆæ›´æ–° | `CATEGORY_WEIGHTS` | âœ… |
| domains.yamlæ›´æ–° | `config/domains.yaml` | âœ… |

**å®Ÿè£…å†…å®¹:**
- DomainCategory enumå¤‰æ›´:
  - å»ƒæ­¢: `UNKNOWN`, `SUSPICIOUS`
  - è¿½åŠ : `LOW` (æ¤œè¨¼æ¸ˆã¿ä½ä¿¡é ¼), `UNVERIFIED` (æœªæ¤œè¨¼), `BLOCKED` (é™¤å¤–)
- æ–°ã—ã„ã‚¦ã‚§ã‚¤ãƒˆï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°èª¿æ•´ç”¨ï¼‰:
  - PRIMARY: 1.0, GOVERNMENT: 0.95, ACADEMIC: 0.90, TRUSTED: 0.75
  - LOW: 0.40, UNVERIFIED: 0.30, BLOCKED: 0.0
- å½±éŸ¿ç¯„å›²: `DomainCategory`ã¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°èª¿æ•´ã®ã¿ã«ä½¿ç”¨ã€‚ä¿¡é ¼åº¦è¨ˆç®—ã‚„æ¤œè¨¼åˆ¤å®šã«ã¯ä½¿ç”¨ã—ãªã„ã€‚

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/utils/domain_policy.py`: DomainCategory enumå†å®šç¾©, CATEGORY_WEIGHTSæ›´æ–°
- `config/domains.yaml`: default domain_category ã‚’ `"unverified"` ã«å¤‰æ›´
- `tests/test_domain_policy.py`: ãƒ†ã‚¹ãƒˆã®æœŸå¾…å€¤æ›´æ–°

##### K.3.8 BLOCKEDé€šçŸ¥ï¼ˆInterventionQueueé€£æºï¼‰âœ…

ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒBLOCKEDã«ãªã£ãŸéš›ã®é€šçŸ¥æ©Ÿèƒ½ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| `auth_type="domain_blocked"` è¿½åŠ  | `src/utils/notification.py` | âœ… |
| BLOCKEDæ™‚ã®é€šçŸ¥å‘¼ã³å‡ºã— | `src/filter/source_verification.py` | âœ… |
| Cursor AIã¸ã®å¿œç­” | `domain_blocked` æƒ…å ±ã‚’å«ã‚ã‚‹ | âœ… |

**å®Ÿè£…å†…å®¹:**
- `InterventionType.DOMAIN_BLOCKED` enumè¿½åŠ 
- `notify_user(event="domain_blocked")` ã§InterventionQueue.enqueueå‘¼ã³å‡ºã—
- `notify_domain_blocked()` ä¾¿åˆ©é–¢æ•°è¿½åŠ 
- `SourceVerifier._queue_blocked_notification()` ã§ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°
- `SourceVerifier.send_pending_notifications()` ã§éåŒæœŸé€ä¿¡
- é‡è¤‡é˜²æ­¢ï¼ˆåŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯1å›ã®ã¿é€šçŸ¥ï¼‰
- ãƒ†ã‚¹ãƒˆ13ä»¶è¿½åŠ ï¼ˆnotification: 5ä»¶, source_verification: 8ä»¶ï¼‰

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/utils/notification.py`: InterventionQueueæ‹¡å¼µï¼ˆæ–°auth_typeè¿½åŠ ï¼‰
- `src/filter/source_verification.py`: BLOCKEDæ™‚ã®é€šçŸ¥å‘¼ã³å‡ºã—

##### K.3.9 MCPå¿œç­”ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆL7ï¼‰âœ…

MCPå¿œç­”ãŒCursor AIã«æ¸¡ã‚‹å‰ã®æœ€çµ‚ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã€‚Cursor AIçµŒç”±ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæµå‡ºã‚’é˜²æ­¢ã™ã‚‹ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| å¿œç­”ã‚¹ã‚­ãƒ¼ãƒå®šç¾© | `src/mcp/schemas/` (JSONSchema) | âœ… |
| ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ | `ResponseSanitizer.validate_schema()` | âœ… |
| äºˆæœŸã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é™¤å» | `ResponseSanitizer.strip_unknown_fields()` | âœ… |
| LLMãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®L4é€šéå¼·åˆ¶ | `ResponseSanitizer.sanitize_llm_fields()` | âœ… |
| ã‚¨ãƒ©ãƒ¼å¿œç­”ã‚µãƒ‹ã‚¿ã‚¤ã‚º | `ResponseSanitizer.sanitize_error()` | âœ… |
| MCPãƒãƒ³ãƒ‰ãƒ©ã¸ã®çµ±åˆ | `src/mcp/server.py` å„ãƒãƒ³ãƒ‰ãƒ©ã®å‡ºå£ | âœ… |

**è¨­è¨ˆæ–¹é‡**:
- allowlistæ–¹å¼: å®šç¾©æ¸ˆã¿ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿é€šéã€æœªå®šç¾©ã¯é™¤å»
- LLMç”Ÿæˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ`extracted_facts`, `claims`, `summary`ç­‰ï¼‰ã¯å¿…ãš`validate_llm_output()`ã‚’é€šé
- ã‚¨ãƒ©ãƒ¼å¿œç­”ã¯æ±ç”¨åŒ–ã—ã€è©³ç´°ã¯`error_id`ã§ãƒ­ã‚°å‚ç…§

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- æ–°è¦ `src/mcp/response_sanitizer.py`: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒ­ã‚¸ãƒƒã‚¯
- æ–°è¦ `src/mcp/schemas/`: å„MCPãƒ„ãƒ¼ãƒ«ã®å¿œç­”ã‚¹ã‚­ãƒ¼ãƒï¼ˆJSONSchemaï¼‰
- `src/mcp/server.py`: å…¨ãƒãƒ³ãƒ‰ãƒ©ã®å‡ºå£ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒ¬ã‚¤ãƒ¤è¿½åŠ 

**ã‚¹ã‚­ãƒ¼ãƒä¾‹ï¼ˆsearchï¼‰**:
```json
{
  "type": "object",
  "properties": {
    "ok": {"type": "boolean"},
    "search_id": {"type": "string"},
    "query": {"type": "string"},
    "status": {"enum": ["satisfied", "partial", "exhausted"]},
    "pages_fetched": {"type": "integer"},
    "useful_fragments": {"type": "integer"},
    "harvest_rate": {"type": "number"},
    "claims_found": {"type": "array"},
    "satisfaction_score": {"type": "number"},
    "novelty_score": {"type": "number"},
    "budget_remaining": {"type": "object"},
    "_lyra_meta": {"type": "object"}
  },
  "additionalProperties": false
}
```

##### K.3.10 ãƒ­ã‚°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ï¼ˆL8ï¼‰âœ…

ãƒ­ã‚°ãƒ»DBãƒ»ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã®æƒ…å ±æ¼æ´©é˜²æ­¢ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| LLMå…¥å‡ºåŠ›ãƒ­ã‚°ã®ã‚µãƒãƒªåŒ– | `SecureLogger.log_llm_io()` | âœ… |
| ä¾‹å¤–ã‚µãƒ‹ã‚¿ã‚¤ã‚º | `SecureLogger.log_exception()` | âœ… |
| DBã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆéä¿å­˜ | `src/storage/` ç¢ºèªæ¸ˆã¿ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿å­˜ãªã—ï¼‰ | âœ… |
| ç›£æŸ»ãƒ­ã‚°ï¼ˆæ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆï¼‰ | `AuditLogger.log_security_event()` | âœ… |
| structlogçµ±åˆ | `sanitize_log_processor` | âœ… |

**ãƒ­ã‚°å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
```python
# Before (ç¦æ­¢)
logger.debug("LLM input", prompt=full_prompt_text)

# After (è¨±å¯)
logger.debug("LLM input", 
    prompt_hash="abc123...",
    prompt_length=1500,
    prompt_preview="..."  # å…ˆé ­100æ–‡å­—ã®ã¿
)
```

**ä¾‹å¤–ã‚µãƒ‹ã‚¿ã‚¤ã‚ºä¾‹**:
```python
try:
    result = llm.extract(prompt)
except Exception as e:
    # å†…éƒ¨ãƒ­ã‚°ï¼ˆè©³ç´°ã‚ã‚Šï¼‰
    internal_logger.error("LLM extraction failed", 
        error_id="err_abc123",
        exception=str(e),
        traceback=traceback.format_exc()
    )
    # MCPå¿œç­”ï¼ˆè©³ç´°ãªã—ï¼‰
    return {"ok": False, "error": "Internal processing error", "error_id": "err_abc123"}
```

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- æ–°è¦ `src/utils/secure_logging.py`: `SecureLogger`, `AuditLogger`
- `src/filter/llm.py`: ãƒ­ã‚°å‡ºåŠ›ã‚’SecureLoggerçµŒç”±ã«å¤‰æ›´
- `src/mcp/server.py`: ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºé©ç”¨
- `src/storage/`: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿å­˜ç®‡æ‰€ã®ç¢ºèªãƒ»ä¿®æ­£

##### K.3.11 ãƒ†ã‚¹ãƒˆ

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL2/L3/L4åŸºæœ¬ï¼‰ | `tests/test_llm_security.py` | âœ… |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL4å¼·åŒ–: æ–­ç‰‡æ¤œå‡ºï¼‰ | `tests/test_llm_security.py` è¿½åŠ  | âœ… |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL5: MCPå¿œç­”ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰ | `tests/test_response_meta.py` | âœ… (30ä»¶, 100%ã‚«ãƒãƒ¬ãƒƒã‚¸) |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL6: ã‚½ãƒ¼ã‚¹æ¤œè¨¼ãƒ•ãƒ­ãƒ¼ï¼‰ | `tests/test_source_verification.py` | âœ… (43ä»¶, 100%ã‚«ãƒãƒ¬ãƒƒã‚¸) |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL7: MCPå¿œç­”ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼‰ | `tests/test_response_sanitizer.py` | âœ… (29ä»¶) |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL8: ãƒ­ã‚°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰ | `tests/test_secure_logging.py` | âœ… (27ä»¶) |
| E2E: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢æ¤œè¨¼ | Ollamaã‹ã‚‰å¤–éƒ¨é€šä¿¡ä¸å¯ã‚’ç¢ºèª | âœ… |
| E2E: LLMå¿œç­”æ¤œè¨¼ | ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã®æ­£å¸¸å‹•ä½œ | âœ… |
| E2E: ã‚¿ã‚°åˆ†é›¢åŠ¹æœæ¤œè¨¼ | ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã®å½±éŸ¿ç¢ºèª | âœ… |
| E2E: MCPå¿œç­”æµå‡ºæ¤œè¨¼ | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–­ç‰‡ãŒMCPå¿œç­”ã«å«ã¾ã‚Œãªã„ã“ã¨ã‚’ç¢ºèª | âœ… |

**L7ãƒ†ã‚¹ãƒˆè¦³ç‚¹**:
- ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼: ä¸æ­£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒé™¤å»ã•ã‚Œã‚‹ã“ã¨
- LLMãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–­ç‰‡ãŒæ¤œå‡ºãƒ»ãƒã‚¹ã‚¯ã•ã‚Œã‚‹ã“ã¨
- ã‚¨ãƒ©ãƒ¼å¿œç­”: ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ»å†…éƒ¨ãƒ‘ã‚¹ãŒå«ã¾ã‚Œãªã„ã“ã¨
- æ­£å¸¸å¿œç­”: å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ¬ è½ã—ãªã„ã“ã¨

**L8ãƒ†ã‚¹ãƒˆè¦³ç‚¹**:
- ãƒ­ã‚°å‡ºåŠ›: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ¬æ–‡ãŒè¨˜éŒ²ã•ã‚Œãªã„ã“ã¨
- ä¾‹å¤–å‡¦ç†: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå®‰å…¨ã§ã‚ã‚‹ã“ã¨
- ç›£æŸ»ãƒ­ã‚°: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆãŒè¨˜éŒ²ã•ã‚Œã‚‹ã“ã¨

**æ³¨**: E2Eãƒ†ã‚¹ãƒˆã¯GPUç’°å¢ƒã§å®Ÿè¡ŒãŒå¿…è¦ã€‚`tests/scripts/verify_llm_security.py`ã¨ã—ã¦å®Ÿè£…äºˆå®šã€‚

#### K.4 MLãƒ¢ãƒ‡ãƒ«ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢ âœ…

**çŠ¶æ…‹**: **å®Ÿè£…å®Œäº†ãƒ»å‹•ä½œç¢ºèªæ¸ˆã¿** - MLã‚µãƒ¼ãƒãƒ¼ã¯æ­£å¸¸ã«æ©Ÿèƒ½ã—ã¦ãŠã‚Šã€E2Eãƒ†ã‚¹ãƒˆã§å…¨æ©Ÿèƒ½ã‚’æ¤œè¨¼æ¸ˆã¿ã€‚

**ç›®çš„**: åŸ‹ã‚è¾¼ã¿ãƒ»ãƒªãƒ©ãƒ³ã‚«ãƒ¼ãƒ»NLIãƒ¢ãƒ‡ãƒ«ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã™ã‚‹ã€‚

**èƒŒæ™¯**:
K.1ã®èª¿æŸ»ã§ä»¥ä¸‹ãŒåˆ¤æ˜:
- åŸ‹ã‚è¾¼ã¿ï¼ˆbge-m3ï¼‰ã€ãƒªãƒ©ãƒ³ã‚«ãƒ¼ï¼ˆbge-reranker-v2-m3ï¼‰ã€NLIï¼ˆDeBERTaï¼‰ã¯Lyraã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ
- ã“ã‚Œã‚‰ã¯HuggingFaceã‹ã‚‰åˆå›ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã€å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ä¸è¦
- Ollamaã¨åŒæ§˜ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢ã™ã¹ã

**å®Ÿè£…æ–¹é‡**:
- åŸ‹ã‚è¾¼ã¿ãƒ»ãƒªãƒ©ãƒ³ã‚«ãƒ¼ãƒ»NLIã‚’ã€ŒMLã‚³ãƒ³ãƒ†ãƒŠã€ã«é›†ç´„
- Ollamaã¨åŒã˜`lyra-internal`ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆ`internal: true`ï¼‰ã«é…ç½®
- Lyraã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«
- ãƒ¢ãƒ‡ãƒ«ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã‚ã‚‹

**ã‚¿ã‚¹ã‚¯**:
- [x] ä»•æ§˜æ›¸ã«MLãƒ¢ãƒ‡ãƒ«ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–¹é‡ã‚’è¿½è¨˜ï¼ˆdocs/REQUIREMENTS.md L1ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- [x] MLã‚³ãƒ³ãƒ†ãƒŠç”¨Dockerfileä½œæˆï¼ˆ`Dockerfile.ml`ï¼‰
- [x] `podman-compose.yml`ã«MLã‚³ãƒ³ãƒ†ãƒŠè¿½åŠ ï¼ˆ`lyra-ml`ã‚µãƒ¼ãƒ“ã‚¹ï¼‰
- [x] `lyra-internal`ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¿½åŠ ï¼ˆ`internal: true`ã€Ollamaã¨å…±ç”¨ï¼‰
- [x] åŸ‹ã‚è¾¼ã¿ãƒ»ãƒªãƒ©ãƒ³ã‚«ãƒ¼ãƒ»NLIã®APIåŒ–ï¼ˆ`src/ml_server/` FastAPIï¼‰
- [x] Lyraã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰MLã‚³ãƒ³ãƒ†ãƒŠã¸ã®é€šä¿¡å®Ÿè£…ï¼ˆ`src/ml_client.py`ï¼‰
- [x] æ—¢å­˜ã®`ranking.py`/`nli.py`ã‚’ãƒªãƒ¢ãƒ¼ãƒˆå‘¼ã³å‡ºã—ã«å¯¾å¿œ
- [x] `.env`ã«MLè¨­å®šè¿½åŠ ã€`config.py`ã«`MLServerConfig`è¿½åŠ 

**å®Ÿè£…æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `Dockerfile.ml` - MLã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒ†ãƒŠï¼ˆãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
- `requirements-ml.txt` - MLä¾å­˜é–¢ä¿‚
- `scripts/download_models.py` - ãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `src/ml_server/` - FastAPIã‚µãƒ¼ãƒãƒ¼ï¼ˆembed/rerank/nli ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- `src/ml_client.py` - HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

**å®Ÿè£…å®Œäº†**:
- [x] MLã‚µãƒ¼ãƒãƒ¼ã®å…¨æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œï¼ˆE2Eãƒ†ã‚¹ãƒˆã§æ¤œè¨¼æ¸ˆã¿ï¼‰
  - åŸ‹ã‚è¾¼ã¿APIï¼ˆbge-m3ï¼‰: âœ… å‹•ä½œç¢ºèªæ¸ˆã¿
  - ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°APIï¼ˆbge-reranker-v2-m3ï¼‰: âœ… å‹•ä½œç¢ºèªæ¸ˆã¿
  - NLI APIï¼ˆnli-deberta-v3-xsmall/smallï¼‰: âœ… å‹•ä½œç¢ºèªæ¸ˆã¿
  - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰: âœ… å‹•ä½œç¢ºèªæ¸ˆã¿ï¼ˆHuggingFace APIå‘¼ã³å‡ºã—ãªã—ï¼‰
- [x] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰å•é¡Œã®è§£æ±º
  - è§£æ±ºæ–¹æ³•: `huggingface_hub.snapshot_download()`ã§ãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ã‚¹ã‚’å–å¾—ã—ã€`model_paths.json`ã«ä¿å­˜
  - `src/ml_server/model_paths.py`ã§ãƒ‘ã‚¹ç®¡ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å®Ÿè£…
  - å„ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆembedding/reranker/nliï¼‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ã‚¹æŒ‡å®šã«å¤‰æ›´
  - `download_models.py`ã‚’ä¿®æ­£ã—ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã‚‚æ—¢å­˜ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ãƒ‘ã‚¹ã‚’å–å¾—å¯èƒ½ã«
- [x] ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆ
  - `tests/test_ml_server.py`: 32ä»¶ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆmodel_paths, embedding, reranker, nliï¼‰
    - MLä¾å­˜é–¢ä¿‚ãŒãªã„å ´åˆã¯é©åˆ‡ã«ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ12ä»¶ã‚¹ã‚­ãƒƒãƒ—ã€20ä»¶ãƒ‘ã‚¹ï¼‰
    - ã‚¹ã‚­ãƒƒãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§E2Eãƒ†ã‚¹ãƒˆã‚’æ¨å¥¨
  - `tests/test_ml_server_e2e.py`: E2Eãƒ†ã‚¹ãƒˆï¼ˆAPIçµ±åˆãƒ†ã‚¹ãƒˆã€6ä»¶å…¨ã¦ãƒ‘ã‚¹ï¼‰
    - HTTPçµŒç”±ã§MLã‚µãƒ¼ãƒãƒ¼ã‚’æ¤œè¨¼ï¼ˆæ¨å¥¨æ–¹æ³•ï¼‰
- [x] E2Eå‹•ä½œç¢ºèª
  - ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å‹•ä½œç¢ºèªæ¸ˆã¿
  - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
  - åŸ‹ã‚è¾¼ã¿APIå‹•ä½œç¢ºèªæ¸ˆã¿
  - ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°APIå‹•ä½œç¢ºèªæ¸ˆã¿
  - NLI APIå‹•ä½œç¢ºèªæ¸ˆã¿
- [x] ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã®æ”¹å–„
  - MLä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ ï¼ˆ`_HAS_SENTENCE_TRANSFORMERS`, `_HAS_TRANSFORMERS`ï¼‰
  - ã‚¹ã‚­ãƒƒãƒ—ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ï¼ˆ`@requires_sentence_transformers`, `@requires_transformers`ï¼‰ã‚’è¿½åŠ 
  - æ˜ç¢ºãªã‚¹ã‚­ãƒƒãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§E2Eãƒ†ã‚¹ãƒˆã‚’æ¨å¥¨
  - E2Eãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®éåŒæœŸå¯¾å¿œã‚’ä¿®æ­£ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ç«¶åˆã‚’è§£æ¶ˆï¼‰

**çŸ¥è¦‹ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**:

1. **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰å•é¡Œ**
   - **å•é¡Œ**: `HF_HUB_OFFLINE=1`ã¨`local_files_only=True`ã‚’è¨­å®šã—ã¦ã‚‚ã€`sentence-transformers`ã‚„`transformers`ãŒHuggingFace APIã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ã‚‹
   - **åŸå› **: ãƒ¢ãƒ‡ãƒ«åï¼ˆä¾‹: `BAAI/bge-m3`ï¼‰ã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã¨ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå†…éƒ¨ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ãŸã‚APIã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ã‚‹
   - **è§£æ±ºç­–**: 
     - `huggingface_hub.snapshot_download()`ã§ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ã‚¹ã‚’å–å¾—
     - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ã‚¹ã‚’`model_paths.json`ã«ä¿å­˜ã—ã€å®Ÿè¡Œæ™‚ã«ã“ã®ãƒ‘ã‚¹ã‚’ç›´æ¥ä½¿ç”¨
     - ãƒ‘ã‚¹ã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒAPIã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ãªã„
   - **å®Ÿè£…**: `download_models.py`ã§ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰æ™‚ã¯`try_to_load_from_cache()`ã§æ—¢å­˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ‘ã‚¹ã‚’å–å¾—

2. **ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è¨­è¨ˆã®çŸ¥è¦‹**
   - **ãƒ¢ãƒƒã‚¯ãƒ‘ãƒƒãƒã®ãƒ‘ã‚¹æŒ‡å®š**: `src.ml_server.embedding.SentenceTransformer`ã§ã¯ãªãã€`sentence_transformers.SentenceTransformer`ã‚’ãƒ‘ãƒƒãƒã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒã‚’ç›´æ¥ãƒ‘ãƒƒãƒï¼‰
   - **GPUé–¢é€£ã®ãƒ¢ãƒƒã‚¯**: `SentenceTransformer`ã®`to("cuda")`å‘¼ã³å‡ºã—ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€`mock_model.to = MagicMock(return_value=mock_model)`ã‚’è¨­å®š
   - **MLä¾å­˜é–¢ä¿‚ã®ã‚¹ã‚­ãƒƒãƒ—å‡¦ç†**: MLä¾å­˜é–¢ä¿‚ï¼ˆ`sentence_transformers`, `transformers`ï¼‰ãŒãªã„å ´åˆã€ãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€E2Eãƒ†ã‚¹ãƒˆã‚’æ¨å¥¨ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
     - `@requires_sentence_transformers` / `@requires_transformers` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’å®Ÿè£…
     - ã‚¹ã‚­ãƒƒãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã€ŒUse E2E tests (test_ml_server_e2e.py) for ML validationã€ã‚’æ˜ç¤º
   - **E2Eãƒ†ã‚¹ãƒˆã®æ¨å¥¨**: MLã‚µãƒ¼ãƒãƒ¼ã®æ¤œè¨¼ã¯E2Eãƒ†ã‚¹ãƒˆï¼ˆHTTPçµŒç”±ï¼‰ãŒæ¨å¥¨æ–¹æ³•
     - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£: WSL (pytest) â†’ localhost:8080 (proxy) â†’ lyra-ml:8100 (ML Server)
     - å®Ÿéš›ã®HTTPé€šä¿¡ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã€ã‚ˆã‚Šä¿¡é ¼æ€§ãŒé«˜ã„
   - **FastAPIãƒ†ã‚¹ãƒˆã®åˆ†é›¢**: ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã«ã¯FastAPIãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€FastAPI TestClientã‚’ä½¿ã†ãƒ†ã‚¹ãƒˆã¯`@pytest.mark.skip`ã§ã‚¹ã‚­ãƒƒãƒ—ã—ã€E2Eãƒ†ã‚¹ãƒˆã§ä»£æ›¿
   - **éåŒæœŸãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®ä¿®æ­£**: E2Eãƒ†ã‚¹ãƒˆã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã§`asyncio.run()`ã‚’ä½¿ã†ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ç«¶åˆãŒç™ºç”Ÿã™ã‚‹ãŸã‚ã€`async def`ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã«ã—ã¦`await client.close()`ã‚’ä½¿ç”¨

3. **æ—¢å­˜ãƒ†ã‚¹ãƒˆã®ä¿®æ­£**
   - **å•é¡Œ**: `EmbeddingRanker`ã¨`Reranker`ã®ãƒ†ã‚¹ãƒˆãŒãƒªãƒ¢ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆ`ml.use_remote=True`ï¼‰ã‚’è€ƒæ…®ã—ã¦ã„ãªã„
   - **è§£æ±ºç­–**: `use_remote=False`ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’å¼·åˆ¶ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã†ãƒ†ã‚¹ãƒˆã¨ã—ã¦å®Ÿè¡Œ
   - **å½±éŸ¿**: æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã¯ç¶­æŒã—ã¤ã¤ã€ãƒªãƒ¢ãƒ¼ãƒˆ/ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆã«å¯¾å¿œ

4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
   - **ç©ºãƒªã‚¹ãƒˆæ™‚ã®ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰å›é¿**: `encode()`ã‚„`rerank()`ã§ç©ºãƒªã‚¹ãƒˆãŒæ¸¡ã•ã‚ŒãŸå ´åˆã€æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã—ã¦ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ`await self.load()`ã®å‰ã«`if not texts: return []`ã‚’é…ç½®ï¼‰
   - **åŠ¹æœ**: ä¸è¦ãªãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰ã‚’å›é¿ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã‚’çŸ­ç¸®

5. **Dockerãƒ“ãƒ«ãƒ‰æ™‚ã®æ³¨æ„ç‚¹**
   - `model_paths.json`ã®å­˜åœ¨ç¢ºèªã‚’Dockerfileã«è¿½åŠ ï¼ˆ`RUN test -f /app/models/model_paths.json || exit 1`ï¼‰
   - `/app/models`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’äº‹å‰ã«ä½œæˆï¼ˆ`RUN mkdir -p /app/models`ï¼‰
   - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ“ãƒ«ãƒ‰æ™‚ã¯ã€äº‹å‰ã«ãƒ¢ãƒ‡ãƒ«ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹

6. **å›å¸°ãƒ†ã‚¹ãƒˆã®çµæœã¨ä¾å­˜é–¢ä¿‚è¦ä»¶**
   - **æ³¨æ„**: å›å¸°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã«ã¯ã€ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªä¾å­˜é–¢ä¿‚ã®ç¢ºèªãŒå¿…è¦
   - **ã‚³ã‚¢æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ**: WSL venvï¼ˆ`requirements-mcp.txt`ï¼‰ã®ã¿ã§å®Ÿè¡Œå¯èƒ½
   - **ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ**: ä»¥ä¸‹ã®ä¾å­˜é–¢ä¿‚ãŒå¿…è¦ï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ï¼‰
     - **MLé–¢é€£** (`requirements-ml.txt`): `sentence-transformers`, `transformers`, `torch`
       - å½±éŸ¿ãƒ†ã‚¹ãƒˆ: `tests/test_ml_server.py`ï¼ˆ`import torch`ç­‰ã®ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‰
     - **PDF/OCRé–¢é€£**: `PyMuPDF` (`fitz`), `Pillow` (`PIL`)
       - å½±éŸ¿ãƒ†ã‚¹ãƒˆ: `tests/test_extractor.py`ï¼ˆPDFæŠ½å‡ºã€OCRæ©Ÿèƒ½ï¼‰
   - **å®Ÿè£…çŠ¶æ³**:
     - MLãƒ¢ãƒ‡ãƒ«ã¯åˆ¥ã‚³ãƒ³ãƒ†ãƒŠï¼ˆ`lyra-ml`ï¼‰ã§å®Ÿè¡Œã•ã‚Œã‚‹è¨­è¨ˆã ãŒã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å†…ã§ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãŸã‚ã€WSL venvã«ã‚‚ä¾å­˜é–¢ä¿‚ãŒå¿…è¦
     - ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆã§ã‚‚ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ™‚ã«ä¾å­˜é–¢ä¿‚ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ãŸã‚ã€äº‹å‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦
   - **å›å¸°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã®ç¢ºèªã‚¿ã‚¹ã‚¯**:
     - [x] MLä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’å®Ÿè£…ï¼ˆMLä¾å­˜é–¢ä¿‚ãŒãªã„å ´åˆã¯é©åˆ‡ã«ã‚¹ã‚­ãƒƒãƒ—ï¼‰
     - [x] E2Eãƒ†ã‚¹ãƒˆã‚’æ¨å¥¨æ–¹æ³•ã¨ã—ã¦æ˜ç¢ºåŒ–ï¼ˆ`test_ml_server_e2e.py`ï¼‰
     - [ ] WSL venvã«ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ä¾å­˜é–¢ä¿‚ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
       ```bash
       # MLé–¢é€£ä¾å­˜é–¢ä¿‚ã®ç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ« - ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹ãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ¢ãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯å¿…è¦ï¼‰
       python -c "import sentence_transformers, transformers, torch" 2>/dev/null && echo "ML deps OK" || echo "ML deps MISSING"
       
       # PDF/OCRé–¢é€£ä¾å­˜é–¢ä¿‚ã®ç¢ºèª
       python -c "import fitz, PIL" 2>/dev/null && echo "PDF/OCR deps OK" || echo "PDF/OCR deps MISSING"
       ```
     - **æ³¨æ„**: MLä¾å­˜é–¢ä¿‚ãŒãªãã¦ã‚‚ã€`test_ml_server.py`ã¯20ä»¶ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã—ã€MLä¾å­˜é–¢ä¿‚ãŒå¿…è¦ãª12ä»¶ã¯é©åˆ‡ã«ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
     - **æ¨å¥¨**: MLã‚µãƒ¼ãƒãƒ¼ã®æ¤œè¨¼ã¯`pytest tests/test_ml_server_e2e.py -v -m e2e`ã‚’ä½¿ç”¨ï¼ˆMLä¾å­˜é–¢ä¿‚ä¸è¦ï¼‰
   - **éå»ã®å›å¸°ãƒ†ã‚¹ãƒˆçµæœ**ï¼ˆä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ç’°å¢ƒï¼‰:
     - å…¨2728ãƒ†ã‚¹ãƒˆãŒæˆåŠŸï¼ˆ4ãƒ†ã‚¹ãƒˆã‚¹ã‚­ãƒƒãƒ—ã€23ãƒ†ã‚¹ãƒˆé™¤å¤–ï¼‰
     - æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿ãªã—
     - MLã‚µãƒ¼ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆã¯26ä»¶æˆåŠŸã€4ä»¶ã‚¹ã‚­ãƒƒãƒ—ï¼ˆFastAPI TestClienté–¢é€£ï¼‰
   - **ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆçµæœ**ï¼ˆMLä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯å®Ÿè£…å¾Œï¼‰:
     - `test_ml_server.py`: 20 passed, 12 skippedï¼ˆMLä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹é©åˆ‡ãªã‚¹ã‚­ãƒƒãƒ—ï¼‰
     - `test_ml_server_e2e.py`: 6 passedï¼ˆMLã‚µãƒ¼ãƒãƒ¼ã®å…¨æ©Ÿèƒ½ã‚’HTTPçµŒç”±ã§æ¤œè¨¼ï¼‰
     - **MLå®Ÿè£…ã¯æ­£å¸¸ã«æ©Ÿèƒ½**: E2Eãƒ†ã‚¹ãƒˆã§åŸ‹ã‚è¾¼ã¿ãƒ»ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»NLIã®å…¨æ©Ÿèƒ½ãŒå‹•ä½œç¢ºèªæ¸ˆã¿

7. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®ä¾å­˜é–¢ä¿‚ã«ã¤ã„ã¦ï¼ˆè§£æ±ºæ¸ˆã¿ï¼‰**
   - **å•é¡Œ**: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å†…ã§ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆ`import torch`, `from PIL import Image`ç­‰ï¼‰ã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ¢ãƒƒã‚¯ã‚’ä½¿ã†å‰ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Ÿè¡Œã•ã‚Œã€ä¾å­˜é–¢ä¿‚ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã¨å¤±æ•—ã™ã‚‹
   - **è§£æ±ºç­–**: MLä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€ä¾å­˜é–¢ä¿‚ãŒãªã„å ´åˆã¯ãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—
     - `_HAS_SENTENCE_TRANSFORMERS` / `_HAS_TRANSFORMERS` ãƒ•ãƒ©ã‚°ã§ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯
     - `@requires_sentence_transformers` / `@requires_transformers` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã§ã‚¹ã‚­ãƒƒãƒ—
     - ã‚¹ã‚­ãƒƒãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§E2Eãƒ†ã‚¹ãƒˆã‚’æ¨å¥¨ï¼ˆ`test_ml_server_e2e.py`ï¼‰
   - **ç¾åœ¨ã®å‹•ä½œ**:
     - WSL venvã§`pytest tests/test_ml_server.py`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€MLä¾å­˜é–¢ä¿‚ãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆï¼ˆ8ä»¶ï¼‰ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã€æ®‹ã‚Šï¼ˆ20ä»¶ï¼‰ã¯æ­£å¸¸ã«ãƒ‘ã‚¹
     - E2Eãƒ†ã‚¹ãƒˆï¼ˆ`test_ml_server_e2e.py`ï¼‰ã¯MLä¾å­˜é–¢ä¿‚ä¸è¦ã§ã€HTTPçµŒç”±ã§MLã‚µãƒ¼ãƒãƒ¼ã‚’æ¤œè¨¼ï¼ˆ6ä»¶å…¨ã¦ãƒ‘ã‚¹ï¼‰
     - **æ¨å¥¨**: MLã‚µãƒ¼ãƒãƒ¼ã®æ¤œè¨¼ã¯E2Eãƒ†ã‚¹ãƒˆã‚’ä½¿ç”¨ï¼ˆ`pytest tests/test_ml_server_e2e.py -v -m e2e`ï¼‰
   - **å½±éŸ¿ç¯„å›²**:
     - `tests/test_ml_server.py`: MLä¾å­˜é–¢ä¿‚ãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ`sentence-transformers`, `transformers`, `torch`ï¼‰
     - `tests/test_extractor.py`: PDF/OCRé–¢é€£ãƒ†ã‚¹ãƒˆã¯æœªå¯¾å¿œï¼ˆå°†æ¥ã®æ”¹å–„æ¡ˆï¼‰
   - **ãƒ†ã‚¹ãƒˆçµæœ**:
     - Unit tests: 20 passed, 12 skippedï¼ˆMLä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹é©åˆ‡ãªã‚¹ã‚­ãƒƒãƒ—ï¼‰
     - E2E tests: 6 passedï¼ˆMLã‚µãƒ¼ãƒãƒ¼ã®å…¨æ©Ÿèƒ½ã‚’HTTPçµŒç”±ã§æ¤œè¨¼ï¼‰
   - **å®Ÿè£…è¨ˆç”»æ›¸ã®æ›´æ–°**: æœ¬ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½è¨˜ã—ã€Phase G.2ã«ã‚‚æ³¨æ„äº‹é …ã‚’è¿½åŠ ï¼ˆÂ§G.2ã€Â§G.4å‚ç…§ï¼‰

8. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–: ãƒ‘ã‚¹æ¤œè¨¼ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚º**
   - **å•é¡Œ**: `model_paths.json`ã«ä¸æ­£ãªãƒ‘ã‚¹ï¼ˆãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã€è¨±å¯å¤–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã®ãƒªã‚¹ã‚¯
   - **å¯¾ç­–**: `_validate_and_sanitize_path()`é–¢æ•°ã‚’å®Ÿè£…
     - ãƒ‘ã‚¹ã‚’çµ¶å¯¾ãƒ‘ã‚¹ã«æ­£è¦åŒ–ï¼ˆ`Path.resolve()`ï¼‰
     - `/app/models/`é…ä¸‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆ`relative_to()`ã§æ¤œè¨¼ï¼‰
     - ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ï¼ˆ`../`ï¼‰ã‚’æ¤œå‡ºãƒ»æ‹’å¦
   - **å®Ÿè£…**: `get_model_paths()`ã§JSONã‹ã‚‰èª­ã¿è¾¼ã‚“ã å…¨ã¦ã®ãƒ‘ã‚¹ã‚’æ¤œè¨¼ã—ã€æ¤œè¨¼å¤±æ•—æ™‚ã¯`None`ã‚’è¿”ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆãƒ¢ãƒ‡ãƒ«åä½¿ç”¨ï¼‰ã«åˆ‡ã‚Šæ›¿ãˆ
   - **ãƒ†ã‚¹ãƒˆ**: ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒã¨è¨±å¯å¤–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ããƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
   - **ãƒªã‚¹ã‚¯è©•ä¾¡**: ä½ãƒªã‚¹ã‚¯ï¼ˆã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ãŒå¿…è¦ã ãŒã€é˜²å¾¡çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã—ã¦å®Ÿè£…ï¼‰

---

## 6. æ¤œè¨¼ãƒ»æ–‡æ›¸ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° (Phase L, M, N)

> **æ³¨**: Phase M (MCPãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°) ã¯ä¿å®ˆæ€§æ”¹å–„ã®ä¸€ç’°ã ãŒã€Phase N (E2Eã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£) ã®å‰ææ¡ä»¶ã¨ãªã‚‹ãŸã‚ã€æœ¬ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«é…ç½®ã€‚

### Phase L: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ â³

#### L.1 æœªä½œæˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [x] README.mdï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ï¼‰ - âœ… **ä½œæˆå®Œäº†**ï¼ˆ2025-12-19ï¼‰
- [ ] æ‰‹å‹•ä»‹å…¥é‹ç”¨æ‰‹é †æ›¸ï¼ˆÂ§6æˆæœç‰©ï¼‰
- [ ] MCPãƒ„ãƒ¼ãƒ«ä»•æ§˜æ›¸ï¼ˆÂ§6æˆæœç‰©ï¼‰
- [ ] ã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ä»•æ§˜æ›¸ï¼ˆÂ§6æˆæœç‰©ï¼‰
- [ ] ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¥å…¨æ€§ç›£æŸ»é‹ç”¨æ‰‹é †

---

### Phase M: MCPãƒ„ãƒ¼ãƒ«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° âœ…

MCPãƒ„ãƒ¼ãƒ«ã‚’**30å€‹ã‹ã‚‰11å€‹**ã«ç°¡ç´ åŒ–ã€‚å®Ÿè£…å®Œäº†ã€E2Eæ¤œè¨¼ã¯ Phase N ã§å®Ÿæ–½ã€‚

#### M.1 è¨­è¨ˆæ–¹é‡

**ç›®çš„**:
- Cursor AIã®èªçŸ¥è² è·ä½æ¸›ï¼ˆãƒ„ãƒ¼ãƒ«é¸æŠã®å˜ç´”åŒ–ï¼‰
- ä½ãƒ¬ãƒ™ãƒ«æ“ä½œã®éš è”½ï¼ˆCursor AIã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®è©³ç´°ã‚’çŸ¥ã‚‹å¿…è¦ãŒãªã„ï¼‰
- è²¬ä»»åˆ†ç•Œã®æ˜ç¢ºåŒ–ï¼ˆCursor AI = æˆ¦ç•¥ã€Lyra = æˆ¦è¡“ï¼‰
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã®æ˜ç¢ºåŒ–ï¼ˆå…¬é–‹APIã‚’æœ€å°åŒ–ï¼‰

**çµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ–¹é‡**:

MCPãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼ã¨ã—ã€ãƒ­ã‚¸ãƒƒã‚¯ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®çµ±åˆAPIï¼ˆaction-basedï¼‰ã«é›†ç´„ã™ã‚‹ã€‚

```
MCPãƒãƒ³ãƒ‰ãƒ©ãƒ¼ (_handle_*)
    â†“ è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆå¼•æ•°å¤‰æ›ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ã¿ï¼‰
ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®çµ±åˆAPI (action-based)
    â†“
å†…éƒ¨ã‚¯ãƒ©ã‚¹ãƒ»é–¢æ•°
```

#### M.2 æ–°MCPãƒ„ãƒ¼ãƒ«ä¸€è¦§ï¼ˆ11ãƒ„ãƒ¼ãƒ«ï¼‰âœ…

| ã‚«ãƒ†ã‚´ãƒª | ãƒ„ãƒ¼ãƒ« | æ©Ÿèƒ½ | å®Ÿè£… | ãƒ†ã‚¹ãƒˆ |
|---------|--------|------|:----:|:------:|
| ã‚¿ã‚¹ã‚¯ç®¡ç† | `create_task` | ã‚¿ã‚¹ã‚¯ä½œæˆ | âœ… | âœ… |
| ã‚¿ã‚¹ã‚¯ç®¡ç† | `get_status` | çµ±åˆçŠ¶æ…‹å–å¾— | âœ… | âœ… (11ä»¶) |
| èª¿æŸ»å®Ÿè¡Œ | `search` | æ¤œç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ | âœ… | âœ… (18ä»¶) |
| èª¿æŸ»å®Ÿè¡Œ | `stop_task` | ã‚¿ã‚¹ã‚¯çµ‚äº† | âœ… | âœ… |
| æˆæœç‰© | `get_materials` | ãƒ¬ãƒãƒ¼ãƒˆç´ æå–å¾— | âœ… | âœ… |
| æ ¡æ­£ | `calibrate` | æ ¡æ­£æ“ä½œï¼ˆ5 actionï¼‰ | âœ… | âœ… (26ä»¶) |
| æ ¡æ­£ | `calibrate_rollback` | ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | âœ… | âœ… (13ä»¶) |
| èªè¨¼ã‚­ãƒ¥ãƒ¼ | `get_auth_queue` | èªè¨¼å¾…ã¡ãƒªã‚¹ãƒˆ | âœ… | âœ… (19ä»¶) |
| èªè¨¼ã‚­ãƒ¥ãƒ¼ | `resolve_auth` | èªè¨¼å®Œäº†å ±å‘Š | âœ… | âœ… |
| é€šçŸ¥ | `notify_user` | ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥ | âœ… | âœ… (21ä»¶) |
| é€šçŸ¥ | `wait_for_user` | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å¾…æ©Ÿ | âœ… | âœ… |

#### M.3 å®Ÿè£…çŠ¶æ³ âœ…

| é …ç›® | çŠ¶æ…‹ |
|------|:----:|
| 11å€‹ã®æ–°ãƒ„ãƒ¼ãƒ«å®šç¾©ï¼ˆ`src/mcp/server.py`ï¼‰ | âœ… |
| 11å€‹ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…ï¼ˆ`_handle_*`ï¼‰ | âœ… |
| `SearchPipeline`ï¼ˆ`src/research/pipeline.py`ï¼‰ | âœ… |
| ç”¨èªçµ±ä¸€ï¼ˆsubquery â†’ searchï¼‰ | âœ… |
| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³»ï¼ˆ`src/mcp/errors.py`ï¼‰ | âœ… |
| æ—§ãƒ„ãƒ¼ãƒ«å®šç¾©ã®å‰Šé™¤ï¼ˆ29å€‹ â†’ 0å€‹ï¼‰ | âœ… |

#### M.4 å†…éƒ¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ âœ…

ä½ãƒ¬ãƒ™ãƒ«æ“ä½œã¯MCPã‹ã‚‰éš è”½ã•ã‚Œã€`search`ãƒ„ãƒ¼ãƒ«ã‹ã‚‰è‡ªå‹•çš„ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ã€‚

```python
# src/research/pipeline.py: SearchPipeline.execute()
1. search_serp: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã¸ã®ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
2. fetch_url: URLå–å¾—ï¼ˆä¸¦åˆ—ï¼‰
3. extract_content: ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
4. rank_candidates: ãƒ©ãƒ³ã‚­ãƒ³ã‚°
5. llm_extract: äº‹å®Ÿ/ä¸»å¼µæŠ½å‡º
6. nli_judge: åè¨¼ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ã¿
7. çŠ¶æ…‹æ›´æ–°
```

#### M.5 ãƒ†ã‚¹ãƒˆçŠ¶æ³ âœ…

| ãƒ•ã‚¡ã‚¤ãƒ« | å¯¾è±¡ | ä»¶æ•° |
|---------|------|:----:|
| `test_mcp_errors.py` | ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³» | 21ä»¶ |
| `test_calibrate_rollback.py` | `calibrate_rollback` | 13ä»¶ |
| `test_mcp_get_status.py` | `get_status` | 11ä»¶ |
| `test_mcp_calibrate.py` | `calibrate`ï¼ˆ5 actionï¼‰ | 26ä»¶ |
| `test_mcp_search.py` | `search`, `get_materials` | 18ä»¶ |
| `test_mcp_auth.py` | `get_auth_queue`, `resolve_auth` | 19ä»¶ |
| `test_mcp_notification.py` | `notify_user`, `wait_for_user` | 21ä»¶ |

**E2Eæ¤œè¨¼**: Phase N ã§å®Ÿæ–½äºˆå®š

#### M.6 æ®‹ä½œæ¥­

| é …ç›® | çŠ¶æ…‹ | å‚™è€ƒ |
|------|:----:|------|
| Cursor AIç„¡å¿œç­”ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆÂ§2.1.5ï¼‰ | âœ… | **å®Ÿè£…æ¸ˆã¿**: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ30ç§’ï¼‰ã¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£è¿½è·¡ã€‚`get_status`ã§`idle_seconds`ã¨è­¦å‘Šã‚’è¿”å´ã€‚ |
| DBã‚¹ã‚­ãƒ¼ãƒåˆ—åå¤‰æ›´ï¼ˆsubqueryâ†’searchï¼‰ | âœ… **ä¸è¦** | **èª¿æŸ»çµæœ**: DBã‚¹ã‚­ãƒ¼ãƒã«ã¯`subquery`åˆ—åã¯å­˜åœ¨ã—ãªã„ã€‚`queries`ãƒ†ãƒ¼ãƒ–ãƒ«ã®`parent_query_id`ã‚«ãƒ©ãƒ ã«ã€ŒFor sub-queriesã€ã¨ã„ã†ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹ãŒã€åˆ—åè‡ªä½“ã¯`subquery`ã§ã¯ãªã„ã€‚ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã¯`subquery`ç”¨èªã¯å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã«æ®‹ã£ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®DBã‚¹ã‚­ãƒ¼ãƒã«ã¯å½±éŸ¿ãªã—ã€‚ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸è¦ã€‚ |

---

### Phase N: E2Eã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼ˆè«–æ–‡æŠ•ç¨¿å‘ã‘ï¼‰â³ğŸ”´å„ªå…ˆ

è«–æ–‡æŠ•ç¨¿ã«å¿…è¦ãªã€Œå‹•ãã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€ã®å®Ÿè¨¼ã€‚**E2Eç’°å¢ƒç¢ºèª â†’ MCPãƒ„ãƒ¼ãƒ«ç–é€šç¢ºèª â†’ ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£å®Ÿæ–½** ã®é †ã§é€²ã‚ã‚‹ã€‚

#### N.1 ç›®çš„

| è¦³ç‚¹ | ç›®çš„ |
|------|------|
| **çµ±åˆå‹•ä½œç¢ºèª** | Phase A-M ã®æˆæœãŒé€£çµã—ã¦å‹•ä½œã™ã‚‹ã“ã¨ã®å®Ÿè¨¼ |
| ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ | è«–æ–‡ã«è¨˜è¼‰ã™ã‚‹å…·ä½“çš„ãªä½¿ç”¨ä¾‹ã®ä½œæˆ |
| OSSä¾¡å€¤ã®å®Ÿè¨¼ | é€æ˜æ€§ãƒ»ç›£æŸ»å¯èƒ½æ€§ãƒ»å†ç¾æ€§ã®ç¢ºä¿ |

#### N.2 E2Eå®Ÿè¡Œç’°å¢ƒç¢ºèª âœ…

**ç›®çš„**: å®Ÿç’°å¢ƒã§å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

**å®Ÿè£…**: `tests/scripts/verify_environment.py`

| ç¢ºèªé …ç›® | æ–¹æ³• | çŠ¶æ…‹ |
|---------|------|:----:|
| Podmanã‚³ãƒ³ãƒ†ãƒŠèµ·å‹• | ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ã®å®Ÿè¡Œç¢ºèª | âœ… |
| Chrome CDPæ¥ç¶š | Playwright CDPæ¥ç¶šï¼ˆ15ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰ | âœ… |
| Ollama LLMèµ·å‹• | OllamaProvider.get_health() | âœ… |
| ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ | lyra â†’ ollama (å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯) | âœ… |
| æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ç–é€š | CDPä¾å­˜ã€ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½ | âœ… |
| ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ | NotificationProviderRegistry | âœ… |

**æ¤œè¨¼çµæœï¼ˆ2025-12-10ï¼‰**:
- Container Environment: âœ“ PASS
- Ollama LLM: âœ“ PASSï¼ˆãƒ¢ãƒ‡ãƒ«2ã¤åˆ©ç”¨å¯èƒ½ï¼‰
- Container Network: âœ“ PASS
- Chrome CDP: ç’°å¢ƒä¾å­˜ï¼ˆWSLâ†’Windowsãƒãƒ¼ãƒˆãƒ—ãƒ­ã‚­ã‚·è¨­å®šè¦ï¼‰
- Notification: ç’°å¢ƒä¾å­˜ï¼ˆã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰powershellä¸å¯ï¼‰

**æ‰‹é †**:
```bash
# 1. å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
./scripts/dev.sh up

# 2. Chrome ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰èµ·å‹•ï¼ˆWindowså´ï¼‰
./scripts/chrome.sh start

# 3. ç’°å¢ƒç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
podman exec lyra python tests/scripts/verify_environment.py

# 4. æ¤œç´¢ãƒ†ã‚¹ãƒˆï¼ˆChromeæ¥ç¶šå¾Œï¼‰
podman exec lyra python tests/scripts/verify_duckduckgo_search.py
```

#### N.3 MCPãƒ„ãƒ¼ãƒ«ç–é€šç¢ºèª âœ…

**ç›®çš„**: 11å€‹ã®æ–°MCPãƒ„ãƒ¼ãƒ«ãŒå®Ÿç’°å¢ƒã§æ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

| ãƒ„ãƒ¼ãƒ« | ç¢ºèªå†…å®¹ | çŠ¶æ…‹ |
|--------|---------|:----:|
| `create_task` | ã‚¿ã‚¹ã‚¯ãŒDBã«ä½œæˆã•ã‚Œã‚‹ | âœ… |
| `get_status` | ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ãŒæ­£ã—ãè¿”ã‚‹ | âœ… |
| `search` | æ¤œç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Œèµ°ã™ã‚‹ | âœ… |
| `stop_task` | ã‚¿ã‚¹ã‚¯ãŒçµ‚äº†ã—çµ±è¨ˆãŒè¿”ã‚‹ | âœ… |
| `get_materials` | ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•ãŒæ§‹ç¯‰ã•ã‚Œã‚‹ | âœ… |
| `calibrate` | æ ¡æ­£ã‚µãƒ³ãƒ—ãƒ«ãŒç™»éŒ²ã•ã‚Œã‚‹ | âœ… |
| `get_auth_queue` | èªè¨¼å¾…ã¡ãŒå–å¾—ã§ãã‚‹ | âœ… |
| `resolve_auth` | èªè¨¼å®Œäº†ãŒè¨˜éŒ²ã•ã‚Œã‚‹ | âœ… |
| `notify_user` | ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹ | âœ… |
| `wait_for_user` | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å¾…æ©ŸãŒå‹•ä½œã™ã‚‹ | âœ… |

**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆã§ã®Chrome CDPæ¥ç¶š**:

ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆï¼ˆPhase Oï¼‰ã§ã¯ã€MCPã‚µãƒ¼ãƒãƒ¼ãŒWSLä¸Šã§ç›´æ¥å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€Chromeæ¥ç¶šãŒç°¡ç´ åŒ–ã•ã‚Œã¾ã™ã€‚

1. **Chromeèµ·å‹•**:
   ```bash
   ./scripts/chrome.sh start
   # WSLâ†’Windows Chromeã«ç›´æ¥æ¥ç¶šï¼ˆlocalhost:9222ï¼‰
   ```

2. **MCPã‚µãƒ¼ãƒãƒ¼èµ·å‹•**ï¼ˆCursorãŒè‡ªå‹•å®Ÿè¡Œï¼‰:
   ```bash
   ./scripts/mcp.sh
   ```

3. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**:
   ```bash
   # venvã‹ã‚‰ç›´æ¥å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
   source .venv/bin/activate
   python tests/scripts/verify_mcp_integration.py

   # åŸºæœ¬ãƒ¢ãƒ¼ãƒ‰ï¼ˆChrome CDPä¸è¦ï¼‰
   python tests/scripts/verify_mcp_integration.py --basic
   ```

**æ¤œè¨¼çµæœï¼ˆ2025-12-11ï¼‰**:
- å…¨11ãƒ„ãƒ¼ãƒ«: âœ… PASSï¼ˆãƒ•ãƒ«æ¤œè¨¼ï¼‰
- Chrome CDPæ¥ç¶š: âœ… PASSï¼ˆWSLç›´æ¥æ¥ç¶šï¼‰
- ãƒ—ãƒ­ã‚­ã‚·æ¥ç¶š: âœ… PASSï¼ˆlocalhost:8080çµŒç”±ï¼‰

#### N.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£E2E âœ…

Phase K.3 ã®é˜²å¾¡å±¤ãŒçµ±åˆç’°å¢ƒã§æ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚

**å®Ÿè£…**: `tests/scripts/verify_llm_security.py`

| å±¤ | ç¢ºèªå†…å®¹ | çŠ¶æ…‹ |
|----|---------|:----:|
| L1 | Ollamaã‹ã‚‰å¤–éƒ¨é€šä¿¡ä¸å¯ï¼ˆ`internal: true`ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰ | âœ… |
| L2/L3/L4 | ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§LLMæ­£å¸¸å‹•ä½œ | âœ… |
| L5 | MCPå¿œç­”ã«`_lyra_meta`ãŒå«ã¾ã‚Œã‚‹ | âœ… |
| L6 | ã‚½ãƒ¼ã‚¹æ¤œè¨¼ãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèª | âœ… |
| L7 | äºˆæœŸã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒé™¤å»ã•ã‚Œã‚‹ | âœ… |
| L8 | ãƒ­ã‚°ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ¬æ–‡ãŒå«ã¾ã‚Œãªã„ | âœ… |

**æ¤œè¨¼çµæœï¼ˆ2025-12-10ï¼‰**:
- L1: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã§`internal: true`ç¢ºèªæ¸ˆã¿
- L2/L3/L4: ã‚¿ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³é™¤å»ã€å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºã€å‡ºåŠ›æ¤œè¨¼ãŒæ­£å¸¸å‹•ä½œ
- L5: `create_task`/`get_status`ã«`_lyra_meta`ä»˜ä¸ç¢ºèª
- L6: `DomainVerificationState`ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ã‚¿ç”ŸæˆãŒæ­£å¸¸å‹•ä½œ
- L7: ä¸æ˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é™¤å»ã€LLMã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãŒæ­£å¸¸å‹•ä½œ
- L8: ãƒãƒƒã‚·ãƒ¥/é•·ã•/ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã¿è¨˜éŒ²ã€ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–å†…å®¹ãƒã‚¹ã‚¯ç¢ºèª

**æ‰‹é †**:
```bash
podman exec lyra python tests/scripts/verify_llm_security.py
```

#### N.5 Chrome CDPæ¥ç¶šã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ”¹å–„ âœ…

**å•é¡Œ**: MCP `search` ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œæ™‚ã«Chrome CDPãŒæœªæ¥ç¶šã®å ´åˆã€`status: "running"` ãŒè¿”ã•ã‚Œã€Cursor AIã«å¤±æ•—ã®åŸå› ãŒä¼ã‚ã‚‰ãªã„ã€‚

**è§£æ±º**: Chromeè‡ªå‹•èµ·å‹•æ©Ÿèƒ½ã‚’å®Ÿè£…ã€‚CDPæœªæ¥ç¶šæ™‚ã¯ `./scripts/chrome.sh start` ã‚’è‡ªå‹•å®Ÿè¡Œã—ã€UXã‚’æ”¹å–„ã€‚

##### N.5.1 å•é¡Œåˆ†æ

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**:
```
_handle_search() (server.py)
  â†’ search_action() (pipeline.py)
  â†’ SearchPipeline.execute()
  â†’ _execute_normal_search()
  â†’ SearchExecutor.execute() (executor.py)
  â†’ _execute_search()
  â†’ search_serp() (search_api.py)
  â†’ _search_with_provider()
  â†’ BrowserSearchProvider.search() â† CDPã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‚¹
```

**å•é¡Œç‚¹**:
| ç®‡æ‰€ | å•é¡Œ |
|------|------|
| `BrowserSearchProvider.search()` | `CDPConnectionError` ã‚’ `SearchResponse(error=...)` ã«å¤‰æ› |
| `_search_with_provider()` | ã‚¨ãƒ©ãƒ¼æ™‚ã«è­¦å‘Šãƒ­ã‚°â†’ç©ºãƒªã‚¹ãƒˆè¿”å´ã€ã‚¨ãƒ©ãƒ¼æƒ…å ±ã¯ä¼æ’­ã›ãš |
| `SearchExecutor.execute()` | åˆæœŸå€¤ `status="running"` ã®ã¾ã¾ã€SERPçµæœ0ä»¶ã§ã‚‚æ›´æ–°ã•ã‚Œãªã„å ´åˆã‚ã‚Š |
| `_handle_search()` | `search_action()` ã®çµæœã‚’ãã®ã¾ã¾è¿”å´ã€CDPæœªæ¥ç¶šã§ã‚‚ `"running"` ãŒè¿”ã‚‹ |

**æ ¹æœ¬åŸå› **:
- Chrome CDPæœªæ¥ç¶šã¯**è‡´å‘½çš„ãªã‚¤ãƒ³ãƒ•ãƒ©éšœå®³**ã ãŒã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã“ã‚Œã‚’ã€Œæ¤œç´¢çµæœ0ä»¶ã€ã¨åŒç­‰ã«æ‰±ã†
- Cursor AIã«ã¯ã€Œä½•ãŒå•é¡Œã‹ã€ã€Œã©ã†å¯¾å‡¦ã™ã¹ãã‹ã€ãŒä¼ã‚ã‚‰ãªã„

##### N.5.2 è§£æ±ºç­–è¨­è¨ˆ

**æ–¹é‡**: CDPæœªæ¥ç¶šã¯**æ¤œç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å‰ææ¡ä»¶æœªå……è¶³**ã¨ã—ã¦ã€æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã§å³åº§ã«å ±å‘Šã™ã‚‹ã€‚

**ã‚¿ã‚¹ã‚¯ä¸€è¦§**:

| ID | é …ç›® | çŠ¶æ…‹ |
|----|------|:----:|
| N.5.2-1 | MCPã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ `CHROME_NOT_READY` è¿½åŠ  | âœ… |
| N.5.2-2 | `search` ãƒãƒ³ãƒ‰ãƒ©ã«CDPäº‹å‰ãƒã‚§ãƒƒã‚¯è¿½åŠ  | âœ… |
| N.5.2-3 | Chromeè‡ªå‹•èµ·å‹•æ©Ÿèƒ½ã®å®Ÿè£… | âœ… |
| N.5.2-4 | docs/REQUIREMENTS.md Â§3.2.1 ã«ä»•æ§˜è¿½è¨˜ | âœ… |
| N.5.2-5 | E2Eãƒ†ã‚¹ãƒˆï¼ˆCDPæœªæ¥ç¶šâ†’è‡ªå‹•èµ·å‹•â†’æ¤œç´¢æˆåŠŸã®ç¢ºèªï¼‰ | âœ… |

**è¨­è¨ˆè©³ç´°**:

1. **MCPã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰è¿½åŠ ** (`src/mcp/errors.py`):
   ```python
   CHROME_NOT_READY = "CHROME_NOT_READY"
   """Chrome CDP is not connected.
   Auto-start was attempted but failed."""
   
   class ChromeNotReadyError(MCPError):
       """Raised when Chrome CDP connection is not available after auto-start attempt."""
   ```

2. **Chromeè‡ªå‹•èµ·å‹•æ©Ÿèƒ½** (`src/mcp/server.py`):
   - `_ensure_chrome_ready()` ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’è¿½åŠ 
   - èµ·å‹•ãƒ•ãƒ­ãƒ¼:
     1. CDPæ¥ç¶šãƒã‚§ãƒƒã‚¯ï¼ˆ`http://localhost:{port}/json/version`ï¼‰
     2. æœªæ¥ç¶šã®å ´åˆã€`subprocess.run()` ã§ `./scripts/chrome.sh start` ã‚’å®Ÿè¡Œ
     3. æœ€å¤§15ç§’é–“ã€0.5ç§’é–“éš”ã§CDPæ¥ç¶šã‚’ãƒãƒ¼ãƒªãƒ³ã‚°
     4. æ¥ç¶šæˆåŠŸ â†’ `True` ã‚’è¿”å´ï¼ˆæ¤œç´¢ç¶šè¡Œï¼‰
     5. æ¥ç¶šå¤±æ•— â†’ `ChromeNotReadyError` ã‚’ç™ºç”Ÿ

   ```python
   async def _ensure_chrome_ready(self, port: int = 9222, timeout: float = 15.0) -> bool:
       """Ensure Chrome CDP is ready, auto-starting if needed."""
       # 1. Check if already connected
       if await self._check_cdp_connection(port):
           return True
       
       # 2. Auto-start Chrome
       script_path = Path(__file__).parent.parent.parent / "scripts" / "chrome.sh"
       result = subprocess.run([str(script_path), "start"], capture_output=True, text=True)
       
       # 3. Wait for CDP connection
       start_time = time.monotonic()
       while time.monotonic() - start_time < timeout:
           if await self._check_cdp_connection(port):
               return True
           await asyncio.sleep(0.5)
       
       # 4. Failed
       raise ChromeNotReadyError("Auto-start failed")
   ```

3. **CDPäº‹å‰ãƒã‚§ãƒƒã‚¯çµ±åˆ** (`_handle_search()`):
   - æ¤œç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é–‹å§‹å‰ã« `await self._ensure_chrome_ready()` ã‚’å‘¼ã³å‡ºã—
   - è‡ªå‹•èµ·å‹•ã®çµæœã‚’ãƒ­ã‚°ã«è¨˜éŒ²

4. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ï¼ˆè‡ªå‹•èµ·å‹•å¤±æ•—æ™‚ï¼‰:
   ```json
   {
     "ok": false,
     "error_code": "CHROME_NOT_READY",
     "error": "Chrome CDP is not connected. Auto-start failed. Check: ./scripts/chrome.sh diagnose",
     "details": {
       "auto_start_attempted": true,
       "hint": "Verify Chrome is installed and WSL2 mirrored networking is enabled"
     }
   }
   ```

5. **docs/REQUIREMENTS.mdæ›´æ–°** (Â§3.2.1): âœ… å®Œäº†
   - `search` ãƒ„ãƒ¼ãƒ«ã®å‰ææ¡ä»¶ã«Chromeè‡ªå‹•èµ·å‹•ã‚’æ˜è¨˜
   - è‡ªå‹•èµ·å‹•ã®ãƒ•ãƒ­ãƒ¼ãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»ã‚¨ãƒ©ãƒ¼å¿œç­”ã‚’å®šç¾©

##### N.5.3 å®Ÿè£…æ–¹é‡

- **è‡ªå‹•èµ·å‹•ã‚’è¡Œã†**: CDPæœªæ¥ç¶šæ™‚ã€Lyraã¯ `./scripts/chrome.sh start` ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¦Chromeã‚’èµ·å‹•ã™ã‚‹
  - UXæœ€å„ªå…ˆ: Lyraã‚’ä½¿ã†ä»¥ä¸ŠChrome CDPæ¥ç¶šã¯å¿…é ˆã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¯å›æ‰‹å‹•èµ·å‹•ã‚’æ±‚ã‚ã‚‹ã®ã¯UXä¸Šè¨±å®¹ã§ããªã„
  - ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆï¼ˆPhase Oï¼‰ã«ã‚ˆã‚Šã€WSLâ†’Windows Chromeã¸ã®ç›´æ¥æ¥ç¶šãŒå¯èƒ½
- **ã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•èµ·å‹•å¤±æ•—æ™‚ã®ã¿**: è‡ªå‹•èµ·å‹•ã‚’è©¦è¡Œã—ã€æˆåŠŸã™ã‚Œã°æ¤œç´¢ã‚’ç¶šè¡Œã€‚å¤±æ•—ã—ãŸå ´åˆã®ã¿ `CHROME_NOT_READY` ã‚¨ãƒ©ãƒ¼ã‚’å ±å‘Š
- **äº‹å‰ãƒã‚§ãƒƒã‚¯**: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é–‹å§‹å‰ã« `_ensure_chrome_ready()` ã§æ¥ç¶šç¢ºèªãƒ»è‡ªå‹•èµ·å‹•ã‚’è¡Œã„ã€æ¤œç´¢é€”ä¸­ã§ã®å¤±æ•—ã‚’é˜²æ­¢
- **æ—¢å­˜ãƒ•ãƒ­ãƒ¼ä¿æŒ**: `BrowserSearchProvider` å†…éƒ¨ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯å¤‰æ›´ã›ãšã€MCPãƒãƒ³ãƒ‰ãƒ©å±¤ã§è‡ªå‹•èµ·å‹•ã‚’å¯¾å‡¦

#### N.6 ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼ˆCS-1ï¼‰

**ã‚·ãƒŠãƒªã‚ª**: ãƒªãƒ©ã‚°ãƒ«ãƒãƒ‰ï¼ˆLiraglutideï¼‰ã®å®‰å…¨æ€§æƒ…å ±åé›†

| é …ç›® | å†…å®¹ |
|------|------|
| å¯¾è±¡ | FDA/PMDA/EMAæ¨ªæ–­ã§ã®å®‰å…¨æ€§æƒ…å ± |
| ã‚¯ã‚¨ãƒªä¾‹ | "liraglutide FDA safety alert", "ãƒªãƒ©ã‚°ãƒ«ãƒãƒ‰ PMDA å®‰å…¨æ€§é€Ÿå ±" |
| æœŸå¾…æˆæœ | è¤‡æ•°ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®æƒ…å ±åé›†ã€ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•æ§‹ç¯‰ |

**å®Ÿæ–½æ‰‹é †**:
```
1. ã‚¿ã‚¹ã‚¯ä½œæˆ
   - Cursor AI: create_task("ãƒªãƒ©ã‚°ãƒ«ãƒãƒ‰ã®å®‰å…¨æ€§æƒ…å ±èª¿æŸ»")

2. æ¤œç´¢ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼ˆCursor AIä¸»å°ï¼‰
   - search(task_id, "liraglutide FDA safety alert")
   - search(task_id, "ãƒªãƒ©ã‚°ãƒ«ãƒãƒ‰ PMDA å®‰å…¨æ€§é€Ÿå ±")
   - get_status(task_id) ã§é€²æ—ç¢ºèª

3. åè¨¼æ¢ç´¢
   - search(task_id, "liraglutide adverse events", refute=true)

4. æˆæœç‰©å–å¾—
   - get_materials(task_id)
   - ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•ã®å¯è¦–åŒ–

5. è¨˜éŒ²æ•´ç†
   - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ãƒ­ã‚°ã€å›³è¡¨ä½œæˆ
```

#### N.7 æˆåŠŸåŸºæº–

| åŸºæº– | é–¾å€¤ | æ¸¬å®šæ–¹æ³• |
|------|------|---------|
| ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œèµ° | å…¨ã‚¹ãƒ†ãƒƒãƒ—æˆåŠŸ | ãƒ­ã‚°ã®cause_idé€£çµç¢ºèª |
| ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•æ§‹ç¯‰ | â‰¥5ä»¶ã®ä¸»å¼µ-æ–­ç‰‡-ã‚½ãƒ¼ã‚¹é–¢ä¿‚ | `get_materials`ã®è¿”å´å€¤ |
| æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å¤šæ§˜åŒ– | â‰¥3ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‚‰çµæœå–å¾— | æ¤œç´¢ãƒ­ã‚° |
| ã‚¨ãƒ©ãƒ¼ãªã—å®Œäº† | æœªå‡¦ç†ä¾‹å¤–ã‚¼ãƒ­ | ãƒ­ã‚°ç¢ºèª |

#### N.8 è¨˜éŒ²é …ç›®

| é …ç›® | å½¢å¼ | ç”¨é€” |
|------|------|------|
| å®Ÿè¡Œãƒ­ã‚° | JSONL | å†ç¾æ€§ã€å› æœãƒˆãƒ¬ãƒ¼ã‚¹ |
| ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ | PNG | è«–æ–‡å›³è¡¨ã€ãƒ‡ãƒ¢ |
| ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ• | JSON/GraphML | è«–æ–‡å›³è¡¨ |
| å®Ÿè¡Œæ™‚é–“ãƒ»ãƒªã‚½ãƒ¼ã‚¹ | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | æ€§èƒ½è©•ä¾¡ |
| WARC/PDF | ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– | ç›£æŸ»å¯èƒ½æ€§ã®å®Ÿè¨¼ |

#### N.9 OSSä¾¡å€¤ã®å®Ÿè¨¼ãƒã‚¤ãƒ³ãƒˆ

è«–æ–‡ã§å¼·èª¿ã™ã¹ãã€ŒOSS + ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµã€ã®ä¾¡å€¤:

| ä¾¡å€¤ | å®Ÿè¨¼æ–¹æ³• |
|------|---------|
| **é€æ˜æ€§** | å…¨ã‚³ãƒ¼ãƒ‰ãŒGitHubã§å…¬é–‹ã€ç›£æŸ»å¯èƒ½ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | æ¤œç´¢ã‚¯ã‚¨ãƒªãƒ»åé›†æƒ…å ±ãŒå¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãªã„ |
| **å†ç¾æ€§** | åŒä¸€ç’°å¢ƒã§åŒä¸€çµæœãŒå¾—ã‚‰ã‚Œã‚‹ |
| **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§** | ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ãƒ»æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³è¨­å®šãŒå¤‰æ›´å¯èƒ½ |

**å•†ç”¨ãƒ„ãƒ¼ãƒ«ã¨ã®å·®åˆ¥åŒ–**:
- Perplexity/ChatGPT: ã‚¯ã‚¨ãƒªãŒã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã‚‹
- Google Deep Research: åé›†æƒ…å ±ãŒGoogleã«è“„ç©ã•ã‚Œã‚‹
- Lyra: **ã™ã¹ã¦ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµã€ãƒ­ã‚°ã¯æ‰‹å…ƒã«ã®ã¿å­˜åœ¨**

---

### Phase O: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° âœ…

MCPã‚µãƒ¼ãƒãƒ¼ã‚’WSLå´ã§ç›´æ¥å®Ÿè¡Œã—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã‚’ç°¡ç´ åŒ–ã™ã‚‹ã€‚

#### O.1 è¨­è¨ˆå‹•æ©Ÿ

**æ—§æ§‹æˆã®å•é¡Œç‚¹**:
- ã‚³ãƒ³ãƒ†ãƒŠâ†’Windows Chromeã¸ã®æ¥ç¶šãŒè¤‡é›‘ï¼ˆsocatã€host-gatewayå¿…é ˆï¼‰
- Chromeè‡ªå‹•èµ·å‹•ãŒã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã¯å›°é›£
- WSL2 mirrored networkingã¸ã®å¼·ã„ä¾å­˜
- execution_modeåˆ†å²ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰è¤‡é›‘åŒ–

**æ–°æ§‹æˆï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼‰ã®åˆ©ç‚¹**:
- WSLâ†’Windows ChromeãŒç›´æ¥æ¥ç¶šï¼ˆlocalhost:9222ï¼‰
- socatãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ä¸è¦
- Chromeè‡ªå‹•èµ·å‹•ãŒå®¹æ˜“ï¼ˆ`chrome.sh start`ã‚’ç›´æ¥å®Ÿè¡Œï¼‰
- ã‚³ãƒ³ãƒ†ãƒŠã¯Ollama/ML Serverã®ã¿ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢ç¶­æŒï¼‰
- execution_modeåˆ†å²ä¸è¦ï¼ˆå¸¸ã«WSLãƒ¢ãƒ¼ãƒ‰ï¼‰

#### O.2 å®Ÿè£…å®Œäº†é …ç›® âœ…

| é …ç›® | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ |
|------|---------|:----:|
| ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ | `src/proxy/server.py` | âœ… |
| MCPèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | `scripts/mcp.sh` | âœ… |
| è»½é‡ä¾å­˜é–¢ä¿‚ | `requirements-mcp.txt` | âœ… |
| è¨­å®šæ‹¡å¼µ | `src/utils/config.py`, `.env` | âœ… |
| OllamaProviderãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ | `src/filter/ollama_provider.py` | âœ… |
| MLClientãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ | `src/ml_client.py` | âœ… |
| podman-composeæ›´æ–° | `podman-compose.yml` | âœ… |
| E2Eå‹•ä½œç¢ºèª | ãƒ—ãƒ­ã‚­ã‚·çµŒç”±æ¥ç¶šç¢ºèª | âœ… |

#### O.3 ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»ï¼ˆå®Œå…¨å‰Šé™¤ãƒ»ç°¡ç´ åŒ–ï¼‰â³

ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆã«ã‚ˆã‚Šä¸è¦ã«ãªã£ãŸè¤‡é›‘ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã¨å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰åˆ†å²ã‚’**ã™ã¹ã¦å‰Šé™¤**ã™ã‚‹ã€‚

##### O.3.1 socaté–¢é€£ã‚³ãƒ¼ãƒ‰å®Œå…¨å‰Šé™¤

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | è¡Œæ•° | å„ªå…ˆåº¦ |
|---------|---------|:----:|:------:|
| `scripts/chrome.sh` | `start_socat`, `stop_socat`, `check_socat`é–¢æ•°å‰Šé™¤ï¼ˆL232-309ï¼‰ | ~78è¡Œ | é«˜ |
| `scripts/chrome.sh` | `get_status`å†…ã®socatãƒã‚§ãƒƒã‚¯å‰Šé™¤ï¼ˆL327-336ï¼‰ | ~10è¡Œ | é«˜ |
| `scripts/chrome.sh` | `start_chrome_wsl`å†…ã®socatèµ·å‹•å‰Šé™¤ï¼ˆL371-384ï¼‰ | ~14è¡Œ | é«˜ |
| `scripts/chrome.sh` | `stop_chrome`å†…ã®socatåœæ­¢å‰Šé™¤ï¼ˆL499-502ï¼‰ | ~4è¡Œ | é«˜ |
| `scripts/chrome.sh` | `SOCAT_PID_FILE`å®šæ•°å‰Šé™¤ï¼ˆL47ï¼‰ | 1è¡Œ | é«˜ |
| `scripts/common.sh` | `SOCAT_PORT`å®šæ•°å‰Šé™¤ï¼ˆL81ï¼‰ | 1è¡Œ | é«˜ |
| `src/mcp/errors.py` | `ChromeNotReadyError`ã®`is_podman`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨socatãƒ’ãƒ³ãƒˆå‰Šé™¤ï¼ˆL328-336ï¼‰ | ~9è¡Œ | é«˜ |
| `src/mcp/server.py` | `is_podman`æ¤œå‡ºã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆL806-811ï¼‰ | ~6è¡Œ | é«˜ |
| `src/search/browser_search_provider.py` | socatãƒ’ãƒ³ãƒˆå‰Šé™¤ï¼ˆL201-208ï¼‰ | ~8è¡Œ | ä¸­ |
| `src/crawler/playwright_provider.py` | socatãƒ’ãƒ³ãƒˆå‰Šé™¤ï¼ˆL157-160ï¼‰ | ~4è¡Œ | ä¸­ |
| `src/crawler/fetcher.py` | socatãƒ’ãƒ³ãƒˆå‰Šé™¤ï¼ˆL765-768ï¼‰ | ~4è¡Œ | ä¸­ |
| `tests/test_mcp_errors.py` | `test_podman_environment`ãƒ†ã‚¹ãƒˆå‰Šé™¤ï¼ˆL420-433ï¼‰ | ~14è¡Œ | ä¸­ |

**åˆè¨ˆå‰Šé™¤è¡Œæ•°**: ~152è¡Œ

##### O.3.2 host-gatewayé–¢é€£å®Œå…¨å‰Šé™¤

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | è¡Œæ•° | å„ªå…ˆåº¦ |
|---------|---------|:----:|:------:|
| `podman-compose.yml` | `extra_hosts`è¨­å®šå‰Šé™¤ï¼ˆL23-24ï¼‰ | 2è¡Œ | é«˜ |
| `config/settings.yaml` | `10.255.255.254`ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤ï¼ˆL133-135ï¼‰ | 3è¡Œ | ä½ |

**åˆè¨ˆå‰Šé™¤è¡Œæ•°**: ~5è¡Œ

##### O.3.3 execution_modeåˆ†å²å®Œå…¨å‰Šé™¤

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | è¡Œæ•° | å„ªå…ˆåº¦ |
|---------|---------|:----:|:------:|
| `src/utils/config.py` | `execution_mode`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‰Šé™¤ã€å¸¸ã«ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã«å›ºå®šï¼ˆL226-232ï¼‰ | ~7è¡Œ | é«˜ |
| `src/filter/ollama_provider.py` | execution_modeåˆ†å²å‰Šé™¤ã€å¸¸ã«ãƒ—ãƒ­ã‚­ã‚·URLä½¿ç”¨ï¼ˆL89-95ï¼‰ | ~7è¡Œ | é«˜ |
| `src/ml_client.py` | execution_modeåˆ†å²å‰Šé™¤ã€å¸¸ã«ãƒ—ãƒ­ã‚­ã‚·URLä½¿ç”¨ï¼ˆL31-37ï¼‰ | ~7è¡Œ | é«˜ |
| `.env` | `LYRA_EXECUTION_MODE`è¨­å®šå‰Šé™¤ï¼ˆL7-9ï¼‰ | 3è¡Œ | é«˜ |
| `.env` | ã‚³ãƒ³ãƒ†ãƒŠãƒ¢ãƒ¼ãƒ‰ç”¨ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤ï¼ˆL24-28ï¼‰ | 5è¡Œ | ä¸­ |
| `scripts/mcp.sh` | `LYRA_EXECUTION_MODE`è¨­å®šå‰Šé™¤ï¼ˆL130ï¼‰ | 1è¡Œ | é«˜ |
| `tests/test_ml_server_e2e.py` | execution_modeé–¢é€£ãƒ†ã‚¹ãƒˆç¢ºèªãƒ»ä¿®æ­£ | - | ä¸­ |

**åˆè¨ˆå‰Šé™¤è¡Œæ•°**: ~30è¡Œ

##### O.3.4 ã‚³ãƒ³ãƒ†ãƒŠæ¤œå‡ºã‚³ãƒ¼ãƒ‰å‰Šé™¤

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | è¡Œæ•° | å„ªå…ˆåº¦ |
|---------|---------|:----:|:------:|
| `src/mcp/server.py` | `/.dockerenv`æ¤œå‡ºã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆL806ï¼‰ | 1è¡Œ | é«˜ |
| `src/search/browser_search_provider.py` | ã‚³ãƒ³ãƒ†ãƒŠæ¤œå‡ºã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆL201-203ï¼‰ | ~3è¡Œ | ä¸­ |
| `src/crawler/playwright_provider.py` | ã‚³ãƒ³ãƒ†ãƒŠæ¤œå‡ºã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆL157-159ï¼‰ | ~3è¡Œ | ä¸­ |
| `src/crawler/fetcher.py` | ã‚³ãƒ³ãƒ†ãƒŠæ¤œå‡ºã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆL765-767ï¼‰ | ~3è¡Œ | ä¸­ |

**åˆè¨ˆå‰Šé™¤è¡Œæ•°**: ~10è¡Œ

##### O.3.5 ãƒãƒ¼ãƒˆè¨­å®šç°¡ç´ åŒ–

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | è¡Œæ•° | å„ªå…ˆåº¦ |
|---------|---------|:----:|:------:|
| `.env` | `CHROME_PORT`ã‚³ãƒ¡ãƒ³ãƒˆç°¡ç´ åŒ–ï¼ˆ9222å›ºå®šã€L19-21ï¼‰ | 3è¡Œ | ä½ |
| `config/settings.yaml` | ãƒãƒ¼ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤ï¼ˆL132-135ï¼‰ | 4è¡Œ | ä½ |
| `.env.example` | socatãƒãƒ¼ãƒˆè¨­å®šå‰Šé™¤ï¼ˆL13, L47-48ï¼‰ | 3è¡Œ | ä¸­ |
| `.env.example` | ã‚»ã‚¯ã‚·ãƒ§ãƒ³åã€ŒCONTAINER NETWORKING (Required for Podman)ã€ã‚’ã€ŒCONTAINER NETWORKING (Internal services)ã€ã«å¤‰æ›´ï¼ˆL16ï¼‰ | 1è¡Œ | ä½ |

**åˆè¨ˆå‰Šé™¤è¡Œæ•°**: ~10è¡Œ

##### O.3.6 ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ›´æ–°

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | è¡Œæ•° | å„ªå…ˆåº¦ |
|---------|---------|:----:|:------:|
| `config/cursor-mcp.json` | `podman exec`çµŒç”±ã‚’WSLçµŒç”±ï¼ˆ`./scripts/mcp.sh`ï¼‰ã«å¤‰æ›´ | å…¨ä½“ | **æœ€é«˜** |
| `Dockerfile` | CMDã‚’`src.proxy.server`ã«å¤‰æ›´ï¼ˆL89ï¼‰ | 1è¡Œ | é«˜ |
| `scripts/dev.sh` | ã‚³ãƒ³ãƒ†ãƒŠãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°é–¢é€£ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤ï¼ˆL145ï¼‰ | 1è¡Œ | ä¸­ |
| `scripts/dev.sh` | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®šã®ã‚³ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼ˆL55-56ï¼‰ | 2è¡Œ | ä½ |
| `scripts/test.sh` | WSLç›´æ¥å®Ÿè¡Œã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œã¯å‰Šé™¤ï¼‰ | - | é«˜ |
| `scripts/mcp.sh` | `LYRA_EXECUTION_MODE`è¨­å®šå‰Šé™¤ï¼ˆL130ï¼‰ | 1è¡Œ | é«˜ |
| `tests/scripts/verify_environment.py` | ã‚³ãƒ³ãƒ†ãƒŠæ¤œå‡ºã‚³ãƒ¼ãƒ‰å‰Šé™¤ã¾ãŸã¯æ›´æ–°ï¼ˆL101-114ï¼‰ | ~14è¡Œ | ä¸­ |
| `tests/scripts/*.py` | Usageã‚³ãƒ¡ãƒ³ãƒˆã®`podman exec`ã‚’WSL venvçµŒç”±ã«å¤‰æ›´ | ~16ãƒ•ã‚¡ã‚¤ãƒ« | ä¸­ |

**åˆè¨ˆå‰Šé™¤è¡Œæ•°**: ~20è¡Œ + 16ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¡ãƒ³ãƒˆæ›´æ–°

**å¤‰æ›´å†…å®¹**:
- **`cursor-mcp.json`**: `podman exec` â†’ `bash` + `./scripts/mcp.sh`ï¼ˆæœ€é‡è¦ï¼‰
- `Dockerfile`: CMDã‚’`src.mcp.server`ã‹ã‚‰`src.proxy.server`ã«å¤‰æ›´
- `dev.sh`: ã€Œcontainer networkingã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã€Œproxy serverã€ã«å¤‰æ›´
- `test.sh`: `podman exec`çµŒç”±ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’å‰Šé™¤ã—ã€WSL venvçµŒç”±ã«çµ±ä¸€
- `mcp.sh`: `LYRA_EXECUTION_MODE`è¨­å®šå‰Šé™¤ï¼ˆå¸¸ã«WSLãƒ¢ãƒ¼ãƒ‰ï¼‰
- `verify_environment.py`: ã‚³ãƒ³ãƒ†ãƒŠæ¤œå‡ºã¯æ®‹ã™ãŒã€WSLå®Ÿè¡Œæ™‚ã®èª¬æ˜ã‚’è¿½åŠ 
- E2Eãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ: Usageã‚³ãƒ¡ãƒ³ãƒˆã®`podman exec lyra python`ã‚’`python`ï¼ˆWSL venvçµŒç”±ï¼‰ã«å¤‰æ›´

##### O.3.7 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | å„ªå…ˆåº¦ |
|---------|---------|:------:|
| `docs/REQUIREMENTS.md` | execution_modeèª¬æ˜å‰Šé™¤ã€å¸¸ã«WSLãƒ¢ãƒ¼ãƒ‰ã«çµ±ä¸€ | é«˜ |
| `docs/IMPLEMENTATION_PLAN.md` | æ—§æ§‹æˆé–¢é€£èª¬æ˜å‰Šé™¤ | ä¸­ |
| `README.md`ï¼ˆæœªä½œæˆï¼‰ | ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã‹ã‚‰socat/host-gatewayå‰Šé™¤ | ä¸­ |
| `.env.example` | ã‚³ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼ˆWSLãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆã®èª¬æ˜ï¼‰ | ä¸­ |

#### O.4 å®Ÿè£…ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

**Phase O.2ï¼ˆåŸºç›¤å®Ÿè£…ï¼‰**: âœ… å®Œäº†
- [x] ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…
- [x] MCPèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- [x] è¨­å®šæ‹¡å¼µ
- [x] OllamaProvider/MLClientãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ

**Phase O.3ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰**: âœ… å®Œäº†
- [x] O.3.1: socaté–¢é€£ã‚³ãƒ¼ãƒ‰å®Œå…¨å‰Šé™¤ï¼ˆ~152è¡Œï¼‰
- [x] O.3.2: host-gatewayé–¢é€£å®Œå…¨å‰Šé™¤ï¼ˆ~5è¡Œï¼‰
- [x] O.3.3: execution_modeåˆ†å²å®Œå…¨å‰Šé™¤ï¼ˆ~30è¡Œï¼‰
- [x] O.3.4: ã‚³ãƒ³ãƒ†ãƒŠæ¤œå‡ºã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆ~10è¡Œï¼‰
- [x] O.3.5: ãƒãƒ¼ãƒˆè¨­å®šç°¡ç´ åŒ–ï¼ˆ~10è¡Œï¼‰
- [x] O.3.6: ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ›´æ–°ï¼ˆ~20è¡Œ + 16ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- [x] O.3.7: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

**åˆè¨ˆå‰Šé™¤è¡Œæ•°**: ~227è¡Œ + 16ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¡ãƒ³ãƒˆæ›´æ–°

**æœ€é‡è¦**: `config/cursor-mcp.json`ã®å¤‰æ›´ï¼ˆCursor IDEãŒMCPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹è¨­å®šï¼‰

#### O.5 å½±éŸ¿ç¯„å›²

**å‰Šé™¤ã•ã‚Œã‚‹æ©Ÿèƒ½**:
- ã‚³ãƒ³ãƒ†ãƒŠå†…MCPå®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ï¼ˆ`LYRA_EXECUTION_MODE=container`ï¼‰
- socatãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰æ©Ÿèƒ½
- host-gatewayçµŒç”±ã®Chromeæ¥ç¶š
- ã‚³ãƒ³ãƒ†ãƒŠæ¤œå‡ºã«ã‚ˆã‚‹æ¡ä»¶åˆ†å²

**æ®‹ã‚‹æ©Ÿèƒ½**:
- WSLä¸Šã§ã®MCPã‚µãƒ¼ãƒãƒ¼å®Ÿè¡Œï¼ˆå”¯ä¸€ã®å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ï¼‰
- ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã®Ollama/ML Serveræ¥ç¶š
- WSLâ†’Windows Chromeç›´æ¥æ¥ç¶šï¼ˆlocalhost:9222ï¼‰

**ç§»è¡Œæ‰‹é †**:
1. `.env`ã‹ã‚‰`LYRA_EXECUTION_MODE`ã‚’å‰Šé™¤
2. venvã‚’ä½œæˆã—ã€`requirements-mcp.txt`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. `./scripts/mcp.sh`ã§MCPã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆCursorãŒè‡ªå‹•å®Ÿè¡Œï¼‰

#### O.6 èªè¨¼ç¶­æŒè¦ä»¶ã®èª¿æŸ»ãƒ»è¿½åŠ ä»•æ§˜é•åä¿®æ­£ âœ… å®Œäº†

**èª¿æŸ»æ—¥**: 2025-12-11  
**å®Ÿè£…å®Œäº†æ—¥**: 2025-12-15

##### å•é¡Œã¨å¯¾å‡¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

| # | å•é¡Œ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | æ¦‚è¦ |
|---|------|----------|------|
| 1 | contextå†åˆ©ç”¨ | âœ… å®Œäº† | `new_context()`â†’æ—¢å­˜contextå„ªå…ˆä½¿ç”¨ |
| 2 | resolve_auth Cookieä¿å­˜ | âœ… å®Œäº† | Cookieå–å¾—ãƒ»ä¿å­˜å®Ÿè£… |
| 3 | ã‚»ãƒƒã‚·ãƒ§ãƒ³å†åˆ©ç”¨ | âœ… å®Œäº† | å¾Œç¶šãƒªã‚¯ã‚¨ã‚¹ãƒˆã§Cookieè‡ªå‹•é©ç”¨ |
| 4 | BrowserSearchProviderã‚»ãƒƒã‚·ãƒ§ãƒ³ | âœ… ç¢ºèªå®Œäº† | æ—¢å­˜contextå†åˆ©ç”¨ã§å¯¾å¿œæ¸ˆã¿ |
| 5 | start_session()ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹• | âœ… å®Œäº† | Chromeè‡ªå‹•èµ·å‹•æ©Ÿèƒ½å®Ÿè£… |
| 6 | Chromeãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å | âœ… ç¢ºèªå®Œäº† | å°‚ç”¨user-data-dirã§åˆ†é›¢æ¸ˆã¿ |
| 7 | LocalStorageéš”é›¢ | âœ… ç¢ºèªå®Œäº† | å°‚ç”¨user-data-dirã§è‡ªå‹•éš”é›¢ |
| 8 | ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠãƒ»å‹•çš„é‡ã¿å­¦ç¿’ | âœ… å®Œäº† | ã‚«ãƒ†ã‚´ãƒªåˆ¥é¸æŠãƒ»EMAé‡ã¿èª¿æ•´ |
| 9 | ã‚¨ãƒ³ã‚¸ãƒ³åˆ¥QPSåˆ¶é™ | âœ… å®Œäº† | ã‚¨ãƒ³ã‚¸ãƒ³åˆ¥min_intervalé©ç”¨ |
| 10 | Toræ—¥æ¬¡åˆ©ç”¨ä¸Šé™ | âœ… å®Œäº† | ã‚°ãƒ­ãƒ¼ãƒãƒ«20%+ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ä¸Šé™ |
| 11 | ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥æ—¥æ¬¡äºˆç®— | âœ… å®Œäº† | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒšãƒ¼ã‚¸æ—¥æ¬¡ä¸Šé™ |
| 12 | ã‚»ãƒƒã‚·ãƒ§ãƒ³è»¢é€é©ç”¨ | âœ… å®Œäº† | åˆå›ãƒ–ãƒ©ã‚¦ã‚¶â†’2å›ç›®HTTP(304) |
| 13 | ãƒ©ã‚¹ãƒˆãƒã‚¤ãƒ«ã‚¹ãƒ­ãƒƒãƒˆ | âœ… å®Œäº† | å›åç‡â‰¥90%ã§Google/Braveä½¿ç”¨ |
| 14 | ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¥å…¨æ€§ç›£æŸ» | âœ… å®Œäº† | ãƒ–ãƒ©ã‚¦ã‚¶åˆæœŸåŒ–æ™‚ã«è‡ªå‹•å®Ÿè¡Œ |
| 15 | ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ãƒ©ã‚¤ã‚¯æ“ä½œ | âœ… å®Œäº† | ãƒã‚¦ã‚¹è»Œè·¡ãƒ»ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ…£æ€§é©ç”¨ |
| 16 | ã‚¨ãƒ³ã‚¸ãƒ³æ­£è¦åŒ–ãƒ¬ã‚¤ãƒ¤ | âœ… å®Œäº† | `transform_query_for_engine` |

##### å¾—ã‚‰ã‚ŒãŸçŸ¥è¦‹

1. **contextç®¡ç†**: CDPæ¥ç¶šå¾Œã¯`browser.contexts`ã‚’ç¢ºèªã—ã€æ—¢å­˜contextã‚’å„ªå…ˆä½¿ç”¨ã™ã¹ã
2. **ã‚»ãƒƒã‚·ãƒ§ãƒ³è»¢é€**: Cookie/ETag/UAã®ç§»é€ã«ã¯åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³é™å®šã®å®‰å…¨ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒæœ‰åŠ¹
3. **æ—¥æ¬¡äºˆç®—ç®¡ç†**: ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒ—ãƒ³è¨­è¨ˆï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã¯è¨±å¯ï¼‰ã§ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§ã‚’ç¢ºä¿
4. **Pydanticçµ±ä¸€**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—ã¯Pydanticãƒ¢ãƒ‡ãƒ«ã§å‹å®‰å…¨æ€§ã‚’æ‹…ä¿

##### å¤–éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `docs/archive/O6_ADDITIONAL_ISSUES.md`

##### ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

| ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ | å¯¾è±¡ |
|------------|------|
| `docs/sequences/auth_session_reuse_flow.md` | å•é¡Œ3: ã‚»ãƒƒã‚·ãƒ§ãƒ³å†åˆ©ç”¨ |
| `docs/sequences/start_session_browser_flow.md` | å•é¡Œ5: ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹• |
| `docs/sequences/dynamic_weight_flow.md` | å•é¡Œ8: å‹•çš„é‡ã¿å­¦ç¿’ |
| `docs/sequences/engine_qps_flow.md` | å•é¡Œ9: ã‚¨ãƒ³ã‚¸ãƒ³åˆ¥QPS |
| `docs/sequences/tor_daily_limit_flow.md` | å•é¡Œ10: Toræ—¥æ¬¡ä¸Šé™ |
| `docs/sequences/domain_daily_budget_flow.md` | å•é¡Œ11: ãƒ‰ãƒ¡ã‚¤ãƒ³æ—¥æ¬¡äºˆç®— |
| `docs/sequences/session_transfer_flow.md` | å•é¡Œ12: ã‚»ãƒƒã‚·ãƒ§ãƒ³è»¢é€ |
| `docs/sequences/lastmile_slot_flow.md` | å•é¡Œ13: ãƒ©ã‚¹ãƒˆãƒã‚¤ãƒ«ã‚¹ãƒ­ãƒƒãƒˆ |
| `docs/sequences/profile_health_audit_flow.md` | å•é¡Œ14: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç›£æŸ» |
| `docs/sequences/human_behavior_flow.md` | å•é¡Œ15: ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ãƒ©ã‚¤ã‚¯æ“ä½œ |
| `docs/sequences/query_normalizer_flow.md` | å•é¡Œ16: ã‚¯ã‚¨ãƒªæ­£è¦åŒ– |

##### ãƒ‡ãƒãƒƒã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | å¯¾è±¡ |
|----------|------|
| `tests/scripts/debug_auth_session_reuse_flow.py` | å•é¡Œ3 |
| `tests/scripts/debug_start_session_browser_flow.py` | å•é¡Œ5 |
| `tests/scripts/debug_chrome_auto_start.py` | Chromeè‡ªå‹•èµ·å‹• |
| `tests/scripts/debug_dynamic_weight_flow.py` | å•é¡Œ8 |
| `tests/scripts/debug_engine_qps_flow.py` | å•é¡Œ9 |
| `tests/scripts/debug_tor_daily_limit_flow.py` | å•é¡Œ10 |
| `tests/scripts/debug_domain_daily_budget_flow.py` | å•é¡Œ11 |
| `tests/scripts/debug_session_transfer_flow.py` | å•é¡Œ12 |
| `tests/scripts/debug_lastmile_slot_flow.py` | å•é¡Œ13 |
| `tests/scripts/debug_profile_health_audit_flow.py` | å•é¡Œ14 |
| `tests/scripts/debug_human_behavior_flow.py` | å•é¡Œ15 |
| `tests/scripts/debug_query_normalizer_flow.py` | å•é¡Œ16 |

#### O.7 MCPãƒ„ãƒ¼ãƒ«ä»•æ§˜é©åˆæ€§æ¤œè¨¼ âœ… å®Œäº†

**èª¿æŸ»æ—¥**: 2025-12-15  
**å®Ÿè£…å®Œäº†æ—¥**: 2025-12-15

##### å•é¡Œã¨å¯¾å‡¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

| # | å•é¡Œ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | æ¦‚è¦ |
|---|------|----------|------|
| 1 | searchãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é€£å‹• | âœ… å®Œäº† | DBæ°¸ç¶šåŒ–è¿½åŠ ã€original_queryå±æ€§è¿½åŠ  |
| 2 | get_statusãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®— | âœ… å®Œäº† | searchesé…åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°ä¿®æ­£ |
| 3 | get_materialsã‚°ãƒ©ãƒ•æ§‹ç¯‰ | âœ… å®Œäº† | SQLã‚¯ã‚¨ãƒªã‚’ã‚¹ã‚­ãƒ¼ãƒã«é©åˆ |
| 4 | ãã®ä»–ãƒ„ãƒ¼ãƒ«æ¤œè¨¼ | âœ… å®Œäº† | calibrate/notify_userç­‰å‹•ä½œç¢ºèª |

##### å¾—ã‚‰ã‚ŒãŸçŸ¥è¦‹

1. **DBæ°¸ç¶šåŒ–ã®é‡è¦æ€§**: searchä¸­ã®claims/fragmentsã¯æ˜ç¤ºçš„ã«DBæ›¸ãè¾¼ã¿ãŒå¿…è¦ï¼ˆãƒ¡ãƒ¢ãƒªä¸Šã®ã¿ã§ã¯`get_materials()`ãŒç©ºã«ãªã‚‹ï¼‰
2. **ã‚¹ã‚­ãƒ¼ãƒæ•´åˆæ€§**: SQLã‚¯ã‚¨ãƒªã¯å®Ÿéš›ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ¼ãƒã¨ä¸€è‡´ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ˆsource_url vs verification_notesç­‰ï¼‰
3. **ã‚­ãƒ¼åã®çµ±ä¸€**: å†…éƒ¨ã‚­ãƒ¼åï¼ˆsubqueriesï¼‰ã¨å¤–éƒ¨APIåï¼ˆsearchesï¼‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ä¸€è²«ã•ã›ã‚‹ã“ã¨

##### å¤–éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `docs/archive/O7_MCP_TOOL_CONFORMANCE.md`

##### ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

| ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ | å¯¾è±¡ |
|------------|------|
| `docs/sequences/search_pipeline_flow.md` | å•é¡Œ1: searchãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ |
| `docs/sequences/get_status_flow.md` | å•é¡Œ2: get_status |
| `docs/sequences/get_materials_flow.md` | å•é¡Œ3: get_materials |

##### ãƒ‡ãƒãƒƒã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | å¯¾è±¡ |
|----------|------|
| `tests/scripts/debug_search_pipeline_flow.py` | searchãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ |
| `tests/scripts/debug_get_status_flow.py` | get_status |
| `tests/scripts/debug_get_materials_flow.py` | get_materials |
| `tests/scripts/debug_other_tools_flow.py` | calibrateç­‰ |
| `tests/scripts/debug_e2e_mcp_flow.py` | E2Eçµ±åˆãƒ†ã‚¹ãƒˆ |

#### O.8 å®ŸMCPçµ±åˆæ¤œè¨¼ âœ… å®Œäº†

**ç›®çš„**: O.6/O.7ã®ã‚³ãƒ¼ãƒ‰ä¿®æ­£ãŒå®Ÿéš›ã®MCPé‹ç”¨ã§æ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼

**æ¤œè¨¼æ—¥**: 2025-12-15

##### èƒŒæ™¯

O.6/O.7ã§ã¯ä»¥ä¸‹ã‚’ä¿®æ­£:
- èªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³å†åˆ©ç”¨ã€ãƒ¬ãƒ¼ãƒˆåˆ¶å¾¡ã€çµŒè·¯æœ€é©åŒ–ï¼ˆO.6ï¼‰
- searchãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³DBæ°¸ç¶šåŒ–ã€get_status/get_materialsã‚¹ã‚­ãƒ¼ãƒæ•´åˆï¼ˆO.7ï¼‰

ã—ã‹ã—ã€ã“ã‚Œã‚‰ã¯**ãƒ‡ãƒãƒƒã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨ï¼‰**ã§ã®æ¤œè¨¼ã§ã‚ã‚Šã€**å®Ÿéš›ã®MCPã‚µãƒ¼ãƒãƒ¼+Cursor AIé€£æº**ã§ã®æ¤œè¨¼ã¯æœªå®Ÿæ–½ã€‚

##### æ¤œè¨¼ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---|--------|------|----------|
| 1 | MCPã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª | `./scripts/dev.sh`ã§MCPã‚µãƒ¼ãƒãƒ¼ãŒæ­£å¸¸èµ·å‹•ã™ã‚‹ã‹ | âœ… ç¢ºèªæ¸ˆ |
| 2 | create_taskå®Ÿå‘¼ã³å‡ºã— | Cursor AIã‹ã‚‰`create_task`ã‚’å‘¼ã³å‡ºã—ã€ã‚¿ã‚¹ã‚¯ãŒDBã«ä½œæˆã•ã‚Œã‚‹ã‹ | âœ… å‹•ä½œç¢ºèª |
| 3 | searchå®Ÿå‘¼ã³å‡ºã— | å®Ÿéš›ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹â†’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æŠ½å‡ºâ†’claimsæ°¸ç¶šåŒ–ãŒå‹•ä½œã™ã‚‹ã‹ | âš ï¸ éƒ¨åˆ†å‹•ä½œ |
| 4 | get_statuså®Ÿå‘¼ã³å‡ºã— | searchesé…åˆ—ã€metricsã€budgetãŒæ­£ã—ãè¿”ã‚‹ã‹ | ğŸ”œ æœªæ¤œè¨¼ |
| 5 | get_materialså®Ÿå‘¼ã³å‡ºã— | claims/fragments/evidence_graphãŒDBã‹ã‚‰å–å¾—ã§ãã‚‹ã‹ | ğŸ”œ æœªæ¤œè¨¼ |
| 6 | èªè¨¼ãƒ•ãƒ­ãƒ¼ç¢ºèª | èªè¨¼è¦æ±‚ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹â†’èªè¨¼å¾…ã¡â†’ã‚»ãƒƒã‚·ãƒ§ãƒ³å†åˆ©ç”¨ãŒå‹•ä½œã™ã‚‹ã‹ | âš ï¸ éƒ¨åˆ†å‹•ä½œ |
| 7 | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | å„ç¨®ã‚¨ãƒ©ãƒ¼ï¼ˆChromeæœªèµ·å‹•ã€ã‚¿ã‚¹ã‚¯ä¸å­˜åœ¨ç­‰ï¼‰ãŒé©åˆ‡ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã‹ | ğŸ”œ æœªæ¤œè¨¼ |

##### 2025-12-15 æ¤œè¨¼çµæœ

###### ç™ºè¦‹ã—ãŸå•é¡Œã¨ä¿®æ­£

| å•é¡Œ | åŸå›  | å¯¾å‡¦ |
|------|------|------|
| searchã§arxivã‚¨ãƒ³ã‚¸ãƒ³ãŒé¸æŠã•ã‚Œã‚¨ãƒ©ãƒ¼ | `SearchExecutor`ã«enginesã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæ¸¡ã•ã‚Œã¦ã„ãªã‹ã£ãŸ | `executor.py`, `pipeline.py`ã‚’ä¿®æ­£ã—ã¦enginesã‚’ä¼æ¬ |
| ãƒ‘ãƒ¼ã‚µãƒ¼æœªå¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³ | wikipedia, arxivç­‰ã®ãƒ‘ãƒ¼ã‚µãƒ¼ãŒæœªå®Ÿè£… | duckduckgoç­‰ãƒ‘ãƒ¼ã‚µãƒ¼å¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ˜ç¤ºæŒ‡å®šã§å›é¿ |

###### å‹•ä½œç¢ºèªã§ããŸé …ç›®

1. **Chrome CDPæ¥ç¶š**: âœ… `./scripts/chrome.sh start`ã§æ­£å¸¸èµ·å‹•ã€CDPæ¥ç¶šæˆåŠŸ
2. **DuckDuckGoæ¤œç´¢**: âœ… 10ä»¶ã®æ¤œç´¢çµæœã‚’å–å¾—
3. **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ•ã‚§ãƒƒãƒ**: âœ… è¤‡æ•°ã‚µã‚¤ãƒˆï¼ˆBritannica, countryaah, worldatlasç­‰ï¼‰ã‹ã‚‰ãƒ•ã‚§ãƒƒãƒæˆåŠŸ
4. **Waybackãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: âœ… Wikipediaï¼ˆhcaptchaï¼‰ã§Wayback Machineãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆåŠŸ
5. **èªè¨¼å¾…ã¡ã‚­ãƒ¥ãƒ¼**: âœ… hcaptchaæ¤œå‡ºâ†’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ å‹•ä½œç¢ºèª
6. **DBæ°¸ç¶šåŒ–**: âœ… claims: 12ä»¶, fragments: 2ä»¶, edges: 12ä»¶ãŒDBã«ä¿å­˜

###### æ®‹å­˜ã™ã‚‹å•é¡Œ

| å•é¡Œ | è©³ç´° | å„ªå…ˆåº¦ | çŠ¶æ…‹ |
|------|------|--------|:----:|
| ãƒ•ã‚§ãƒƒãƒå‡¦ç†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | æ¤œç´¢å¾Œã®ãƒ•ã‚§ãƒƒãƒå‡¦ç†ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚‹ | ä¸­ | â³ |
| wayback_success_countã‚«ãƒ©ãƒ ä¸å­˜åœ¨ | Waybackãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¾Œã®DBæ›´æ–°ã§ã‚¨ãƒ©ãƒ¼ | ä¸­ | âœ… è§£æ±º |
| fragmentsæ•°ãŒå°‘ãªã„ | 5ãƒšãƒ¼ã‚¸ãƒ•ã‚§ãƒƒãƒã§2fragmentsã®ã¿ï¼ˆæœŸå¾…å€¤ã‚ˆã‚Šå°‘ãªã„ï¼‰ | ä¸­ | âœ… è§£æ±º |
| ãƒ‘ãƒ¼ã‚µãƒ¼æœªå¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³é¸æŠ | wikipedia, wikidata, arxiv, marginaliaç­‰ã®ãƒ‘ãƒ¼ã‚µãƒ¼ãŒæœªå®Ÿè£…ã ãŒé¸æŠã•ã‚Œã¦ã„ãŸ | ä¸­ | âœ… è§£æ±º |

**2025-12-15 è¿½åŠ å¯¾å‡¦**:
- **wayback_success_count**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ï¼ˆ`scripts/migrate.py`ï¼‰ã€`001_add_wayback_columns.sql`é©ç”¨
- **fragmentsæ•°ãŒå°‘ãªã„**: åŸå› ã¯FOREIGN KEYåˆ¶ç´„ï¼ˆpage_idä¸å­˜åœ¨ï¼‰ã€‚`fetcher.py`ã‚’ä¿®æ­£ã—ã¦page_idã‚’FetchResultã«å«ã‚ã‚‹ã‚ˆã†å¯¾å¿œ

###### DBçŠ¶æ…‹ï¼ˆæ¤œè¨¼æ™‚ç‚¹ï¼‰

```
tasks: 24
claims: 12
fragments: 2
edges: 12

Recent claims:
- "Paris is the capital of France..."
- "Where in the World is Paris found?..."
```

##### æ¤œè¨¼æ‰‹é †

```bash
# 1. é–‹ç™ºç’°å¢ƒèµ·å‹•
./scripts/dev.sh up

# 2. Chrome CDPèµ·å‹•
./scripts/chrome.sh start

# 3. MCPã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª
# Cursor IDEå´ã§ .cursor/mcp.json ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

# 4. Cursor AIã‹ã‚‰MCPãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã—
# - create_task â†’ search â†’ get_status â†’ get_materials â†’ stop_task

# 5. DBç¢ºèª
python -c "import sqlite3; c=sqlite3.connect('data/lyra.db'); print(c.execute('SELECT COUNT(*) FROM claims').fetchone())"
```

##### æˆåŠŸåŸºæº–

1. **create_task**: âœ… ã‚¿ã‚¹ã‚¯IDãŒè¿”ã‚Šã€`tasks`ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡ŒãŒä½œæˆã•ã‚Œã‚‹
2. **search**: 
   - âœ… `claims_found`é…åˆ—ã«1ä»¶ä»¥ä¸Šã®claim
   - âœ… `claims`ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ°¸ç¶šåŒ–ã•ã‚Œã¦ã„ã‚‹
   - âš ï¸ `fragments`ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®æ°¸ç¶šåŒ–ãŒå°‘ãªã„
3. **get_status**: ğŸ”œ `searches`é…åˆ—ãŒç©ºã§ãªã„ã€`metrics.total_claims >= 1`
4. **get_materials**: ğŸ”œ `claims`/`fragments`é…åˆ—ãŒç©ºã§ãªã„ã€`evidence_graph.nodes`ãŒå­˜åœ¨
5. **èªè¨¼ãƒ•ãƒ­ãƒ¼**: âš ï¸ èªè¨¼å¾…ã¡ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã¯å‹•ä½œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†åˆ©ç”¨ã¯æœªæ¤œè¨¼

##### è¿½åŠ å¯¾å‡¦ï¼ˆ2025-12-15å®Œäº†ï¼‰

###### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ å°å…¥

DBã‚¹ã‚­ãƒ¼ãƒã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®ãŸã‚ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’å°å…¥:

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” |
|---------|------|
| `scripts/migrate.py` | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ãƒ³ãƒŠãƒ¼CLI |
| `migrations/` | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«æ ¼ç´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |
| `migrations/001_add_wayback_columns.sql` | wayback_success/failure_countè¿½åŠ  |
| `src/storage/schema.sql` | schema_migrationsè¡¨è¿½åŠ ã€waybackã‚«ãƒ©ãƒ è¿½åŠ  |
| `src/storage/database.py` | `run_migrations()`ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ  |
| `tests/test_migrations.py` | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆï¼ˆ20ä»¶ï¼‰ |

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½¿ç”¨æ–¹æ³•:
```bash
python scripts/migrate.py up       # é©ç”¨
python scripts/migrate.py status   # ç¢ºèª
python scripts/migrate.py create NAME  # æ–°è¦ä½œæˆ
```

###### fragmentæ°¸ç¶šåŒ–ä¿®æ­£

åŸå› : ãƒ•ã‚§ãƒƒãƒæ™‚ã«`page_id`ãŒFetchResultã«å«ã¾ã‚Œã¦ã„ãªã‹ã£ãŸãŸã‚ã€FOREIGN KEYåˆ¶ç´„ã§`fragments`ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®INSERTãŒå¤±æ•—ã—ã¦ã„ãŸã€‚

å¯¾å‡¦:
- `src/crawler/fetcher.py`: `FetchResult`ã«`page_id`å±æ€§ã‚’è¿½åŠ 
- DBæŒ¿å…¥å¾Œã«`result.page_id = page_id`ã‚’è¨­å®š

##### ãƒ†ã‚¹ãƒˆçµæœ

```
2922 passed, 21 skipped (test_migrations.py 20ä»¶ã‚’å«ã‚€)
```

##### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. ãƒ•ã‚§ãƒƒãƒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå•é¡Œã®èª¿æŸ»ãƒ»ä¿®æ­£ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰
2. ãƒ‘ãƒ¼ã‚µãƒ¼æœªå¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³ã®å®Ÿè£…ï¼ˆå„ªå…ˆåº¦ï¼šä½ï¼‰
3. get_status/get_materialsã®å®Ÿå‘¼ã³å‡ºã—æ¤œè¨¼
4. ãƒ‘ãƒ¼ã‚µãƒ¼æœªå¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³ã®å¯¾å¿œï¼ˆwikipediaç­‰ï¼‰

##### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- O.6è©³ç´°: `docs/archive/O6_ADDITIONAL_ISSUES.md`
- O.7è©³ç´°: `docs/archive/O7_MCP_TOOL_CONFORMANCE.md`
- MCPè¨­å®š: `.cursor/mcp.json`
- èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ: `scripts/dev.sh`

##### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆO.8ï¼‰

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |
|----------|----------|
| `src/research/executor.py` | enginesãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ ã€search_serpã¸ã®ä¼æ¬ |
| `src/research/pipeline.py` | SearchExecutor.execute()ã«enginesã‚’æ¸¡ã™ã‚ˆã†ä¿®æ­£ |
| `src/crawler/fetcher.py` | ç´¯ç©ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆmax_fetch_timeï¼‰å®Ÿè£…ã€fetch_urlé–¢æ•°ãƒªãƒ•ã‚¡ã‚¯ã‚¿ |
| `src/utils/config.py` | CrawlerConfigã«max_fetch_time=90ç§’è¿½åŠ  |
| `tests/test_fetcher.py` | TestFetchUrlCumulativeTimeoutè¿½åŠ ï¼ˆ5ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰ |
| `tests/test_mcp_integration.py` | get_status/get_materialsçµ±åˆãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆ6ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰ |

##### O.8 è¿½åŠ ä¿®æ­£å†…å®¹ï¼ˆ2025-12-15ï¼‰

**1. ç´¯ç©ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæˆ¦ç•¥ã®å®Ÿè£…**

å•é¡Œ: `fetch_url`é–¢æ•°ã«ã¯ç´¯ç©ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒãªãã€å„ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆHTTPâ†’ãƒ–ãƒ©ã‚¦ã‚¶ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹â†’ãƒ˜ãƒƒãƒ‰ãƒ•ãƒ«â†’Undetected ChromeDriverâ†’Waybackï¼‰ãŒé †æ¬¡ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹ãŸã‚ã€æœ€æ‚ªã‚±ãƒ¼ã‚¹ã§1URLã«120-180ç§’ä»¥ä¸Šã‹ã‹ã‚‹å¯èƒ½æ€§ãŒã‚ã£ãŸã€‚

å¯¾ç­–:
- `max_fetch_time`è¨­å®šè¿½åŠ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ90ç§’ï¼‰
- `fetch_url`ã‚’`_fetch_url_impl`ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã—ã€`asyncio.wait_for`ã§ãƒ©ãƒƒãƒ—
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã¯`reason="cumulative_timeout"`ã‚’è¿”å´

**2. ãƒ†ã‚¹ãƒˆæ‹¡å……**

- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰
- get_status/get_materialsçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ6ã‚±ãƒ¼ã‚¹ï¼‰
- E2Eæ¤œè¨¼: `verify_mcp_integration.py --basic`ã§11ãƒ„ãƒ¼ãƒ«å…¨ã¦ãƒ‘ã‚¹

**3. ãƒ‘ãƒ¼ã‚µãƒ¼æœªå¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³é¸æŠå•é¡Œã®ä¿®æ­£ï¼ˆ2025-12-18ï¼‰**

å•é¡Œ: ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠæ™‚ã«ãƒ‘ãƒ¼ã‚µãƒ¼æœªå®Ÿè£…ã®ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆ`arxiv`, `wikipedia`, `marginalia`ç­‰ï¼‰ãŒé¸æŠã•ã‚Œã€`No parser available for engine: xxx`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãŸã€‚

æ ¹æœ¬åŸå› :
- `get_engines_for_category()`ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã§ã€`category_engines`ã«å®šç¾©ãŒãªã„ã‚«ãƒ†ã‚´ãƒªã®å ´åˆã€å…¨ã‚¨ãƒ³ã‚¸ãƒ³å®šç¾©ã®`categories`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰ãƒãƒƒãƒãƒ³ã‚°ã—ã¦ã„ãŸ
- `engines.yaml`ã®`category_engines`ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã¦ã„ã¦ã‚‚ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã§é¸æŠã•ã‚Œã¦ã—ã¾ã£ã¦ã„ãŸ

å¯¾ç­–:
- `SearchEngineConfigManager.get_engines_with_parsers()`ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ : ãƒ‘ãƒ¼ã‚µãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- `BrowserSearchProvider.search()`ã§ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠæ™‚ã«ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’é©ç”¨
- `get_engines_for_category()`ã®`category_engines`å–å¾—æ™‚ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚ã®ä¸¡æ–¹ã§ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’é©ç”¨

å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«:
- `src/search/engine_config.py`: `get_engines_with_parsers()`è¿½åŠ ã€`get_engines_for_category()`ä¿®æ­£
- `src/search/browser_search_provider.py`: ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠãƒ­ã‚¸ãƒƒã‚¯ã«ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°è¿½åŠ 
- `tests/test_engine_config.py`: ãƒ†ã‚¹ãƒˆä¿®æ­£ï¼ˆãƒ‘ãƒ¼ã‚µãƒ¼æœªå¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³ãŒé™¤å¤–ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰

ãƒ†ã‚¹ãƒˆçµæœ: 49ä»¶ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹

---

### Phase P: ãƒˆãƒ©ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«ãƒ»ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•è¨­è¨ˆå¤‰æ›´ â³

**ç›®çš„**: ãƒˆãƒ©ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«ã¨ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•ã®è¨­è¨ˆã‚’æ”¹å–„ã—ã€ç§‘å­¦çš„è«–äº‰ã¨èª¤æƒ…å ±ã‚’é©åˆ‡ã«åŒºåˆ¥ã—ã€é«˜æ¨è«–AIã¸ã®æƒ…å ±æä¾›ã‚’å……å®Ÿã•ã›ã‚‹ã€‚

**è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `docs/EVIDENCE_SYSTEM.md`

**ä¸»ãªå¤‰æ›´å†…å®¹**:

1. **ã‚¨ãƒƒã‚¸ã¸ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚«ãƒ†ã‚´ãƒªæƒ…å ±è¿½åŠ ** âœ… (2025-12-20 å®Œäº†)
   - `edges`ãƒ†ãƒ¼ãƒ–ãƒ«ã«`source_domain_category`, `target_domain_category`ã‚«ãƒ©ãƒ è¿½åŠ 
   - REFUTESã‚¨ãƒƒã‚¸ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚«ãƒ†ã‚´ãƒªæƒ…å ±ã‚’ä»˜ä¸ã—ã€é«˜æ¨è«–AIãŒã€Œç§‘å­¦çš„è«–äº‰ã‹èª¤æƒ…å ±ã‹ã€ã‚’åˆ¤æ–­å¯èƒ½ã«ã™ã‚‹
   - ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚«ãƒ†ã‚´ãƒªã¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°èª¿æ•´ç”¨ã§ã‚ã‚Šã€ä¿¡é ¼åº¦è¨ˆç®—ã‚„æ¤œè¨¼åˆ¤å®šã«ã¯ä½¿ç”¨ã—ãªã„
   - ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ†é¡ã¯ `DomainCategory` ã«çµ±ä¸€ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°èª¿æ•´å°‚ç”¨ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºåŒ–ï¼‰
   - `ReasonCode` enum å°å…¥ï¼ˆäº‹å®Ÿãƒ™ãƒ¼ã‚¹ã®ç†ç”±ã‚³ãƒ¼ãƒ‰ï¼‰
   - æ¤œè¨¼åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‹ã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚«ãƒ†ã‚´ãƒªä¾å­˜ã‚’é™¤å»ï¼ˆThinking-Workingåˆ†é›¢ï¼‰
   - `category_weight` ã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«é©ç”¨

2. **å¼•ç”¨è¿½è·¡ã®å®Œå…¨å®Ÿè£…ï¼ˆæ±ºå®š11: Budgeted Citation Expansionï¼‰** â³
   - **OpenAlexçµ±åˆ**: `get_references()` / `get_citations()` å®Ÿè£…ã€S2ã¨ã®çµ±åˆ
   - **3æ®µéšãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**:
     - Stage 0: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å³æ™‚ãƒ•ã‚£ãƒ«ã‚¿
     - Stage 1: Embedding + impact_scoreï¼ˆç²—ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
     - Stage 2: LLMæœ‰ç”¨æ€§è©•ä¾¡ï¼ˆç²¾å¯†ãƒ•ã‚£ãƒ«ã‚¿ã€Qwen2.5 3Bä½¿ç”¨ï¼‰
   - **pagesè‡ªå‹•è¿½åŠ **: é¸æŠœã•ã‚ŒãŸå¼•ç”¨å…ˆè«–æ–‡ã‚’pagesãƒ†ãƒ¼ãƒ–ãƒ«ã«è‡ªå‹•ç™»éŒ²
   - **è¨­å®š**: `search.citation_filter.*` ãŠã‚ˆã³ `citation_graph_top_n_papers`

3. **is_influential ã®å®Œå…¨æ’é™¤ï¼ˆæ±ºå®š12ï¼‰** âœ…
   - Semantic Scholarå°‚ç”¨ãƒ•ãƒ©ã‚° `is_influential` ã‚’ã‚¹ã‚­ãƒ¼ãƒãƒ»ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å‰Šé™¤
   - ä»£æ›¿ã¨ã—ã¦ `Paper.citation_count` ã‹ã‚‰ç®—å‡ºã™ã‚‹ `impact_score`ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«æ­£è¦åŒ–ï¼‰ã‚’ä½¿ç”¨
   - Phase J.2 ã§å°å…¥ã•ã‚ŒãŸ `is_influential` é–¢é€£ã‚³ãƒ¼ãƒ‰ã‚’æ¸…æƒ
   - ã‚³ãƒŸãƒƒãƒˆ: `0869de0`

4. **ãƒ™ã‚¤ã‚ºä¿¡é ¼åº¦ãƒ¢ãƒ‡ãƒ«ã®å°å…¥ï¼ˆæ±ºå®š7ï¼‰** â³
   - ç„¡æƒ…å ±äº‹å‰åˆ†å¸ƒ Beta(1, 1) + ãƒ™ã‚¤ã‚ºæ›´æ–°ã«ã‚ˆã‚‹ä¿¡é ¼åº¦è¨ˆç®—
   - confidence, uncertainty, controversy ã®3å€¤ã‚’å‡ºåŠ›
   - ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ†é¡ã«ä¾å­˜ã—ãªã„ç´”ç²‹ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ä¸»ç¾©

5. **çŸ›ç›¾æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ã®æ”¹å–„** â³
   - å³æ™‚BLOCKEDã‚’ç·©å’Œ
   - ã‚¨ãƒƒã‚¸æƒ…å ±ã«åŸºã¥ãåˆ¤æ–­åŸºæº–ã®å°å…¥

**å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—**: `docs/EVIDENCE_SYSTEM.md` Â§å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—å‚ç…§

**çŠ¶æ…‹**: âœ… Phase 2 å®Œäº†ï¼ˆ`0869de0`, `993f333`ï¼‰ã€Phase 3-4 å®Ÿè£…å¾…ã¡

---

## 7. é–‹ç™ºç’°å¢ƒ

### 7.1 èµ·å‹•æ–¹æ³•

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
./scripts/dev.sh up

# é–‹ç™ºã‚·ã‚§ãƒ«
./scripts/dev.sh shell

# ãƒ­ã‚°ç¢ºèª
./scripts/dev.sh logs

# åœæ­¢
./scripts/dev.sh down
```

### 7.2 ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆï¼‰

**WSLå´ï¼ˆvenvï¼‰**:
- MCPã‚µãƒ¼ãƒãƒ¼ï¼ˆCursor IDEã¨stdioã§é€šä¿¡ï¼‰
- Playwrightï¼ˆChrome CDPæ¥ç¶šï¼‰

**ã‚³ãƒ³ãƒ†ãƒŠå´**:
- `lyra` - ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ï¼ˆOllama/ML Serverã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
- `lyra-ml` - åŸ‹ã‚è¾¼ã¿/ãƒªãƒ©ãƒ³ã‚«ãƒ¼/NLI
- `lyra-ollama` - ãƒ­ãƒ¼ã‚«ãƒ«LLM (GPUå¯¾å¿œ)
- `lyra-tor` - Torãƒ—ãƒ­ã‚­ã‚·

**æ³¨æ„**: SearXNGã¯å»ƒæ­¢æ¸ˆã¿ï¼ˆPhase Cå‚ç…§ï¼‰

### 7.3 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**WSLå´ï¼ˆvenvä½¿ç”¨ãƒ»æ¨å¥¨ï¼‰**:
```bash
cd /home/statuser/lyra
source .venv/bin/activate
pytest tests/ -m 'not e2e' --tb=short -q
```

**ã‚³ãƒ³ãƒ†ãƒŠå´ï¼ˆå¾“æ¥æ–¹å¼ï¼‰**:
```bash
podman exec lyra pytest tests/ -m 'not e2e' --tb=short -q
```

Phase G.2 ã‚‚å‚ç…§ã€‚

### 7.4 E2Eæ¤œè¨¼ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆï¼‰

#### 7.4.1 åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **WSL2 mirrored networkingã‚’æœ‰åŠ¹åŒ–**
   - `%USERPROFILE%\.wslconfig`ã«ä»¥ä¸‹ã‚’è¿½åŠ :
   ```ini
   [wsl2]
   networkingMode=mirrored
   ```
   - WSLã‚’å†èµ·å‹•: `wsl.exe --shutdown`

2. **venvä½œæˆ**
   ```bash
   cd /home/statuser/lyra
   python3 -m venv .venv
   source .venv/bin/activate
   pip install -r requirements-mcp.txt
   playwright install chromium
   ```

3. **å°‚ç”¨Chromeãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**ï¼ˆGoogleã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœªãƒ­ã‚°ã‚¤ãƒ³æ¨å¥¨ï¼‰

#### 7.4.2 èµ·å‹•æ‰‹é †

```bash
# 1. ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ï¼ˆOllama/ML Server/ãƒ—ãƒ­ã‚­ã‚·ï¼‰
./scripts/dev.sh up

# 2. Chromeèµ·å‹•ï¼ˆè‡ªå‹•ã¾ãŸã¯MCPã‹ã‚‰è‡ªå‹•èµ·å‹•ï¼‰
./scripts/chrome.sh start

# 3. MCPã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆCursorãŒè‡ªå‹•å®Ÿè¡Œï¼‰
# ã¾ãŸã¯æ‰‹å‹•: ./scripts/mcp.sh
```

#### 7.4.3 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# venvã‹ã‚‰ãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰
source .venv/bin/activate
python tests/scripts/verify_duckduckgo_search.py

# ãƒ—ãƒ­ã‚­ã‚·æ¥ç¶šç¢ºèª
curl http://localhost:8080/health
```

### 7.5 å¤–éƒ¨ä¾å­˜

- Ollama (Podmanã‚³ãƒ³ãƒ†ãƒŠã§èµ·å‹•ã€GPUãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼)
- Chrome (Windowså´ã§èµ·å‹•ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°)
- nvidia-container-toolkit (GPUä½¿ç”¨æ™‚ã«å¿…è¦)

**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆã§ã¯socatä¸è¦**: MCPã‚µãƒ¼ãƒãƒ¼ãŒWSLä¸Šã§ç›´æ¥å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€localhost:9222ã§Chromeã«æ¥ç¶š

---

## 8. æ³¨æ„äº‹é …

### 8.1 æŠ€è¡“çš„åˆ¶ç´„

- VRAMâ‰¤8GBç¶­æŒï¼ˆRTX 4060 Laptopï¼‰
- WSL2ãƒ¡ãƒ¢ãƒª32GBå†…ã§å‹•ä½œ
- å•†ç”¨API/æœ‰æ–™ã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨ç¦æ­¢

### 8.2 ãƒªã‚¹ã‚¯è»½æ¸›

- Cloudflare/Turnstile: æ‰‹å‹•èª˜å°UXï¼‹ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³/ã‚¹ã‚­ãƒƒãƒ—è‡ªå‹•åŒ–
- VRAMåœ§è¿«: ãƒã‚¤ã‚¯ãƒ­ãƒãƒƒãƒ/å€™è£œä¸Šé™è‡ªå‹•èª¿æ•´
