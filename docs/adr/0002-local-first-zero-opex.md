# ADR-0002: Local-First Architecture / Zero OpEx

## Status
Accepted

## Date
2024-XX-XX（プロジェクト開始時）

## Context

AI支援リサーチツールの既存選択肢には以下の課題がある：

| 課題 | 商用ツールの問題 |
|------|-----------------|
| プライバシー | 検索クエリ・収集情報がサーバーに送信・蓄積される |
| 透明性 | アルゴリズムがブラックボックス |
| コスト | API従量課金、サブスクリプション費用 |
| カスタマイズ | ドメイン固有の調整が困難 |

対象ユーザーを考えると、これらは致命的である：

- **医療機関・研究施設**: 薬剤安全性調査を外部に漏らせない
- **法務・コンプライアンス**: 調査内容の機密保持が必須
- **独立研究者・ジャーナリスト**: 商用ツールのコストが負担
- **セキュリティ監査が厳格な組織**: クローズドソースの導入困難

## Decision

**Local-First + Zero OpEx を設計原則とする。**

### Local-First

| 原則 | 実装 |
|------|------|
| 全処理ローカル完結 | 検索クエリ・収集情報は外部送信ゼロ |
| データ主権 | エビデンスグラフは手元のみに存在 |
| 再現性 | 同一環境で同一結果を得られる |

### Zero OpEx（運用コストゼロ）

| 禁止 | 許容 |
|------|------|
| 商用API（OpenAI, Google等） | MCPクライアント（Cursor等）のサブスク |
| クラウドストレージ | ローカルSQLite |
| 有償インフラ | ローカルGPU（RTX 4060等） |

### 実現方法

| コンポーネント | 商用代替 | Lyraの選択 |
|---------------|---------|-----------|
| LLM | GPT-4 API | Ollama + Qwen2.5-3B（ローカル） |
| Embedding | OpenAI Embeddings | bge-m3（ローカル） |
| Reranker | Cohere Rerank | bge-reranker-v2-m3（ローカル） |
| NLI | クラウドAPI | DeBERTa-v3（ローカル） |
| 検索 | Google API | ブラウザ自動化 + 公開検索エンジン |
| ストレージ | クラウドDB | SQLite + ローカルファイル |

### ハードウェア前提

| リソース | 前提値 |
|---------|-------|
| OS | Windows 11 + WSL2 Ubuntu |
| RAM | Host 64GB、WSL2 32GB |
| GPU | NVIDIA RTX 4060 Laptop（8GB VRAM） |
| 処理時間 | GPU: ~20分/タスク、CPU: ~25分/タスク |

## Consequences

### Positive
- **プライバシー保証**: 調査内容が外部に漏れない
- **コスト予測可能**: ハードウェア初期投資のみ、ランニングコストなし
- **オフライン動作**: ネットワーク検索以外はオフラインで完結
- **監査可能**: 全コードがOSS、第三者監査が可能

### Negative
- **ハードウェア要件**: GPU推奨（8GB VRAM）、高性能PC必要
- **推論品質**: ローカルLLM（3B）はクラウドLLM（100B+）より低品質
- **セットアップ複雑**: WSL2 + Podman + Ollama の構築が必要
- **更新の手間**: モデル更新は手動

## Alternatives Considered

| Alternative | Pros | Cons | 判定 |
|-------------|------|------|------|
| 商用API併用（抽出のみ） | 高品質抽出 | データ流出、コスト発生 | 却下 |
| クラウドホスティング | セットアップ不要 | プライバシー違反、コスト | 却下 |
| 軽量モデルのみ（CPU） | ハードウェア要件緩和 | 処理時間増大、品質低下 | 部分採用（フォールバック） |

## References
- `docs/archive/REQUIREMENTS.md` §1.0, §2（アーカイブ）
- `README.md` "Complete Local Processing"
- `.env.example` - 環境設定例
