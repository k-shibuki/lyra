# ADR-0002: Thinking-Working Separation

## Date
2025-11-01

## Context

AIを活用した調査支援ツールには大きく2つのアプローチがある：

1. **単一AIモデルで完結**: 1つの高性能モデルが調査計画から実行まで担当
2. **分離アーキテクチャ**: 思考（計画・判断）と作業（実行）を分離

単一モデルアプローチの問題点：

| 問題 | 詳細 |
|------|------|
| コスト | GPT-4/Claudeクラスの常時使用は高コスト |
| レイテンシ | 大規模モデルは応答が遅い |
| ローカル実行困難 | 70B+モデルは一般的なGPUで動作しない |

一方、ローカルの小型モデル（3B-7B）は：
- 抽出・分類などの機械的タスクは高精度で実行可能
- 複雑な推論・計画立案は苦手

## Decision

**「思考」と「作業」を明確に分離し、それぞれに最適なコンポーネントを割り当てる。**

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│  MCP Client (Claude Desktop / Cline / etc.)                 │
│  ─────────────────────────────────────────────────────────  │
│  • 調査計画の策定                                            │
│  • 探索戦略の決定                                            │
│  • 結果の解釈・統合                                          │
│  • ユーザーとの対話                                          │
└─────────────────────────────────────────────────────────────┘
                              │ MCP Protocol
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  Lyra (MCP Server)                                          │
│  ─────────────────────────────────────────────────────────  │
│  • Webクローリング実行                                       │
│  • テキスト抽出・構造化                                      │
│  • NLI判定（SUPPORTS/REFUTES/NEUTRAL）                      │
│  • データ永続化                                              │
└─────────────────────────────────────────────────────────────┘
```

### 責務の分離

| 機能 | 担当 | 理由 |
|------|------|------|
| 調査クエリの設計 | MCPクライアント | 戦略的判断が必要 |
| 検索実行 | Lyra | 機械的実行 |
| 抽出すべき情報の指示 | MCPクライアント | 文脈理解が必要 |
| テキストからの抽出 | Lyra | パターンマッチング |
| エビデンスの評価・統合 | MCPクライアント | 高度な推論 |
| NLI分類 | Lyra | 3択分類タスク |

### 具体例

```
ユーザー: 「気候変動が農業生産性に与える影響を調べて」

MCPクライアント（思考）:
  1. 「climate change agriculture productivity」で検索
  2. 主要な論文を特定
  3. 各論文から「影響の方向性」「影響の大きさ」を抽出指示
  4. 収集したエビデンスを統合して回答

Lyra（作業）:
  1. 検索クエリを実行
  2. ページをクロール・保存
  3. 指定されたフィールドを抽出
  4. NLI判定を実行
```

## Consequences

### Positive
- **コスト最適化**: 高コストモデルは思考のみ、作業はローカル
- **品質担保**: 各コンポーネントが得意なタスクに集中
- **柔軟性**: MCPクライアントを自由に選択可能
- **ローカル実行**: ADR-0001のZero OpEx原則と整合

### Negative
- **クライアント依存**: MCPクライアントの品質に全体が依存
- **通信オーバーヘッド**: MCP経由のやり取りが発生
- **設計複雑性**: 責務分離の境界設計が必要

## Alternatives Considered

| Alternative | Pros | Cons | 判定 |
|-------------|------|------|------|
| 単一ローカルLLM | シンプル | 推論品質が低い | 却下 |
| 単一クラウドAPI | 高品質 | コスト大、Zero OpEx違反 | 却下 |
| Agent Framework (LangChain等) | 柔軟 | 抽象化過多、MCP非対応 | 却下 |

## References
- `docs/REQUIREMENTS.md` 1.2節（アーカイブ）
- MCP仕様: https://modelcontextprotocol.io
- ADR-0001: Local-First / Zero OpEx
