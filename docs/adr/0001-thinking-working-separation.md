# ADR-0001: Thinking-Working Separation

## Status
Accepted

## Date
2024-XX-XX（プロジェクト開始時）

## Context

AI支援リサーチツールを設計する際、2つの異なる能力が必要になる：

1. **戦略的推論（Thinking）**: 「何を調べるべきか」「次にどうするか」の判断
2. **機械的実行（Working）**: 検索実行、HTML解析、データ抽出

単一システムで両方を処理すると以下の問題が発生する：

| 問題 | 詳細 |
|------|------|
| コンテキスト汚染 | 生HTML、レート制限エラー、パース詳細が戦略的思考を妨げる |
| 推論コストの浪費 | 大規模LLMが機械的作業のトークンも処理してしまう |
| 再現性低下 | 思考と作業が混在し、調査セッションの監査が困難 |

さらに、ローカルで動作可能なLLM（Qwen2.5-3B、8GB VRAM）はクラウドLLM（Claude、GPT-4）と比較して推論能力が大幅に劣る。学術調査の品質を担保するには、戦略判断に高性能LLMが必須である。

## Decision

**思考と作業を明確に分離する。**

### 責任分界

| 責任領域 | Thinking（MCPクライアント） | Working（Lyra） |
|---------|---------------------------|-----------------|
| 問いの分解 | クエリ設計・優先度決定 | — |
| クエリ生成 | すべてのクエリ設計 | 機械的展開のみ（同義語・演算子付与） |
| 探索制御 | 次のアクション判断 | メトリクス計算と報告 |
| 反証探索 | 反証クエリの設計 | パターン適用（「課題」「批判」接尾辞） |
| 停止判断 | 探索の終了指示 | 停止条件の報告 |
| レポート構成 | 論理構成・執筆 | 素材（断片・引用）の提供 |

### Lyraの制約

**行うこと:**
- MCPクライアントが指定したクエリの実行
- 検索→フェッチ→抽出→評価パイプライン
- メトリクス（収穫率・充足度・新規性）の計算と報告

**行わないこと:**
- クエリの設計・候補提案
- 「次に何をすべきか」の推奨
- 探索の戦略的判断

### ローカルLLMの用途制限

Lyra内蔵のQwen2.5-3Bは機械的処理に限定：

| 許可 | 禁止 |
|------|------|
| 事実/主張抽出 | クエリ設計・候補生成 |
| 固有表現認識 | 探索戦略の判断 |
| 言語横断翻訳 | 優先度決定 |
| コンテンツ品質判定 | レポート論理構成 |

## Consequences

### Positive
- **高品質な戦略判断**: Claude/GPT-4クラスの推論を戦略に集中
- **クリーンなコンテキスト**: MCPクライアントは構造化結果のみ受信
- **監査可能性**: 思考ログとLyra作業ログが分離
- **再現性**: Lyraの作業は決定論的

### Negative
- **MCPクライアント依存**: Lyra単体では戦略判断不可
- **往復オーバーヘッド**: 判断ごとにMCP往復
- **クライアント品質依存**: 低品質クライアントLLMは調査品質を低下させる

## Alternatives Considered

| Alternative | Pros | Cons | 判定 |
|-------------|------|------|------|
| Lyra内で全自動化 | クライアント不要 | ローカルLLM推論品質が不足、学術調査に不適 | 却下 |
| ハイブリッド（Lyraが候補提案） | 往復削減 | 責任境界が曖昧、低品質提案のリスク | 却下 |
| 完全クラウド依存 | シンプル | データ流出、Zero OpEx違反 | 却下 |

## References
- `docs/archive/REQUIREMENTS.md` §2.1（アーカイブ）
- `README.md` "Why Thinking-Working Separation?"
