# wf-pr

リモートのPull Requestをレビューし、マージ判断・テスト・マージを行う。

**注意**: これは `/wf-dev` とは独立したワークフローです。

## 関連ルール
- コード実行時: @.cursor/rules/code-execution.mdc
- テスト関連: @.cursor/rules/test-strategy.mdc
- git commit: @.cursor/rules/commit-message-format.mdc

## ワークフロー概要

```
┌─────────────────────────────────────────────────────────────┐
│  1. PR取得        リモートからPRブランチを取得               │
│         ↓                                                    │
│  2. コードレビュー 変更内容を確認・問題点を指摘              │
│         ↓                                                    │
│  3. 品質確認      /quality-check を実行                     │
│         ↓                                                    │
│  4. 回帰テスト    /regression-test を実行                   │
│         ↓                                                    │
│  5. マージ判断    マージ可否を判断し、理由を説明             │
│         ↓                                                    │
│  6. マージ実行    承認後、mainにマージ                       │
└─────────────────────────────────────────────────────────────┘
```

## 1. PR取得

```bash
# リモートの最新情報を取得
git fetch origin

# PRブランチ一覧を確認（リモートブランチ）
git branch -r

# PRブランチをチェックアウト
git checkout -b <pr-branch> origin/<pr-branch>
```

## 2. コードレビュー

### 確認項目

| カテゴリ | 確認内容 |
|---------|---------|
| **変更概要** | 変更ファイル一覧、差分行数 |
| **コード品質** | 可読性、命名規則、重複排除 |
| **仕様準拠** | `docs/REQUIREMENTS.md` との整合性 |
| **テスト** | テストの有無、カバレッジ |
| **セキュリティ** | 認証・認可、データ検証 |

### 差分確認コマンド

```bash
# mainとの差分を確認
git diff main..HEAD --stat
git diff main..HEAD
```

## 3. 品質確認

`/quality-check` コマンドを実行。lint/型エラーを確認・修正。

## 4. 回帰テスト

`/regression-test` コマンドを実行。全テストがパスすることを確認。

## 5. マージ判断

### マージ可能条件
- [ ] コードレビューで重大な問題がない
- [ ] lint/型エラーがない（`/quality-check` パス）
- [ ] 全テストがパス（`/regression-test` パス）
- [ ] 仕様書との整合性が取れている

### 判断結果の提示

```
## マージ判断

### 結論: ✅ マージ可能 / ❌ 修正必要

### 理由
- 変更内容が仕様に準拠している
- テストが全てパス
- コード品質に問題なし

### 指摘事項（ある場合）
1. xxx について修正が必要
2. yyy の追加を推奨
```

## 6. マージ実行

ユーザー承認後にのみ実行。`/merge-complete` と同様の手順。

```bash
git checkout main
git merge --no-edit <pr-branch>
```

**注意**: `--no-edit` オプションで対話を避ける。

## 出力

- PR概要（ブランチ名、変更ファイル、差分行数）
- コードレビュー結果
- 品質確認結果（lint/型）
- テスト結果サマリ
- マージ判断（理由付き）
- マージ結果（実行した場合）
