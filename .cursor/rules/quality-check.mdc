---
description: 品質確認（lint/format/type）の規約
alwaysApply: false
---
# 品質確認（quality-check）の規約

本ルールは `/quality-check` 実行時に適用される「規約（ポリシー）」である。  
手順（どのコマンドをどう叩くか）は `@.cursor/commands/quality-check.md` を参照する。

## 基本原則

**警告・エラーは必ず根本原因から解消する。回避策で“黙らせない”。**

## 禁止事項（回避策）

以下は原則禁止（正当な理由がある場合のみ、理由を明記して例外化）:

- `# type: ignore` による型エラーの握りつぶし
- `# noqa` によるlint無効化（正当な理由がある場合を除く）
- `cast(Any, ...)` 等の「Anyへ逃がす」型隠蔽
- 過度に広い型（`Any`, `object`）での型エラー回避

## 正しい修正アプローチ

- 適切な型アノテーションの追加
- 型ガード（`isinstance`, `assert`）で型を絞り込む
- `cast()` は具体型への変換のみに限定（例: `cast(str, ...)`, `cast(dict[str, Any], ...)`）
- 型スタブ不足は `types-*` パッケージ等で補う（可能なら）

## チェック対象（最低でもこれは必ず実行）

1. Ruff lint の **エラーと警告**
2. Ruff format の **差分**
3. mypy の **エラーと警告**
4. 不適切な `Any` の導入（新規追加・拡散）
5. セキュリティ観点の明確な問題（認証/認可、入力検証、データ保持）

## 例外（意図的なlint）について

意図的にlint規約に反する場合は、必ず **理由をdocstringまたはコメント**で明示する。

例（E402）:

```python
# E402: Intentionally import after pytestmark for test configuration
pytestmark = pytest.mark.unit
from src.module import Something
```

## 完了条件（Definition of Done）

- `ruff check` が **エラー・警告ゼロ**
- `ruff format --check` が **差分ゼロ**
- `mypy` が **Success: no issues found**
- 例外（意図的なlint）には **理由が明記**されている
- 新規に `# type: ignore` / 不当な `# noqa` を追加していない
- `Any` で問題を隠していない