---
description: モジュール間の連動を設計・検証するルール
alwaysApply: false
---
# モジュール間連動設計ルール

## 目的

バイブコーディングで生じる「モジュール間の連動ができておらず、全体として機能するプロダクトになっていない」問題を解決する。

## 実装前の必須確認事項

### 0.1. 仕様書の確認

1. **docs/requirements.mdの該当セクションを確認**
   - 実装対象機能に関連するセクションを特定
   - 仕様の要件を正確に理解する

2. **準拠性チェック**
   - 実装案が仕様書の要件を満たしているか確認
   - 仕様書に明記されていない動作を追加しない

### 0.2. コードベースの理解

1. **関連モジュールの調査** - 既存コードを調査し、パターンを確認
2. **依存関係の確認** - 循環依存がないか確認
3. **一貫性の確認** - 命名規則、エラーハンドリング、ログ出力形式

### 0.3. コーディング規約の確認

- **コメントは英語で統一**（docstringも英語）
- **実装計画書の章番号を含めない**
- **docstringはGoogleスタイル**

## 4ステップ設計プロセス

### ステップ1: シーケンス図の作成

- 対象モジュール間のシーケンス図を作成
- データ型を明示（Pydanticモデル推奨）
- 保存場所: `docs/sequences/`

### ステップ2: 型定義（Pydantic）

- モジュール間のデータ構造をPydanticモデルで定義
- `src/{module}/schemas.py` に配置

### ステップ3: デバッグ用スクリプトの作成

- `tests/scripts/debug_{feature}_flow.py` に配置
- 各ステップでデータの型・内容を検証

### ステップ4: シーケンス図の更新

- 修正後の正しいデータフローを記録

## チェックリスト

### 実装前
- [ ] 仕様書確認
- [ ] コードベース理解
- [ ] 依存関係確認
- [ ] コーディング規約確認

### 設計・実装
- [ ] シーケンス図作成
- [ ] Pydanticモデル定義
- [ ] デバッグスクリプト作成・実行
- [ ] 型チェック

### 実装後
- [ ] 仕様準拠性確認
- [ ] コメント言語確認
- [ ] 一貫性確認
- [ ] Lintエラー確認
