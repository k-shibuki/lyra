---
description: "Designing new features or verifying inter-module integration: sequence diagrams and data flow verification"
alwaysApply: false
---
# Inter-Module Integration Design Rules

## Positioning (Separation of Policy and Procedure)

- This file defines **policy**.
- Specific procedures (how to create deliverables, how to proceed) are documented in `@.cursor/commands/integration-design.md`.

## Purpose

Solve the problem of "modules not integrating properly, resulting in a product that doesn't function as a whole" that arises in vibe coding.

## Mandatory Pre-Implementation Checks

### 0.1. Specification Review

1. **Check relevant sections of docs/requirements.md**
   - Identify sections related to the feature being implemented
   - Accurately understand specification requirements

2. **Compliance Check**
   - Verify implementation proposal meets specification requirements
   - Don't add behavior not specified in the specification

### 0.2. Codebase Understanding

1. **Related Module Investigation** - Investigate existing code and confirm patterns
2. **Dependency Verification** - Verify no circular dependencies
3. **Consistency Verification** - Naming conventions, error handling, log output format

### 0.3. Coding Convention Check

- **Comments in English** (docstrings also in English)
- **Don't include implementation plan chapter numbers**
- **Docstrings in Google style**

## 4-Step Design Process

### Step 1: Create Sequence Diagram

- Create sequence diagram between target modules
- Explicitly specify data types (Pydantic models recommended)
- Save location: `docs/debug/`

### Step 2: Type Definition (Pydantic)

- Define data structures between modules as Pydantic models
- Place in `src/{module}/schemas.py`

### Step 3: Create Debug Scripts

- Place in `tests/scripts/debug_{feature}_flow.py`
- Verify data type and content at each step
- **When adding new parameters/fields**: Verify at entry → each module boundary → exit that values are held/transformed as expected (and "taking effect" if necessary)
- Instrumentation conventions (log format, placement strategy) follow `@.cursor/rules/debug.mdc` Section 2

### Step 4: Update Sequence Diagram

- Record correct data flow after modifications

## Checklists

### Pre-Implementation
- [ ] Specification review
- [ ] Codebase understanding
- [ ] Dependency verification
- [ ] Coding convention check

### Design & Implementation
- [ ] Sequence diagram created
- [ ] Pydantic models defined
- [ ] **Propagation table for added parameters/fields** (where received, where passed, where effect occurs)
- [ ] Debug scripts created and executed
- [ ] Debug scripts verify **each boundary in propagation table** (place observation points that fail if not wired)
- [ ] Type check

### Post-Implementation
- [ ] Specification compliance verified
- [ ] Comment language verified
- [ ] Consistency verified
- [ ] Lint errors verified
