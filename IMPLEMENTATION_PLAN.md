# å®Ÿè£…è¨ˆç”»: Local Autonomous Deep Research Agent (Lancet)

## æ¦‚è¦

OSINTãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒªã‚µãƒ¼ãƒã‚’è‡ªå¾‹çš„ã«å®Ÿè¡Œã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€‚
**Podmanã‚³ãƒ³ãƒ†ãƒŠç’°å¢ƒ**ã§ç¨¼åƒã—ã€MCPã‚’é€šã˜ã¦Cursorã¨é€£æºã™ã‚‹ã€‚

---

## Phaseå„ªå…ˆåº¦

### MVPå¿…é ˆï¼ˆåˆæœŸãƒªãƒªãƒ¼ã‚¹ï¼‰
- Phase A-G: åŸºç›¤ã€œãƒ†ã‚¹ãƒˆåŸºç›¤ï¼ˆå®Œäº†æ¸ˆã¿ï¼‰
- Phase H: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å¤šæ§˜åŒ–ï¼ˆå®Œäº†æ¸ˆã¿ï¼‰
- Phase M: MCPãƒ„ãƒ¼ãƒ«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- Phase K.3: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆL1-L4, L7-L8ï¼‰
- Phase N: E2Eã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼ˆè«–æ–‡æŠ•ç¨¿å‘ã‘ï¼‰

### Phase 2
- Phase I: ä¿å®ˆæ€§æ”¹å–„ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ï¼‰
- Phase J: å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹çµ±åˆ
- Phase K.1-K.2: ãƒ¢ãƒ‡ãƒ«é¸æŠæœ€é©åŒ–ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå¤–éƒ¨åŒ–
- Phase L: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### å°†æ¥ã®æ‹¡å¼µ
- ã‚¯ã‚¨ãƒªA/Bãƒ†ã‚¹ãƒˆï¼ˆÂ§3.1.1ã‹ã‚‰å‰Šé™¤æ¸ˆã¿ï¼‰
- å¤‰æ›´æ¤œçŸ¥/å·®åˆ†ã‚¢ãƒ©ãƒ¼ãƒˆ
- IPv6/HTTP3ã®é«˜åº¦ãªå­¦ç¿’

---

## Phase A: åŸºç›¤æ§‹ç¯‰ âœ…

### A.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤ âœ…

| é …ç›® | æˆæœç‰© | ä»•æ§˜å‚ç…§ |
|------|--------|----------|
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€  | `src/`, `config/`, `tests/` ç­‰ | - |
| ä¾å­˜é–¢ä¿‚ | `requirements.txt`, `pyproject.toml`, Dockerfile | - |
| è¨­å®šç®¡ç† | `config/settings.yaml`, `config/engines.yaml`, `config/domains.yaml` | - |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | SQLiteã‚¹ã‚­ãƒ¼ãƒ (`src/storage/schema.sql`)ã€FTS5å…¨æ–‡æ¤œç´¢ | Â§5.1.2 |
| ãƒ­ã‚®ãƒ³ã‚° | æ§‹é€ åŒ–ãƒ­ã‚° (structlog)ã€å› æœãƒˆãƒ¬ãƒ¼ã‚¹ (cause_id) | Â§4.6 |

### A.2 MCPã‚µãƒ¼ãƒãƒ¼ âœ…

> **æ³¨æ„**: Phase Mã§ãƒ„ãƒ¼ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’**29å€‹â†’11å€‹**ã«ç°¡ç´ åŒ–äºˆå®šã€‚ä»¥ä¸‹ã¯ç¾è¡Œå®Ÿè£…ã€‚

**ç¾è¡Œãƒ„ãƒ¼ãƒ«ï¼ˆ29å€‹ã€Phase Mã§ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°äºˆå®šï¼‰**:

| ã‚«ãƒ†ã‚´ãƒª | ãƒ„ãƒ¼ãƒ« | Phase Må¾Œ |
|---------|--------|-----------|
| ä½ãƒ¬ãƒ™ãƒ«ï¼ˆ6ï¼‰ | `search_serp`, `fetch_url`, `extract_content`, `rank_candidates`, `llm_extract`, `nli_judge` | å†…éƒ¨åŒ– |
| èªè¨¼ï¼ˆ5ï¼‰ | `notify_user`, `get_pending_authentications`, `start_authentication_session`, `complete_authentication`, `skip_authentication` | çµ±åˆâ†’`get_auth_queue`/`resolve_auth` |
| ã‚¿ã‚¹ã‚¯ï¼ˆ2ï¼‰ | `create_task`, `get_task_status` | â†’ `create_task`/`get_status` |
| ãƒ¬ãƒãƒ¼ãƒˆï¼ˆ2ï¼‰ | `get_report_materials`, `get_evidence_graph` | çµ±åˆâ†’`get_materials` |
| æ¢ç´¢ï¼ˆ5ï¼‰ | `get_research_context`, `execute_subquery`, `get_exploration_status`, `execute_refutation`, `finalize_exploration` | çµ±åˆ/å»ƒæ­¢â†’`search`/`get_status`/`stop_task` |
| æ ¡æ­£ï¼ˆ6ï¼‰ | `save_calibration_evaluation`, `get_calibration_evaluations`, `get_reliability_diagram_data`, `add_calibration_sample`, `get_calibration_stats`, `rollback_calibration` | çµ±åˆâ†’`calibrate`/`calibrate_rollback` |
| åˆ†æï¼ˆ2ï¼‰ | `decompose_question`, `compress_with_chain_of_density` | å»ƒæ­¢ï¼ˆCursor AIãŒæ‹…å½“ï¼‰ |
| ãã®ä»–ï¼ˆ1ï¼‰ | `schedule_job` | å†…éƒ¨åŒ– |

**æ–°MCPãƒ„ãƒ¼ãƒ«ï¼ˆ11ãƒ„ãƒ¼ãƒ«ã€Phase Må®Œäº†å¾Œï¼‰**:
- `create_task`, `get_status`: ã‚¿ã‚¹ã‚¯ç®¡ç†
- `search`, `stop_task`: èª¿æŸ»å®Ÿè¡Œ
- `get_materials`: æˆæœç‰©
- `calibrate`, `calibrate_rollback`: æ ¡æ­£ï¼ˆæ—¥å¸¸æ“ä½œ5 action + ç ´å£Šçš„æ“ä½œã‚’åˆ†é›¢ï¼‰
- `get_auth_queue`, `resolve_auth`: èªè¨¼ã‚­ãƒ¥ãƒ¼ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€æ‹¬æ“ä½œå¯¾å¿œï¼‰
- `notify_user`, `wait_for_user`: é€šçŸ¥

### A.3 æ¤œç´¢æ©Ÿèƒ½ âœ…

**å½“åˆè¨­è¨ˆï¼ˆSearXNGçµŒç”±ï¼‰â†’ å»ƒæ­¢**: è©³ç´°ã¯ã€ŒPhase C.1 æ¤œç´¢çµŒè·¯ã®å†è¨­è¨ˆã€å‚ç…§

**ç¾åœ¨ã®å®Ÿè£…ï¼ˆBrowserSearchProviderï¼‰**:
- Playwright CDPæ¥ç¶šã«ã‚ˆã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ç›´æ¥æ¤œç´¢
- å¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³: DuckDuckGo, Mojeek, Qwant, Brave, Google, Ecosia, Startpage
- CAPTCHAæ¤œçŸ¥â†’èªè¨¼ã‚­ãƒ¥ãƒ¼é€£æº

### A.4 ã‚¯ãƒ­ãƒ¼ãƒªãƒ³ã‚°/å–å¾— âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | curl_cffi (impersonate=chrome) | Â§4.3 |
| ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ– | Playwright CDPæ¥ç¶š | Â§3.2 |
| ãƒ˜ãƒƒãƒ‰ãƒ•ãƒ«åˆ‡æ›¿ | è‡ªå‹•ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | Â§4.3 |
| Torãƒ—ãƒ­ã‚­ã‚· | Stemé€£æºã€Circuitæ›´æ–° | Â§4.3 |
| ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ä¿å­˜ | WARC (warcio)ã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ | Â§4.3.2 |

### A.5 ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æŠ½å‡º âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| HTMLæŠ½å‡º | trafilatura | Â§5.1 |
| PDFæŠ½å‡º | PyMuPDF | Â§5.1.1 |
| OCR | PaddleOCR + Tesseract | Â§5.1.1 |
| é‡è¤‡æ¤œå‡º | MinHash + SimHash | Â§3.3.1 |

### A.6 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°/è©•ä¾¡ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| BM25ãƒ©ãƒ³ã‚­ãƒ³ã‚° | rank-bm25 | Â§3.3 |
| åŸ‹ã‚è¾¼ã¿ | bge-m3 (ONNX/FP16) | Â§5.1 |
| ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚° | bge-reranker-v2-m3 | Â§5.1 |
| LLMæŠ½å‡º | Ollama (Qwen2.5-3B/7B) | Â§5.1 |
| NLIåˆ¤å®š | tiny-DeBERTa | Â§3.3.1 |
| ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ• | NetworkX + SQLite | Â§3.3.1 |

### A.7 ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ© âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼ | å„ªå…ˆåº¦ç®¡ç†ã€ã‚¹ãƒ­ãƒƒãƒˆåˆ¶å¾¡ | Â§3.2.2 |
| æ’ä»–åˆ¶å¾¡ | gpu/browser_headfulæ’ä»– | Â§3.2.2 |
| äºˆç®—åˆ¶å¾¡ | ãƒšãƒ¼ã‚¸æ•°/æ™‚é–“ä¸Šé™ | Â§3.1 |

**æ—¢å®šå€¤ï¼ˆÂ§3.2.2ï¼‰**:
- `network_client`: åŒæ™‚å®Ÿè¡Œ=4ã€ãƒ‰ãƒ¡ã‚¤ãƒ³åŒæ™‚å®Ÿè¡Œ=1
- å„ªå…ˆåº¦: serp(100) > prefetch(90) > extract(80) > embed(70) > rerank(60) > llm_fast(50) > llm_slow(40)
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: æ¤œç´¢30ç§’ã€å–å¾—60ç§’ã€LLMæŠ½å‡º120ç§’

### A.8 é€šçŸ¥/æ‰‹å‹•ä»‹å…¥ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| é€šçŸ¥ | Windows Toast / Linux notify-send | Â§3.6 |
| èªè¨¼å¾…ã¡ã‚­ãƒ¥ãƒ¼ | InterventionQueue | Â§3.6.1 |
| ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å‰é¢åŒ– | OS API (SetForegroundWindow) | Â§3.6.1 |
| ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼ | åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€æ‹¬è§£æ±º | Â§3.6.1 |

**Â§3.6.1å®‰å…¨é‹ç”¨æ–¹é‡**:
- CDPè¨±å¯: `Page.navigate`, `Page.bringToFront`
- CDPç¦æ­¢: `Runtime.evaluate`, `DOM.*`, `Input.*`, `Emulation.*`
- å®Œäº†æ¤œçŸ¥: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ˜ç¤ºå ±å‘Šã®ã¿ï¼ˆDOMç›£è¦–ç¦æ­¢ï¼‰

**Â§2.1.5åˆ¤æ–­å§”è­²ã®ä¾‹å¤–**:
- Cursor AIç„¡å¿œç­”æ™‚ï¼ˆ300ç§’æ—¢å®šï¼‰: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®‰å…¨åœæ­¢ã€çŠ¶æ…‹ä¿å­˜ã€å¾©å¸°å¾…æ©Ÿ

### A.9 ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | Markdown / JSON | Â§3.4 |
| å¼•ç”¨ç®¡ç† | æ·±ã„ãƒªãƒ³ã‚¯ç”Ÿæˆã€ä¸€æ¬¡/äºŒæ¬¡åˆ†é¡ | Â§3.4 |

---

## Phase B: å“è³ªå¼·åŒ– âœ…

### B.1 ãƒ¡ãƒˆãƒªã‚¯ã‚¹/è‡ªå‹•é©å¿œ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† | MetricsCollector, TaskMetrics | Â§4.6 |
| ãƒãƒªã‚·ãƒ¼è‡ªå‹•æ›´æ–° | PolicyEngine (EMAã€ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹) | Â§4.6 |
| ãƒªãƒ—ãƒ¬ã‚¤ãƒ¢ãƒ¼ãƒ‰ | DecisionLogger, ReplayEngine | Â§4.6 |

**ãƒãƒªã‚·ãƒ¼è‡ªå‹•æ›´æ–°ã®æ—¢å®šå€¤ï¼ˆÂ§4.6ï¼‰**:
- å‘¨æœŸè£œå®Œ: 60ç§’
- EMAä¿‚æ•°: çŸ­æœŸÎ±=0.3ã€é•·æœŸÎ±=0.1
- Toråˆ©ç”¨ä¸Šé™: 20%
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åè»¢é˜²æ­¢: 5åˆ†æœªæº€ã¯åè»¢ã•ã›ãªã„

### B.2 æ¢ç´¢åˆ¶å¾¡ âœ…

**Â§2.1è²¬ä»»åˆ†ç•Œ**: ã‚¯ã‚¨ãƒªè¨­è¨ˆã¯Cursor AIã€Lancetã¯å®Ÿè¡Œã®ã¿

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| è¨­è¨ˆæ”¯æ´æƒ…å ± | ResearchContext | Â§2.1.2 |
| ã‚µãƒ–ã‚¯ã‚¨ãƒªå®Ÿè¡Œ | SubqueryExecutor | Â§2.1.2 |
| å……è¶³åº¦åˆ¤å®š | ExplorationState | Â§3.1.7.3 |
| åè¨¼æ¢ç´¢ | RefutationExecutor (æ©Ÿæ¢°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿) | Â§3.1.7.5 |

### B.3 ã‚¯ãƒ­ãƒ¼ãƒªãƒ³ã‚°æ‹¡å¼µ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| robots.txt/sitemap | RobotsChecker, SitemapParser | Â§3.1.2 |
| ãƒ‰ãƒ¡ã‚¤ãƒ³å†…BFS | DomainBFSCrawler | Â§3.1.2 |
| ã‚µã‚¤ãƒˆå†…æ¤œç´¢ | SiteSearchManager | Â§3.1.5 |
| Waybackå·®åˆ† | WaybackExplorer | Â§3.1.6 |

### B.4 ä¿¡é ¼åº¦ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ç¢ºç‡æ ¡æ­£ | Platt/æ¸©åº¦ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° | Â§3.3.4 |
| ãƒ‡ã‚°ãƒ¬æ¤œçŸ¥ | Brierã‚¹ã‚³ã‚¢ç›£è¦– | Â§4.6.1 |
| ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | CalibrationHistory | Â§4.6.1 |

---

## Phase C: æ¤œç´¢çµŒè·¯å†è¨­è¨ˆ âœ…

### C.1 SearXNGå»ƒæ­¢ã®èƒŒæ™¯

**å•é¡Œ**: SearXNGã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§å‹•ä½œã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®æŠ€è¡“çš„æ¬ é™¥ãŒã‚ã£ãŸï¼š

1. **Cookie/æŒ‡ç´‹ä½¿ç”¨ä¸å¯**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã§ããªã„
2. **botæ¤œçŸ¥ã•ã‚Œã‚„ã™ã„**: Cookie/æŒ‡ç´‹ãªã—ã®ç´ ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
3. **CAPTCHAè§£æ±ºä¸å¯**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒCAPTCHAè§£æ±ºã—ã¦ã‚‚ã€SearXNGã«Cookieã¯æ¸¡ã‚‰ãªã„
4. **Â§3.6.1ã¨ã®çŸ›ç›¾**: èªè¨¼å¾…ã¡ã‚­ãƒ¥ãƒ¼ã®è¨­è¨ˆæ„å›³ãŒæˆç«‹ã—ãªã„

**æ ¹æœ¬åŸå› **: SearXNGã¯ã€Œä¾¿åˆ©ã€ã ã£ãŸãŒã€æŠ—å …æ€§ï¼ˆÂ§4.3ï¼‰ã‚’çŠ ç‰²ã«ã™ã‚‹è¨­è¨ˆã ã£ãŸã€‚

### C.2 æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆBrowserSearchProviderï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lancet       â”‚ â†’  â”‚ Playwright   â”‚ â†’ DuckDuckGoç­‰
â”‚ (ç›´æ¥æ¤œç´¢)   â”‚    â”‚ (ãƒ–ãƒ©ã‚¦ã‚¶)   â”‚
â”‚              â”‚    â”‚ Cookie: ã‚ã‚Š â”‚
â”‚              â”‚    â”‚ æŒ‡ç´‹: ã‚ã‚Š   â”‚    â†’ äººé–“ã‚‰ã—ã„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚
        â–¼                  â–¼
   æ¤œç´¢çµæœãƒ‘ãƒ¼ã‚µãƒ¼   ã‚»ãƒƒã‚·ãƒ§ãƒ³è»¢é€ï¼ˆÂ§3.1.2ï¼‰
   (BeautifulSoup)    ãŒæ¤œç´¢ã«ã‚‚é©ç”¨å¯èƒ½
```

**å®Ÿè£…å®Œäº†é …ç›®**:
- `BrowserSearchProvider`: Playwright CDPæ¥ç¶šã€ã‚¨ãƒ³ã‚¸ãƒ³åˆ¥URLæ§‹ç¯‰ã€CAPTCHAæ¤œçŸ¥â†’èªè¨¼ã‚­ãƒ¥ãƒ¼é€£æº
- `BaseSearchParser` + ã‚¨ãƒ³ã‚¸ãƒ³åˆ¥ãƒ‘ãƒ¼ã‚µãƒ¼: DuckDuckGo, Mojeek, Google, Brave, Qwant, Ecosia, Startpage
- `config/search_parsers.yaml`: ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å¤–éƒ¨åŒ–ã€AIä¿®æ­£ç”¨è¨ºæ–­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### C.3 requirements.mdä¿®æ­£å†…å®¹

**Â§3.2 ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œæ©Ÿèƒ½**:
```
ã€æ—§ã€‘æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆ: ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¨¼åƒã™ã‚‹SearXNGï¼ˆãƒ¡ã‚¿æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰ã«å¯¾ã—ã‚¯ã‚¨ãƒªã‚’é€ä¿¡

ã€æ–°ã€‘æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆ: PlaywrightçµŒç”±ã§æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ç›´æ¥æ¤œç´¢ã™ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCookie/æŒ‡ç´‹ï¼‰ã‚’ä½¿ç”¨
- å¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³: DuckDuckGo, Google, Mojeek, Qwant, Brave
- CAPTCHAç™ºç”Ÿæ™‚ã¯æ‰‹å‹•ä»‹å…¥ãƒ•ãƒ­ãƒ¼ï¼ˆÂ§3.6.1ï¼‰ã«ç§»è¡Œ
- ã‚»ãƒƒã‚·ãƒ§ãƒ³è»¢é€ï¼ˆÂ§3.1.2ï¼‰ãŒæ¤œç´¢ã«ã‚‚é©ç”¨
```

**Â§4.3.3 ã‚¹ãƒ†ãƒ«ã‚¹è¨­è¨ˆæ–¹é‡** ã«è¿½è¨˜:
```
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ç¦æ­¢:
  - SearXNG/å…¬é–‹SearXã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç­‰ã¯ä½¿ç”¨ã—ãªã„
  - ç†ç”±: Cookie/æŒ‡ç´‹ä½¿ç”¨ä¸å¯ã€CAPTCHAè§£æ±ºä¸å¯ã€IPæ±šæŸ“ãƒªã‚¹ã‚¯
  - ã™ã¹ã¦ã®æ¤œç´¢ãƒ»å–å¾—ã¯ãƒ–ãƒ©ã‚¦ã‚¶çµŒç”±ã§å®Ÿè¡Œ
```

**Â§5.1 ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
```
ã€æ—§ã€‘Search Engine: SearXNG (Podmanã‚³ãƒ³ãƒ†ãƒŠ)

ã€æ–°ã€‘Search Engine: PlaywrightçµŒç”±ã®ç›´æ¥ãƒ–ãƒ©ã‚¦ã‚¶æ¤œç´¢ï¼ˆBrowserSearchProviderï¼‰
- å¯¾å¿œã‚¨ãƒ³ã‚¸ãƒ³: DuckDuckGo, Mojeek, Qwant, Brave, Google
- ã‚¨ãƒ³ã‚¸ãƒ³allowlistï¼ˆæ—¢å®šï¼‰: DuckDuckGo, Mojeek, Qwantã€‚Googleã¯ä½é‡ã¿
```

---

## Phase D: æŠ—å …æ€§ãƒ»ã‚¹ãƒ†ãƒ«ã‚¹æ€§å¼·åŒ– âœ…

### D.1 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/IPå±¤ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| IPv6é‹ç”¨ | IPv6ConnectionManager | Â§4.3 |
| DNSæ–¹é‡ | DNSPolicyManager (socks5h://ã§ãƒªãƒ¼ã‚¯é˜²æ­¢) | Â§4.3 |
| HTTP/3æ–¹é‡ | HTTP3PolicyManager | Â§4.3 |

### D.2 ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆ/TLSå±¤ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| sec-fetch-*ãƒ˜ãƒƒãƒ€ãƒ¼ | SecFetchHeaders | Â§4.3 |
| sec-ch-ua*ãƒ˜ãƒƒãƒ€ãƒ¼ | SecCHUAHeaders | Â§4.3 |

### D.3 ãƒ–ãƒ©ã‚¦ã‚¶/JSå±¤ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| webdriverã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ | stealth.py (STEALTH_JS) | Â§4.3 |
| undetected-chromedriverãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ | UndetectedChromeFetcher | Â§4.3 |
| viewportã‚¸ãƒƒã‚¿ãƒ¼ | ViewportJitter | Â§4.3 |

### D.4 ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¥å…¨æ€§ç›£æŸ» âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| å·®åˆ†æ¤œçŸ¥ | ProfileAuditor (UA/ãƒ•ã‚©ãƒ³ãƒˆ/è¨€èª/æŒ‡ç´‹) | Â§4.3.1 |
| è‡ªå‹•ä¿®å¾© | attempt_repair (Chromeå†èµ·å‹•ç­‰) | Â§4.3.1 |
| ç›£æŸ»ãƒ­ã‚° | JSONLå½¢å¼ | Â§4.3.1 |

### D.5 ã‚»ãƒƒã‚·ãƒ§ãƒ³ç§»é€ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| Cookie/ETagç§»é€ | SessionTransferManager | Â§3.1.2 |
| åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶ç´„ | capture_from_browser | Â§3.1.2 |

### D.6 ãƒ–ãƒ©ã‚¦ã‚¶çµŒè·¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| CDXJé¢¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ | CDXJGenerator | Â§4.3.2 |
| ç°¡æ˜“HARç”Ÿæˆ | HARGenerator | Â§4.3.2 |

### D.7 ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ãƒ©ã‚¤ã‚¯æ“ä½œ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒã‚¦ã‚¹è»Œè·¡ | MouseTrajectory (Bezieræ›²ç·š) | Â§4.3.4 |
| ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒªã‚ºãƒ  | HumanTyping (ã‚¬ã‚¦ã‚¹åˆ†å¸ƒ) | Â§4.3.4 |
| ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ…£æ€§ | InertialScroll (easing) | Â§4.3.4 |
| è¨­å®šå¤–éƒ¨åŒ– | config/human_behavior.yaml | Â§4.3.4 |

---

## Phase E: OSINTå“è³ªå¼·åŒ– âœ…

### E.1 æ¤œç´¢æˆ¦ç•¥ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| UCB1é¢¨äºˆç®—å†é…åˆ† | UCBAllocator | Â§3.1.1 |
| ãƒ”ãƒœãƒƒãƒˆæ¢ç´¢ | PivotExpander | Â§3.1.1 |

> **æ³¨æ„**: ã‚¯ã‚¨ãƒªA/Bãƒ†ã‚¹ãƒˆï¼ˆABTestExecutorï¼‰ã¯Â§3.1.1ã‹ã‚‰å‰Šé™¤ã•ã‚Œã€ã€Œå°†æ¥ã®æ‹¡å¼µã€ã«ç§»å‹•ã—ãŸã€‚

### E.2 ã‚¤ãƒ³ãƒ•ãƒ©/ãƒ¬ã‚¸ã‚¹ãƒˆãƒªé€£æº âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| RDAP/WHOIS | RDAPClient, WHOISParser | Â§3.1.2 |
| è¨¼æ˜æ›¸é€æ˜æ€§ | CertTransparencyClient (crt.sh) | Â§3.1.2 |
| ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£KB | EntityKB, NameNormalizer | Â§3.1.2 |

### E.3 ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å“è³ª âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—åˆ¤å®š | PageClassifier | Â§3.1.2 |
| ä½å“è³ªæ¤œå‡º | ContentQualityAnalyzer | Â§3.3.3 |
| AIç”Ÿæˆæ¤œå‡º | 23ãƒ‘ã‚¿ãƒ¼ãƒ³ + æ–‡é•·å‡ä¸€æ€§ | Â§3.3.3 |
| æ™‚ç³»åˆ—æ•´åˆ | TemporalConsistencyChecker | Â§3.3.3 |

### E.4 ä¸»å¼µåˆ†æ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| å•ã„â†’ä¸»å¼µåˆ†è§£ | ClaimDecomposer | Â§3.3.1 |
| Chain-of-Densityåœ§ç¸® | ChainOfDensityCompressor | Â§3.3.1 |

---

## Phase F: è¿½åŠ æ©Ÿèƒ½ âœ…

### F.1 æ ¡æ­£ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒ‡ã‚°ãƒ¬æ¤œçŸ¥ | CalibrationHistory.check_degradation() | Â§4.6.1 |
| ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | Calibrator.rollback() | Â§4.6.1 |
| è©•ä¾¡æ°¸ç¶šåŒ– | calibration_evaluations ãƒ†ãƒ¼ãƒ–ãƒ« | Â§4.6.1 |

### F.2 ãƒ—ãƒ­ã‚»ã‚¹ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ãƒ–ãƒ©ã‚¦ã‚¶ç ´æ£„ | ProcessLifecycleManager | Â§4.2 |
| LLMè§£æ”¾ | OllamaClient.unload_model() | Â§4.2 |

### F.3 åŠè‡ªå‹•é‹ç”¨UX âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| èªè¨¼å¾…ã¡æƒ…å ±çµ±åˆ | get_exploration_status ã« authentication_queue è¿½åŠ  | Â§3.6.1 |
| é–¾å€¤ã‚¢ãƒ©ãƒ¼ãƒˆ | warningsé…åˆ—ã¸ã®è¿½åŠ  (â‰¥3ä»¶ã§è­¦å‘Š) | Â§3.6.1 |

### F.4 ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| ä¸»å¼µã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ | ClaimTimeline, TimelineEvent | Â§3.4 |
| Waybacké€£æº | integrate_wayback_result() | Â§3.1.6 |
| ã‚«ãƒãƒ¬ãƒƒã‚¸ç®—å‡º | get_timeline_coverage() | Â§7 |

### F.5 Waybackãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ…

| æ©Ÿèƒ½ | å®Ÿè£… | ä»•æ§˜å‚ç…§ |
|------|------|----------|
| è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ | fetcher.pyçµ±åˆ (403/CAPTCHAæ™‚) | Â§3.1.6 |
| å·®åˆ†æ¤œå‡º | ArchiveDiffResult | Â§3.1.6 |
| é®®åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ | apply_freshness_penalty() | Â§3.1.6 |

---

## Phase G: ãƒ†ã‚¹ãƒˆåŸºç›¤ âœ…

### G.1 ãƒ†ã‚¹ãƒˆåˆ†é¡

| åˆ†é¡ | ãƒãƒ¼ã‚«ãƒ¼ | å¤–éƒ¨ä¾å­˜ | å®Ÿè¡Œç’°å¢ƒ |
|------|----------|----------|----------|
| unit | `@pytest.mark.unit` | ãªã— | ã©ã“ã§ã‚‚ |
| integration | `@pytest.mark.integration` | ãƒ¢ãƒƒã‚¯ | ã©ã“ã§ã‚‚ |
| e2e | `@pytest.mark.e2e` | å®Ÿã‚µãƒ¼ãƒ“ã‚¹ | ä½ãƒªã‚¹ã‚¯IPé™å®š |

**è¿½åŠ ãƒãƒ¼ã‚«ãƒ¼**:
- `@external`: å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨ï¼ˆMojeek, Qwantç­‰ï¼‰
- `@rate_limited`: ãƒ¬ãƒ¼ãƒˆåˆ¶é™å³ã—ã„ï¼ˆDuckDuckGo, Googleç­‰ï¼‰
- `@manual`: äººæ‰‹ä»‹å…¥å¿…é ˆï¼ˆCAPTCHAè§£æ±ºç­‰ï¼‰

### G.2 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆ + çµ±åˆï¼ˆCIãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
./scripts/test.sh run tests/

# E2Eã®ã¿
pytest -m e2e

# å…¨ãƒ†ã‚¹ãƒˆ
pytest -m ""
```

**ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆæ•°**: 2394ä»¶ï¼ˆå…¨ãƒ‘ã‚¹ï¼‰

### G.3 E2Eã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆtests/scripts/ï¼‰

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | æ¤œè¨¼å†…å®¹ | ä»•æ§˜ | çŠ¶æ…‹ |
|-----------|----------|------|:----:|
| `verify_duckduckgo_search.py` | DuckDuckGoæ¤œç´¢ã€ãƒ‘ãƒ¼ã‚µãƒ¼ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ | Â§3.2 | âœ… 5/5 |
| `verify_ecosia_search.py` | Ecosiaæ¤œç´¢ï¼ˆBingå†è²©ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_startpage_search.py` | Startpageæ¤œç´¢ï¼ˆGoogleå†è²©ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_mojeek_search.py` | Mojeekæ¤œç´¢ï¼ˆç‹¬ç«‹ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_qwant_search.py` | Qwantæ¤œç´¢ï¼ˆEUç³»ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_brave_search.py` | Braveæ¤œç´¢ï¼ˆç‹¬è‡ªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_google_search.py` | Googleæ¤œç´¢ï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_bing_search.py` | Bingæ¤œç´¢ï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰ | Â§3.2 | âœ… 4/4 |
| `verify_captcha_flow.py` | CAPTCHAâ†’é€šçŸ¥â†’æ‰‹å‹•è§£æ±ºâ†’ç¶™ç¶š | Â§3.6.1 | âœ… |
| `verify_session_transfer.py` | ãƒ–ãƒ©ã‚¦ã‚¶â†’HTTPé–“ã‚»ãƒƒã‚·ãƒ§ãƒ³ç§»é€ | Â§3.1.2 | âœ… |
| `verify_search_then_fetch.py` | æ¤œç´¢â†’å–å¾—ã®ä¸€è²«æ€§ | Â§3.2 | âœ… |
| `verify_network_resilience.py` | IPv6ã€DNSãƒªãƒ¼ã‚¯ã€304æ´»ç”¨ | Â§7 | âœ… |
| `verify_profile_health.py` | ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¥å…¨æ€§ã€è‡ªå‹•ä¿®å¾© | Â§7 | âœ… |

---

## Phase H: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å¤šæ§˜åŒ– âœ…

### H.1 å®Ÿè£…çŠ¶æ³ãƒãƒˆãƒªã‚¯ã‚¹

| ã‚¨ãƒ³ã‚¸ãƒ³ | ä»•æ§˜æ›¸Â§3.2 | engines.yaml | ãƒ‘ãƒ¼ã‚µãƒ¼ | E2Eã‚¹ã‚¯ãƒªãƒ—ãƒˆ | E2Eæ¤œè¨¼ | çŠ¶æ…‹ |
|----------|:----------:|:------------:|:--------:|:-------------:|:-------:|------|
| DuckDuckGo | âœ… | âœ… | âœ… | âœ… | âœ… 5/5 | **å®Œäº†** |
| Mojeek | âœ… | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Google | âœ… | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Brave | âœ… | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Ecosia | - | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Startpage | - | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |
| Bing | - | âœ… | âœ… | âœ… | âœ… 4/4 | **å®Œäº†** |

### H.2 E2Eæ¤œè¨¼ã§åˆ¤æ˜ã—ãŸçŸ¥è¦‹

#### H.2.1 MetaGerå‰Šé™¤

**å•é¡Œ**: ãƒ­ã‚°ã‚¤ãƒ³ã‚²ãƒ¼ãƒˆãŒå­˜åœ¨ã—ã€å…¨ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒå¤±æ•—
**ç—‡çŠ¶**: æ¤œç´¢çµæœãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚èªè¨¼ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
**æ±ºå®š**: ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‚‰å®Œå…¨å‰Šé™¤ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã‚²ãƒ¼ãƒˆã¯CAPTCHAã¨ç•°ãªã‚Šå›é¿å›°é›£ï¼‰

**å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«**:
- `config/engines.yaml`: metagerã‚»ã‚¯ã‚·ãƒ§ãƒ³
- `config/search_parsers.yaml`: metagerã‚»ã‚¯ã‚·ãƒ§ãƒ³
- `src/search/search_parsers.py`: MetaGerParserã‚¯ãƒ©ã‚¹
- `src/search/parser_config.py`: metagerãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- `tests/test_search_parsers.py`: MetaGeré–¢é€£ãƒ†ã‚¹ãƒˆ
- `tests/fixtures/search_html/metager_results.html`
- `tests/scripts/verify_metager_search.py`

#### H.2.2 ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ä¿å®ˆã®æ•™è¨“

**å•é¡Œ**: Ecosia/Startpageã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒå®Ÿéš›ã®HTMLã¨ä¸ä¸€è‡´
**åŸå› **: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã¯HTMLã‚’äºˆå‘Šãªãå¤‰æ›´ã™ã‚‹
**å¯¾ç­–**:
1. E2Eå¤±æ•—æ™‚ã«`debug/search_html/`ã¸HTMLè‡ªå‹•ä¿å­˜
2. `config/search_parsers.yaml`ã§ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å¤–éƒ¨åŒ–
3. æ§‹é€ åŒ–ãƒ­ã‚°ã§å¤±æ•—ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼åã‚’æ˜ç¤º

**Ecosiaä¿®æ­£å¾Œã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼**:
```yaml
results_container: ".mainline__result-wrapper"
title: "a[data-test-id='result-link'], .result-title__heading"
url: "a[data-test-id='result-link']"
snippet: ".result__description"
```

**Startpageä¿®æ­£å¾Œã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼**:
```yaml
results_container: ".result"
title: ".wgl-title, .result-title"
url: "a.result-title, a.result-link"
snippet: ".description"
```

#### H.2.3 E2Eæ¤œè¨¼ã§åˆ¤æ˜ã—ãŸè¿½åŠ å•é¡Œ

**Qwantåœ°åŸŸåˆ¶é™**:
- ç—‡çŠ¶: ã€ŒUnfortunately we are not yet available in your countryã€
- åŸå› : Qwantã¯æ—¥æœ¬ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã—ã¦ã„ã‚‹
- å¯¾å¿œ: engines.yamlã‹ã‚‰Qwantã‚’å‰Šé™¤ï¼ˆåœ°åŸŸåˆ¶é™ã¯CAPTCHAã¨ç•°ãªã‚Šå›é¿å›°é›£ï¼‰

**Braveã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: âœ… ä¿®æ­£æ¸ˆã¿
- ç—‡çŠ¶: `networkidle`å¾…æ©Ÿã§10ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- åŸå› : Braveã¯JSã§å¸¸æ™‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹
- å¯¾å¿œ: `networkidle`ã‚’5ç§’tryå¾Œã€`asyncio.sleep(2)`ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

**BrowserSearchProvider CDPãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å•é¡Œ**: âœ… ä¿®æ­£æ¸ˆã¿
- ç—‡çŠ¶: ChromeãŒèµ·å‹•ã—ã¦ã„ãªã„æ™‚ã«ã€ŒCAPTCHA detectedã€ã¨å ±å‘Šã•ã‚Œã¦ã„ãŸ
- æ ¹æœ¬åŸå› : CDPæ¥ç¶šå¤±æ•—æ™‚ã«ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç”Ÿï¼ˆä»•æ§˜é•åï¼‰
- ä¿®æ­£å†…å®¹:
  1. ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‰Šé™¤ï¼ˆÂ§4.3.3ã€Œå®Ÿãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è²«æ€§ã€ã«æº–æ‹ ï¼‰
  2. CDPæ¥ç¶šå¤±æ•—æ™‚ã¯æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™
  3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«`./scripts/chrome.sh start`ã®æ¡ˆå†…ã‚’å«ã‚ã‚‹
  4. `SearchResponse.connection_mode`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆè¨ºæ–­ç”¨ï¼‰
- å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«:
  - `src/search/provider.py`: `SearchResponse`ã«`connection_mode`è¿½åŠ 
  - `src/search/browser_search_provider.py`: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‰Šé™¤ã€`CDPConnectionError`è¿½åŠ 
  - `tests/test_browser_search_provider.py`: CDPæ¥ç¶šãƒ†ã‚¹ãƒˆè¿½åŠ 

**Brave CAPTCHAèª¤æ¤œå‡ºå•é¡Œ**: âœ… ä¿®æ­£æ¸ˆã¿
- ç—‡çŠ¶: æ­£å¸¸ãªæ¤œç´¢çµæœãƒšãƒ¼ã‚¸ã§ã€ŒCAPTCHA detectedã€ã¨èª¤å ±å‘Š
- æ ¹æœ¬åŸå› : `captcha_patterns`ã®`"captcha"`ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒJSå¤‰æ•°åï¼ˆ`captchacookiename`ç­‰ï¼‰ã«ãƒãƒƒãƒ
- ä¿®æ­£å†…å®¹: `config/search_parsers.yaml`ã®Braveç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚ˆã‚Šå…·ä½“çš„ã«å¤‰æ›´
  - `"captcha"` â†’ `"please complete the captcha"`, `"verify you are human"`

**Bing URLãƒ‡ã‚³ãƒ¼ãƒ‰å•é¡Œ**: âœ… ä¿®æ­£æ¸ˆã¿
- ç—‡çŠ¶: Bingæ¤œç´¢çµæœãŒ0ä»¶ã¨ã—ã¦è¿”ã•ã‚Œã‚‹
- æ ¹æœ¬åŸå› : Bingã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLï¼ˆ`u=a1aHR0cHM6...`ï¼‰ãŒbase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ãŒã€ãƒ‡ã‚³ãƒ¼ãƒ‰å‡¦ç†ãŒæ¬ è½
- ä¿®æ­£å†…å®¹: `src/search/search_parsers.py`ã®`_clean_bing_url`ã«base64ãƒ‡ã‚³ãƒ¼ãƒ‰è¿½åŠ 

#### H.2.4 E2Eã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å…±é€šä¿®æ­£

**å•é¡Œ1**: `SearchResponse`ã«`captcha_detected`å±æ€§ãŒãªã„
**ä¿®æ­£**: `result.error`æ–‡å­—åˆ—ã‹ã‚‰"CAPTCHA detected"ã‚’æ¤œç´¢ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’è¿½åŠ 
```python
def _is_captcha_detected(result: SearchResponse) -> tuple[bool, Optional[str]]:
    if result.error and "CAPTCHA detected" in result.error:
        match = re.search(r"CAPTCHA detected: (\w+)", result.error)
        captcha_type = match.group(1) if match else "unknown"
        return True, captcha_type
    return False, None
```

**å•é¡Œ2**: `FetchPolicy`ã‚¯ãƒ©ã‚¹ãŒå­˜åœ¨ã—ãªã„
**ä¿®æ­£**: `BrowserFetcher.fetch(headful=False)`ã«ç›´æ¥å¤‰æ›´

**å•é¡Œ3**: `FetchResult.content`å±æ€§ãŒãªã„
**ä¿®æ­£**: `result.html_path or result.content_hash`ã§åˆ¤å®š

### H.3 æ®‹ä½œæ¥­

#### å„ªå…ˆåº¦é«˜ï¼ˆä»•æ§˜æ›¸Â§3.2æº–æ‹ ï¼‰
- [x] **Bingãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…** âœ…
  - `config/search_parsers.yaml`ã«bingå®šç¾©è¿½åŠ 
  - `src/search/search_parsers.py`ã«BingParserè¿½åŠ 
  - `src/search/parser_config.py`ã«bingãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
  - `tests/test_search_parsers.py`ã«Bingãƒ†ã‚¹ãƒˆè¿½åŠ 

#### å„ªå…ˆåº¦ä¸­ï¼ˆE2Eã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šï¼‰
- [x] `verify_mojeek_search.py`ä½œæˆ âœ…
- [x] ~~`verify_qwant_search.py`ä½œæˆ~~ â†’ Qwantå‰Šé™¤ï¼ˆåœ°åŸŸåˆ¶é™ï¼‰
- [x] `verify_brave_search.py`ä½œæˆ âœ…

#### å„ªå…ˆåº¦ä½ï¼ˆé«˜ãƒªã‚¹ã‚¯ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰
- [x] `verify_google_search.py`ä½œæˆ âœ…ï¼ˆCAPTCHAé«˜é »åº¦ï¼‰
- [x] `verify_bing_search.py`ä½œæˆ âœ…

#### æŠ€è¡“çš„èª²é¡Œ
- [x] **CDPãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å•é¡Œã®ä¿®æ­£** âœ…
  - ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‰Šé™¤ï¼ˆä»•æ§˜Â§4.3.3æº–æ‹ ï¼‰
  - CDPæ¥ç¶šå¤±æ•—æ™‚ã¯æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ + `chrome.sh`æ¡ˆå†…
  - `SearchResponse.connection_mode`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 

#### ç¢ºèªäº‹é …
- [x] **MCPã‚µãƒ¼ãƒçµŒç”±ã§ã®å‹•ä½œç¢ºèª** âœ…
  - `tests/scripts/verify_mcp_tools.py`ä½œæˆï¼ˆMCPãƒ„ãƒ¼ãƒ«ãƒãƒ³ãƒ‰ãƒ©æ¤œè¨¼ï¼‰
  - `search_serp`ãƒ„ãƒ¼ãƒ«çµŒç”±ã§ã®æ¤œç´¢ãŒæ­£å¸¸å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - ãƒã‚°ä¿®æ­£: `search_parsers._classify_source`ãŒæ–‡å­—åˆ—ã‚’è¿”ã—ã¦ã„ãŸå•é¡Œã‚’ä¿®æ­£ï¼ˆSourceTag Enumã«å¤‰æ›ï¼‰

---

## Phase I: ä¿å®ˆæ€§æ”¹å–„ ğŸ”„

### I.1 ãƒ—ãƒ­ãƒã‚¤ãƒ€æŠ½è±¡åŒ– âœ…

| ãƒ—ãƒ­ãƒã‚¤ãƒ€ | å®Ÿè£… | çŠ¶æ…‹ |
|-----------|------|:----:|
| SearchProvider | BrowserSearchProvider | âœ… |
| LLMProvider | OllamaProvider | âœ… |
| BrowserProvider | PlaywrightProvider, UndetectedChromeProvider | âœ… |
| NotificationProvider | LinuxNotifyProvider, WindowsToastProvider, WSLBridgeProvider | âœ… |

### I.2 è¨­å®šãƒ»ãƒãƒªã‚·ãƒ¼ã®å¤–éƒ¨åŒ– âœ…

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ | DomainPolicyManager + config/domains.yaml | âœ… |
| æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³è¨­å®š | SearchEngineConfigManager + config/engines.yaml | âœ… |
| ã‚¹ãƒ†ãƒ«ã‚¹è¨­å®š | - | æœªå®Ÿè£… |

### I.3 æ±ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| é …ç›® | çŠ¶æ…‹ |
|------|:----:|
| æ±ç”¨ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚« | âœ… |
| æ±ç”¨ãƒªãƒˆãƒ©ã‚¤/ãƒãƒƒã‚¯ã‚ªãƒ• | âœ… |
| æ±ç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¤ãƒ¤ | æœªå®Ÿè£… |

#### I.3.1 æ±ç”¨ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚« âœ…

**å®Ÿè£…å†…å®¹**:
- `src/utils/circuit_breaker.py`: ä¾å­˜ã‚¼ãƒ­ã®è»½é‡ã‚³ã‚¢
  - `CircuitBreaker`: åŒæœŸç‰ˆã€ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ï¼ˆthreading.Lockï¼‰
  - `CircuitState`: å…±æœ‰enumï¼ˆCLOSED/OPEN/HALF_OPENï¼‰
  - `AsyncCircuitBreaker`: éåŒæœŸãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£å¯¾å¿œï¼‰
  - `CircuitBreakerError`: ä¾‹å¤–ã‚¯ãƒ©ã‚¹
- `src/search/circuit_breaker.py`: å…±æœ‰enumã‚’ä½¿ç”¨ã€æ¤œç´¢å›ºæœ‰æ©Ÿèƒ½ã¯ç¶­æŒ
  - EMAãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆsuccess_rate_1h, latency_ema, captcha_rateï¼‰
  - DBæ°¸ç¶šåŒ–ï¼ˆdatetimeåŸºæº–cooldownï¼‰
  - æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆfailure historyãƒ™ãƒ¼ã‚¹ï¼‰

**ãƒ†ã‚¹ãƒˆ**: `tests/test_utils_circuit_breaker.py`ï¼ˆ32ä»¶ï¼‰

#### I.3.2 æ±ç”¨ãƒªãƒˆãƒ©ã‚¤/ãƒãƒƒã‚¯ã‚ªãƒ• âœ…

**å®Ÿè£…å†…å®¹**:
- `src/utils/backoff.py`: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•è¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  - `BackoffConfig`: è¨­å®šï¼ˆbase_delay, max_delay, exponential_base, jitter_factorï¼‰
  - `calculate_backoff()`: ãƒªãƒˆãƒ©ã‚¤é…å»¶è¨ˆç®—ï¼ˆÂ§4.3.5æº–æ‹ ï¼‰
  - `calculate_cooldown_minutes()`: ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³è¨ˆç®—ï¼ˆÂ§4.3, Â§3.1.4æº–æ‹ ï¼‰
  - `calculate_total_delay()`: ç·é…å»¶æ™‚é–“è¨ˆç®—ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¦‹ç©ã‚‚ã‚Šç”¨ï¼‰
- `src/utils/api_retry.py`: å…¬å¼APIå°‚ç”¨ãƒªãƒˆãƒ©ã‚¤ï¼ˆÂ§3.1.3, Â§4.3.5æº–æ‹ ï¼‰
  - `APIRetryPolicy`: ãƒãƒªã‚·ãƒ¼è¨­å®šï¼ˆretryable_exceptions, retryable_status_codesï¼‰
  - `retry_api_call()`: éåŒæœŸãƒªãƒˆãƒ©ã‚¤é–¢æ•°
  - `@with_api_retry`: ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿
  - äº‹å‰è¨­å®šãƒãƒªã‚·ãƒ¼: `JAPAN_GOV_API_POLICY`, `ACADEMIC_API_POLICY`, `ENTITY_API_POLICY`
- `src/search/circuit_breaker.py`: å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†æ›´æ–°
  - `_calculate_cooldown()` â†’ `calculate_cooldown_minutes()` ã‚’ä½¿ç”¨

**ä»•æ§˜æ›¸æ›´æ–°**: `requirements.md` Â§4.3.5ã€Œãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥ã®åˆ†é¡ã€ã‚’è¿½åŠ 
- ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ï¼ˆæ¤œç´¢/å–å¾—å‘ã‘ï¼‰: åŒä¸€çµŒè·¯ã§ã®å˜ç´”ãƒªãƒˆãƒ©ã‚¤ç¦æ­¢
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/APIãƒªãƒˆãƒ©ã‚¤ï¼ˆãƒˆãƒ©ãƒ³ã‚¸ã‚§ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼å‘ã‘ï¼‰: å…¬å¼APIã®ã¿é©ç”¨å¯

**ãƒ†ã‚¹ãƒˆ**: `tests/test_utils_backoff.py`ï¼ˆ26ä»¶ï¼‰ã€`tests/test_utils_api_retry.py`ï¼ˆ28ä»¶ï¼‰

### I.4 ãƒ‘ãƒ¼ã‚µãƒ¼è‡ªå·±ä¿®å¾©ï¼ˆAIé§†å‹•ï¼‰

**ç›®çš„**: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã®HTMLå¤‰æ›´ã«å¯¾ã—ã¦AIãŒè‡ªå‹•ä¿®å¾©

**æ—¢å­˜åŸºç›¤**:
- `debug/search_html/`: å¤±æ•—æ™‚ã®HTMLè‡ªå‹•ä¿å­˜
- `config/search_parsers.yaml`: ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å¤–éƒ¨åŒ–
- æ§‹é€ åŒ–ãƒ­ã‚°: å¤±æ•—ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼åã‚’æ˜ç¤º

**ã‚¿ã‚¹ã‚¯**:
- [x] å¤±æ•—æ™‚ãƒ­ã‚° + HTMLä¿å­˜ï¼ˆæ—¢å­˜ï¼‰
- [ ] AIãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªå¤±æ•—ãƒ­ã‚°å¼·åŒ–
- [ ] ä¿®æ­£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­è¨ˆï¼ˆCursorã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ or ä¼šè©±ãƒ™ãƒ¼ã‚¹ï¼‰

---

## Phase J: å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹çµ±åˆ â³

### J.0 APIä»•æ§˜èª¿æŸ»ï¼ˆå„ªå…ˆï¼‰

| API | èª¿æŸ»é …ç›® | çŠ¶æ…‹ |
|-----|----------|:----:|
| e-Stat | èªè¨¼ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | æœªç€æ‰‹ |
| æ³•ä»¤APIï¼ˆe-Govï¼‰ | åŒä¸Š | æœªç€æ‰‹ |
| å›½ä¼šä¼šè­°éŒ²API | åŒä¸Š | æœªç€æ‰‹ |
| gBizINFO | åŒä¸Š | æœªç€æ‰‹ |
| EDINET | åŒä¸Š | æœªç€æ‰‹ |
| OpenAlex | åŒä¸Š | æœªç€æ‰‹ |
| Semantic Scholar | åŒä¸Š | æœªç€æ‰‹ |
| Crossref | åŒä¸Š | æœªç€æ‰‹ |
| Unpaywall | åŒä¸Š | æœªç€æ‰‹ |
| Wikidata | åŒä¸Š | æœªç€æ‰‹ |

### J.1 æ—¥æœ¬æ”¿åºœAPIçµ±åˆ

**å¯¾è±¡ï¼ˆÂ§3.1.3ï¼‰**:
- e-Stat API: çµ±è¨ˆãƒ‡ãƒ¼ã‚¿
- æ³•ä»¤APIï¼ˆe-Govï¼‰: æ³•ä»¤å…¨æ–‡æ¤œç´¢
- å›½ä¼šä¼šè­°éŒ²API: å›½ä¼šè­°äº‹éŒ²
- gBizINFO API: æ³•äººåŸºæœ¬æƒ…å ±
- EDINET API: æœ‰ä¾¡è¨¼åˆ¸å ±å‘Šæ›¸

### J.2 å­¦è¡“APIçµ±åˆ

**å¯¾è±¡ï¼ˆÂ§3.1.3ã€Â§5.1.1ï¼‰**:
- OpenAlex API: è«–æ–‡ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿/å¼•ç”¨ã‚°ãƒ©ãƒ•
- Semantic Scholar API: è«–æ–‡/å¼•ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
- Crossref API: DOI/å¼•ç”¨æƒ…å ±
- Unpaywall API: OAç‰ˆè«–æ–‡ãƒªãƒ³ã‚¯

### J.3 ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£è§£æ±ºå¼·åŒ–

**å¯¾è±¡ï¼ˆÂ§3.1.3ï¼‰**:
- Wikidata API
- DBpedia SPARQL

### J.4 ç‰¹è¨±APIçµ±åˆ

**å¯¾è±¡ï¼ˆÂ§3.1.3æ‹¡å……ï¼‰**:
- USPTO PAIR API: ç±³å›½ç‰¹è¨±å‡ºé¡˜çŠ¶æ³
- USPTO PTAB API: å¯©åˆ¤éƒ¨æ±ºå®š
- EPO OPS API: æ¬§å·ç‰¹è¨±ãƒ‡ãƒ¼ã‚¿
- J-PlatPat: HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆAPIéå…¬é–‹ï¼‰
- CNIPA: HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆä¸­å›½ç‰¹è¨±ï¼‰

| API | èª¿æŸ»é …ç›® | çŠ¶æ…‹ |
|-----|----------|:----:|
| USPTO PAIR | èªè¨¼ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | æœªç€æ‰‹ |
| USPTO PTAB | åŒä¸Š | æœªç€æ‰‹ |
| EPO OPS | OAuth2èªè¨¼ | æœªç€æ‰‹ |
| J-PlatPat | ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­è¨ˆ | æœªç€æ‰‹ |
| CNIPA | è¨€èªå¯¾å¿œã€ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ | æœªç€æ‰‹ |

### J.5 é˜²è¡›ãƒ»èª¿é”æƒ…å ±é€£æº

**å¯¾è±¡ï¼ˆÂ§3.1.3æ‹¡å……ï¼‰**:
- é˜²è¡›çœè£…å‚™åº: èª¿é”å…¬å‘Šï¼ˆHTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼‰
- ç±³DoDå¥‘ç´„: SAM.govï¼ˆæ”¿åºœèª¿é”DBï¼‰
- DTIC: Defense Technical Information Center

| ã‚½ãƒ¼ã‚¹ | æ–¹å¼ | çŠ¶æ…‹ |
|--------|------|:----:|
| é˜²è¡›çœè£…å‚™åº | HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚° | æœªç€æ‰‹ |
| SAM.gov | APIï¼ˆç„¡æ–™ï¼‰ | æœªç€æ‰‹ |
| DTIC | HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚° | æœªç€æ‰‹ |

---

## Phase K: ãƒ­ãƒ¼ã‚«ãƒ«LLMå¼·åŒ– ğŸ”„

### K.3 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆÂ§4.4.1ï¼‰ğŸ”´å„ªå…ˆ

åé›†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å«ã¾ã‚Œã‚‹æ‚ªæ„ã‚ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«LLMã‚’é˜²å¾¡ã™ã‚‹å¤šå±¤é˜²å¾¡ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**é˜²å¾¡å±¤ã‚µãƒãƒª**:

| å±¤ | ç›®çš„ | çŠ¶æ…‹ |
|----|------|:----:|
| L1: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢ | LLMã‹ã‚‰å¤–éƒ¨ã¸ã®ç›´æ¥é€ä¿¡ã‚’é®æ–­ | âœ… |
| L2: å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚º | å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³ã®é™¤å» | âœ… |
| L3: ã‚¿ã‚°åˆ†é›¢ | ã‚·ã‚¹ãƒ†ãƒ /ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®åˆ†é›¢ | âœ… |
| L4: å‡ºåŠ›æ¤œè¨¼ | URL/IP/ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–­ç‰‡ã®æ¤œå‡º | ğŸ”„ |
| L5: MCPå¿œç­”ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ | ä¿¡é ¼åº¦æƒ…å ±ã®ä»˜ä¸ | â³ |
| L6: ã‚½ãƒ¼ã‚¹æ¤œè¨¼ãƒ•ãƒ­ãƒ¼ | è‡ªå‹•æ˜‡æ ¼/é™æ ¼ | â³ |
| **L7: MCPå¿œç­”ã‚µãƒ‹ã‚¿ã‚¤ã‚º** | Cursor AIçµŒç”±æµå‡ºé˜²æ­¢ | â³ |
| **L8: ãƒ­ã‚°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | ãƒ­ã‚°/DB/ã‚¨ãƒ©ãƒ¼ã‹ã‚‰ã®æ¼æ´©é˜²æ­¢ | â³ |

#### K.3-1 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢ï¼ˆL1ï¼‰âœ…

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| Ollamaå†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å°‚ç”¨åŒ– | `podman-compose.yml`ä¿®æ­£ | âœ… |
| å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹é®æ–­ | `internal: true` è¨­å®š | âœ… |
| ãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒˆå…¬é–‹ç¦æ­¢ | `ports`ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤ | âœ… |

#### K.3-2 ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ï¼ˆL3ï¼‰âœ…

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ãƒ©ãƒ³ãƒ€ãƒ ã‚¿ã‚°ç”Ÿæˆ | `src/filter/llm_security.py` | âœ… |
| ã‚¿ã‚°ã®ãƒ­ã‚°éå‡ºåŠ› | ãƒãƒƒã‚·ãƒ¥å…ˆé ­8æ–‡å­—ã®ã¿DEBUGå‡ºåŠ› | âœ… |
| ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ”¹ä¿® | `src/filter/llm.py` | âœ… |

#### K.3-3 å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆL2ï¼‰âœ…

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| Unicode NFKCæ­£è¦åŒ– | `sanitize_llm_input()` | âœ… |
| HTMLã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ‡ã‚³ãƒ¼ãƒ‰ | åŒä¸Š | âœ… |
| ã‚¼ãƒ­å¹…æ–‡å­—é™¤å» | åŒä¸Š | âœ… |
| åˆ¶å¾¡æ–‡å­—é™¤å» | åŒä¸Š | âœ… |
| ã‚¿ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³é™¤å» | `LANCET-`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ | âœ… |
| å±é™ºå˜èªæ¤œå‡ºãƒ»è­¦å‘Š | ãƒ­ã‚°å‡ºåŠ› | âœ… |
| å…¥åŠ›é•·åˆ¶é™ | 4000æ–‡å­— | âœ… |

#### K.3-4 å‡ºåŠ›æ¤œè¨¼ï¼ˆL4ï¼‰ğŸ”„

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| å¤–éƒ¨URLãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º | `validate_llm_output()` | âœ… |
| IPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º | åŒä¸Š | âœ… |
| ç•°å¸¸é•·å‡ºåŠ›åˆ‡ã‚Šæ¨ã¦ | æœŸå¾…é•·ã®10å€è¶… | âœ… |
| **ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–­ç‰‡æ¤œå‡º** | `detect_prompt_leakage()` | â³ |
| **æ–­ç‰‡ãƒã‚¹ã‚¯å‡¦ç†** | `mask_prompt_fragments()` | â³ |

**è¿½åŠ å®Ÿè£…ï¼ˆÂ§4.4.1 L4å¼·åŒ–ï¼‰**:
- n-gramä¸€è‡´æ¤œå‡ºï¼ˆé€£ç¶š20æ–‡å­—ä»¥ä¸Šï¼‰
- ã‚¿ã‚°åãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºï¼ˆ`LANCET-`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰
- æ¤œå‡ºæ™‚ã®ãƒã‚¹ã‚¯å‡¦ç†ï¼ˆ`[REDACTED]`ç½®æ›ï¼‰
- æ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆã®ç›£æŸ»ãƒ­ã‚°å‡ºåŠ›

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/filter/llm_security.py`: `detect_prompt_leakage()`, `mask_prompt_fragments()` è¿½åŠ 
- `src/filter/llm.py`: å‡ºåŠ›å‡¦ç†ã«æ–­ç‰‡æ¤œå‡ºã‚’çµ„ã¿è¾¼ã¿

#### K.3-5 MCPå¿œç­”ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆL5ï¼‰â³

å…¨MCPå¿œç­”ã«æ¤œè¨¼çŠ¶æ…‹ã‚’ä»˜ä¸ã—ã€Cursor AIãŒä¿¡é ¼åº¦ã‚’åˆ¤æ–­å¯èƒ½ã«ã™ã‚‹ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| `_lancet_meta` ä»˜ä¸ | `src/mcp/response_meta.py` (æ–°è¦) | â³ |
| claimæ¤œè¨¼çŠ¶æ…‹ä»˜ä¸ | `source_trust_level`, `verification_status` | â³ |
| `search` å¿œç­”æ‹¡å¼µ | `src/mcp/server.py` | â³ |
| `get_status` å¿œç­”æ‹¡å¼µ | `src/mcp/server.py` | â³ |

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/mcp/server.py`: å¿œç­”ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®æˆ»ã‚Šå€¤ã« `_lancet_meta` ã‚’è¿½åŠ 
- æ–°è¦ `src/mcp/response_meta.py`: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼

> **æ³¨æ„**: Phase Mã§MCPãƒ„ãƒ¼ãƒ«åãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã‚ã€`execute_subquery`â†’`search`, `get_exploration_status`â†’`get_status`ã¨ã—ã¦å®Ÿè£…

#### K.3-6 ã‚½ãƒ¼ã‚¹æ¤œè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆL6ï¼‰â³

EvidenceGraphé€£æºã«ã‚ˆã‚‹è‡ªå‹•æ¤œè¨¼ã¨æ˜‡æ ¼/é™æ ¼ãƒ­ã‚¸ãƒƒã‚¯ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ | `src/filter/source_verification.py` (æ–°è¦) | â³ |
| EvidenceGraphé€£æº | `calculate_claim_confidence`, `find_contradictions` åˆ©ç”¨ | â³ |
| è‡ªå‹•æ˜‡æ ¼ï¼ˆâ†’LOWï¼‰ | ç‹¬ç«‹ã‚½ãƒ¼ã‚¹â‰¥2, çŸ›ç›¾ãªã— | â³ |
| è‡ªå‹•é™æ ¼ï¼ˆâ†’BLOCKEDï¼‰ | çŸ›ç›¾æ¤œå‡º/å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³ | â³ |
| æ¤œè¨¼çŠ¶æ…‹æ°¸ç¶šåŒ– | `src/research/state.py` æ‹¡å¼µ | â³ |

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- æ–°è¦ `src/filter/source_verification.py`: æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
- `src/filter/evidence_graph.py`: æ—¢å­˜ã® `calculate_claim_confidence`, `find_contradictions` ã‚’åˆ©ç”¨
- `src/mcp/server.py`: `_handle_search`, `_handle_get_status` æ‹¡å¼µï¼ˆPhase Må¾Œã®æ–°ãƒ„ãƒ¼ãƒ«åï¼‰
- `src/research/state.py`: æ¤œè¨¼çŠ¶æ…‹ã®ä¿æŒ

#### K.3-7 TrustLevelå¤‰æ›´ â³

`UNKNOWN` / `SUSPICIOUS` ã‚’å»ƒæ­¢ã—ã€æ¤œè¨¼çŠ¶æ…‹ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| TrustLevel enumå†å®šç¾© | `src/utils/domain_policy.py` | â³ |
| ä¿¡é ¼åº¦ã‚¦ã‚§ã‚¤ãƒˆæ›´æ–° | `DEFAULT_TRUST_WEIGHTS` | â³ |
| domains.yamlæ›´æ–° | `config/domains.yaml` | â³ |

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ11ä»¶ï¼‰:**

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |
|---------|---------|
| `src/utils/domain_policy.py` | TrustLevel enumå†å®šç¾©, DEFAULT_TRUST_WEIGHTSæ›´æ–° |
| `config/domains.yaml` | default trust_level ã‚’ `"unverified"` ã«å¤‰æ›´ |
| `src/search/search_parsers.py` | UNKNOWNå‚ç…§ â†’ UNVERIFIED |
| `src/search/provider.py` | UNKNOWNå‚ç…§ â†’ UNVERIFIED |
| `src/search/browser_search_provider.py` | UNKNOWNå‚ç…§ â†’ UNVERIFIED |
| `src/filter/provider.py` | UNKNOWN/SUSPICIOUSå‚ç…§ â†’ UNVERIFIED/BLOCKED |
| `src/crawler/browser_provider.py` | UNKNOWNå‚ç…§ â†’ UNVERIFIED |
| `src/crawler/sec_fetch.py` | UNKNOWNå‚ç…§ â†’ UNVERIFIED |
| `src/crawler/fetcher.py` | UNKNOWNå‚ç…§ â†’ UNVERIFIED |
| `src/crawler/bfs.py` | UNKNOWNå‚ç…§ â†’ UNVERIFIED |
| `src/crawler/http3_policy.py` | UNKNOWNå‚ç…§ â†’ UNVERIFIED |
| `src/utils/notification_provider.py` | UNKNOWN/SUSPICIOUSå‚ç…§ â†’ UNVERIFIED/BLOCKED |

#### K.3-8 BLOCKEDé€šçŸ¥ï¼ˆInterventionQueueé€£æºï¼‰â³

ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒBLOCKEDã«ãªã£ãŸéš›ã®é€šçŸ¥æ©Ÿèƒ½ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| `auth_type="domain_blocked"` è¿½åŠ  | `src/utils/notification.py` | â³ |
| BLOCKEDæ™‚ã®é€šçŸ¥å‘¼ã³å‡ºã— | `src/filter/source_verification.py` | â³ |
| Cursor AIã¸ã®å¿œç­” | `domain_blocked` æƒ…å ±ã‚’å«ã‚ã‚‹ | â³ |

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/utils/notification.py`: InterventionQueueæ‹¡å¼µï¼ˆæ–°auth_typeè¿½åŠ ï¼‰
- `src/filter/source_verification.py`: BLOCKEDæ™‚ã®é€šçŸ¥å‘¼ã³å‡ºã—

#### K.3-9 MCPå¿œç­”ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆL7ï¼‰â³ ğŸ”´å„ªå…ˆ

MCPå¿œç­”ãŒCursor AIã«æ¸¡ã‚‹å‰ã®æœ€çµ‚ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã€‚Cursor AIçµŒç”±ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæµå‡ºã‚’é˜²æ­¢ã™ã‚‹ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| å¿œç­”ã‚¹ã‚­ãƒ¼ãƒå®šç¾© | `src/mcp/schemas/` (JSONSchema) | â³ |
| ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ | `ResponseSanitizer.validate_schema()` | â³ |
| äºˆæœŸã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é™¤å» | `ResponseSanitizer.strip_unknown_fields()` | â³ |
| LLMãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®L4é€šéå¼·åˆ¶ | `ResponseSanitizer.sanitize_llm_fields()` | â³ |
| ã‚¨ãƒ©ãƒ¼å¿œç­”ã‚µãƒ‹ã‚¿ã‚¤ã‚º | `ResponseSanitizer.sanitize_error()` | â³ |
| MCPãƒãƒ³ãƒ‰ãƒ©ã¸ã®çµ±åˆ | `src/mcp/server.py` å„ãƒãƒ³ãƒ‰ãƒ©ã®å‡ºå£ | â³ |

**è¨­è¨ˆæ–¹é‡**:
- allowlistæ–¹å¼: å®šç¾©æ¸ˆã¿ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿é€šéã€æœªå®šç¾©ã¯é™¤å»
- LLMç”Ÿæˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ`extracted_facts`, `claims`, `summary`ç­‰ï¼‰ã¯å¿…ãš`validate_llm_output()`ã‚’é€šé
- ã‚¨ãƒ©ãƒ¼å¿œç­”ã¯æ±ç”¨åŒ–ã—ã€è©³ç´°ã¯`error_id`ã§ãƒ­ã‚°å‚ç…§

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- æ–°è¦ `src/mcp/response_sanitizer.py`: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒ­ã‚¸ãƒƒã‚¯
- æ–°è¦ `src/mcp/schemas/`: å„MCPãƒ„ãƒ¼ãƒ«ã®å¿œç­”ã‚¹ã‚­ãƒ¼ãƒï¼ˆJSONSchemaï¼‰
- `src/mcp/server.py`: å…¨ãƒãƒ³ãƒ‰ãƒ©ã®å‡ºå£ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒ¬ã‚¤ãƒ¤è¿½åŠ 

**ã‚¹ã‚­ãƒ¼ãƒä¾‹ï¼ˆsearchï¼‰**:
```json
{
  "type": "object",
  "properties": {
    "ok": {"type": "boolean"},
    "search_id": {"type": "string"},
    "query": {"type": "string"},
    "status": {"enum": ["satisfied", "partial", "exhausted"]},
    "pages_fetched": {"type": "integer"},
    "useful_fragments": {"type": "integer"},
    "harvest_rate": {"type": "number"},
    "claims_found": {"type": "array"},
    "satisfaction_score": {"type": "number"},
    "novelty_score": {"type": "number"},
    "budget_remaining": {"type": "object"},
    "_lancet_meta": {"type": "object"}
  },
  "additionalProperties": false
}
```

#### K.3-10 ãƒ­ã‚°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ï¼ˆL8ï¼‰â³ ğŸ”´å„ªå…ˆ

ãƒ­ã‚°ãƒ»DBãƒ»ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã®æƒ…å ±æ¼æ´©é˜²æ­¢ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| LLMå…¥å‡ºåŠ›ãƒ­ã‚°ã®ã‚µãƒãƒªåŒ– | `SecureLogger.log_llm_io()` | â³ |
| ä¾‹å¤–ã‚µãƒ‹ã‚¿ã‚¤ã‚º | `SecureLogger.sanitize_exception()` | â³ |
| DBã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆéä¿å­˜ | `src/storage/` å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª | â³ |
| ç›£æŸ»ãƒ­ã‚°ï¼ˆæ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆï¼‰ | `AuditLogger.log_security_event()` | â³ |
| structlogçµ±åˆ | ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ã‚»ãƒƒã‚µ | â³ |

**ãƒ­ã‚°å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
```python
# Before (ç¦æ­¢)
logger.debug("LLM input", prompt=full_prompt_text)

# After (è¨±å¯)
logger.debug("LLM input", 
    prompt_hash="abc123...",
    prompt_length=1500,
    prompt_preview="..."  # å…ˆé ­100æ–‡å­—ã®ã¿
)
```

**ä¾‹å¤–ã‚µãƒ‹ã‚¿ã‚¤ã‚ºä¾‹**:
```python
try:
    result = llm.extract(prompt)
except Exception as e:
    # å†…éƒ¨ãƒ­ã‚°ï¼ˆè©³ç´°ã‚ã‚Šï¼‰
    internal_logger.error("LLM extraction failed", 
        error_id="err_abc123",
        exception=str(e),
        traceback=traceback.format_exc()
    )
    # MCPå¿œç­”ï¼ˆè©³ç´°ãªã—ï¼‰
    return {"ok": False, "error": "Internal processing error", "error_id": "err_abc123"}
```

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- æ–°è¦ `src/utils/secure_logging.py`: `SecureLogger`, `AuditLogger`
- `src/filter/llm.py`: ãƒ­ã‚°å‡ºåŠ›ã‚’SecureLoggerçµŒç”±ã«å¤‰æ›´
- `src/mcp/server.py`: ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºé©ç”¨
- `src/storage/`: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿å­˜ç®‡æ‰€ã®ç¢ºèªãƒ»ä¿®æ­£

#### K.3 ãƒ†ã‚¹ãƒˆ

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL2/L3/L4åŸºæœ¬ï¼‰ | `tests/test_llm_security.py` | âœ… |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL4å¼·åŒ–: æ–­ç‰‡æ¤œå‡ºï¼‰ | `tests/test_llm_security.py` è¿½åŠ  | â³ |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL7: MCPå¿œç­”ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼‰ | `tests/test_response_sanitizer.py` | â³ |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆL8: ãƒ­ã‚°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰ | `tests/test_secure_logging.py` | â³ |
| E2E: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢æ¤œè¨¼ | Ollamaã‹ã‚‰å¤–éƒ¨é€šä¿¡ä¸å¯ã‚’ç¢ºèª | â³ |
| E2E: LLMå¿œç­”æ¤œè¨¼ | ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã®æ­£å¸¸å‹•ä½œ | â³ |
| E2E: ã‚¿ã‚°åˆ†é›¢åŠ¹æœæ¤œè¨¼ | ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã®å½±éŸ¿ç¢ºèª | â³ |
| E2E: MCPå¿œç­”æµå‡ºæ¤œè¨¼ | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–­ç‰‡ãŒMCPå¿œç­”ã«å«ã¾ã‚Œãªã„ã“ã¨ã‚’ç¢ºèª | â³ |

**L7ãƒ†ã‚¹ãƒˆè¦³ç‚¹**:
- ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼: ä¸æ­£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒé™¤å»ã•ã‚Œã‚‹ã“ã¨
- LLMãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–­ç‰‡ãŒæ¤œå‡ºãƒ»ãƒã‚¹ã‚¯ã•ã‚Œã‚‹ã“ã¨
- ã‚¨ãƒ©ãƒ¼å¿œç­”: ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ»å†…éƒ¨ãƒ‘ã‚¹ãŒå«ã¾ã‚Œãªã„ã“ã¨
- æ­£å¸¸å¿œç­”: å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ¬ è½ã—ãªã„ã“ã¨

**L8ãƒ†ã‚¹ãƒˆè¦³ç‚¹**:
- ãƒ­ã‚°å‡ºåŠ›: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ¬æ–‡ãŒè¨˜éŒ²ã•ã‚Œãªã„ã“ã¨
- ä¾‹å¤–å‡¦ç†: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå®‰å…¨ã§ã‚ã‚‹ã“ã¨
- ç›£æŸ»ãƒ­ã‚°: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆãŒè¨˜éŒ²ã•ã‚Œã‚‹ã“ã¨

**æ³¨**: E2Eãƒ†ã‚¹ãƒˆã¯GPUç’°å¢ƒã§å®Ÿè¡ŒãŒå¿…è¦ã€‚`tests/scripts/verify_llm_security.py`ã¨ã—ã¦å®Ÿè£…äºˆå®šã€‚

### K.1 ãƒ¢ãƒ‡ãƒ«é¸æŠæœ€é©åŒ– â³

- [ ] `config/llm_models.yaml`: ã‚¿ã‚¹ã‚¯åˆ¥ãƒ¢ãƒ‡ãƒ«è¨­å®š
- [ ] OllamaProvideræ‹¡å¼µ: `select_model(task)`

### K.2 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤–éƒ¨åŒ– â³

- [ ] `config/prompts/`: Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- [ ] PromptManagerå®Ÿè£…

---

## Phase L: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ â³

### L.1 æœªä½œæˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ ] README.mdï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ï¼‰
- [ ] æ‰‹å‹•ä»‹å…¥é‹ç”¨æ‰‹é †æ›¸ï¼ˆÂ§6æˆæœç‰©ï¼‰
- [ ] MCPãƒ„ãƒ¼ãƒ«ä»•æ§˜æ›¸ï¼ˆÂ§6æˆæœç‰©ï¼‰
- [ ] ã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ä»•æ§˜æ›¸ï¼ˆÂ§6æˆæœç‰©ï¼‰
- [ ] ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¥å…¨æ€§ç›£æŸ»é‹ç”¨æ‰‹é †

---

## Phase M: MCPãƒ„ãƒ¼ãƒ«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° ğŸ”„

requirements.md Â§3.2.1ã®æ”¹è¨‚ã«ä¼´ã„ã€MCPãƒ„ãƒ¼ãƒ«ã‚’**30å€‹ã‹ã‚‰11å€‹**ã«ç°¡ç´ åŒ–ã™ã‚‹ã€‚

**ç§»è¡Œæ–¹é‡**: å¾Œæ–¹äº’æ›æœŸé–“ã¯è¨­ã‘ãšã€å®Œå…¨ç§»è¡Œã¨ã™ã‚‹ã€‚

### M.1 è¨­è¨ˆæ–¹é‡

**ç›®çš„**:
- Cursor AIã®èªçŸ¥è² è·ä½æ¸›ï¼ˆãƒ„ãƒ¼ãƒ«é¸æŠã®å˜ç´”åŒ–ï¼‰
- ä½ãƒ¬ãƒ™ãƒ«æ“ä½œã®éš è”½ï¼ˆCursor AIã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®è©³ç´°ã‚’çŸ¥ã‚‹å¿…è¦ãŒãªã„ï¼‰
- è²¬ä»»åˆ†ç•Œã®æ˜ç¢ºåŒ–ï¼ˆCursor AI = æˆ¦ç•¥ã€Lancet = æˆ¦è¡“ï¼‰
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã®æ˜ç¢ºåŒ–ï¼ˆå…¬é–‹APIã‚’æœ€å°åŒ–ï¼‰

**ã€Œå†…éƒ¨åŒ–ã€ã®å®šç¾©**:
- å†…éƒ¨åŒ–ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ã¯MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‹ã‚‰ã¯å‘¼ã³å‡ºã›ãªã„
- ã“ã‚Œã‚‰ã¯`search`ç­‰ã®é«˜ãƒ¬ãƒ™ãƒ«ãƒ„ãƒ¼ãƒ«ã‹ã‚‰è‡ªå‹•çš„ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹
- ä»•æ§˜æ›¸ã«è©³ç´°ãªI/Oã‚¹ã‚­ãƒ¼ãƒã¯å®šç¾©ã—ãªã„ï¼ˆå®Ÿè£…è©³ç´°ã¨ã—ã¦æ‰±ã†ï¼‰

**çµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ–¹é‡**:

MCPãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼ã¨ã—ã€ãƒ­ã‚¸ãƒƒã‚¯ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®çµ±åˆAPIï¼ˆaction-basedï¼‰ã«é›†ç´„ã™ã‚‹ã€‚

```
MCPãƒãƒ³ãƒ‰ãƒ©ãƒ¼ (_handle_*)
    â†“ è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆå¼•æ•°å¤‰æ›ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ã¿ï¼‰
ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®çµ±åˆAPI (action-based)
    â†“
å†…éƒ¨ã‚¯ãƒ©ã‚¹ãƒ»é–¢æ•°
```

| æ–°MCPãƒ„ãƒ¼ãƒ« | çµ±åˆAPIã®é…ç½®å…ˆ |
|------------|----------------|
| `calibrate` | `src/utils/calibration.py` â†’ `calibrate_action()` |
| `calibrate_rollback` | åŒä¸Šï¼ˆç ´å£Šçš„æ“ä½œã®ãŸã‚åˆ†é›¢ï¼‰ |
| `search` | `src/research/pipeline.py` â†’ `search_action()` |
| `stop_task` | åŒä¸Š â†’ `stop_task_action()` |
| `get_status` | `src/research/state.py` â†’ `get_status_action()` |
| `get_materials` | `src/research/materials.py` â†’ `get_materials_action()` |
| `get_auth_queue` / `resolve_auth` | `src/utils/notification.py` â†’ `auth_queue_action()` |
| `notify_user` / `wait_for_user` | åŒä¸Š â†’ `notification_action()` |

**ç¾åœ¨ã®å®Ÿè£…ï¼ˆ30ãƒ„ãƒ¼ãƒ«ï¼‰**:
```
ä½ãƒ¬ãƒ™ãƒ«: search_serp, fetch_url, extract_content, rank_candidates, llm_extract, nli_judge (6)
èªè¨¼: notify_user, get_pending_authentications, start_authentication_session, complete_authentication, skip_authentication (5)
ã‚¿ã‚¹ã‚¯: create_task, get_task_status (2)
ãƒ¬ãƒãƒ¼ãƒˆ: get_report_materials, get_evidence_graph (2)
æ¢ç´¢: get_research_context, execute_subquery, get_exploration_status, execute_refutation, finalize_exploration (5)
æ ¡æ­£: save_calibration_evaluation, get_calibration_evaluations, get_reliability_diagram_data, add_calibration_sample, get_calibration_stats, rollback_calibration, calibrate_rollback (7)
åˆ†æ: decompose_question, compress_with_chain_of_density (2)
ãã®ä»–: schedule_job (1)
```

**å®Ÿè£…æ¸ˆã¿ã®æ–°ãƒ„ãƒ¼ãƒ«**:
- `calibrate_rollback` âœ…ï¼ˆ`_handle_calibrate_rollback`å®Ÿè£…æ¸ˆã¿ã€ãƒ†ã‚¹ãƒˆæ¸ˆã¿ï¼‰
- `src/mcp/errors.py` âœ…ï¼ˆã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³»å®Ÿè£…æ¸ˆã¿ï¼‰

**å¤‰æ›´æ¦‚è¦**:

| æ—§ãƒ„ãƒ¼ãƒ«ï¼ˆ30å€‹ï¼‰ | æ–°ãƒ„ãƒ¼ãƒ«ï¼ˆ11å€‹ï¼‰ | å¤‰æ›´å†…å®¹ | å®Ÿè£…çŠ¶æ…‹ |
|-----------------|-----------------|---------|:--------:|
| `get_task_status` + `get_exploration_status` | `get_status` | çµ±åˆ | â³ |
| `execute_subquery` + `execute_refutation` | `search` | çµ±åˆï¼ˆ`refute`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ | â³ |
| `finalize_exploration` | `stop_task` | åç§°å¤‰æ›´ãƒ»ç°¡ç´ åŒ– | â³ |
| `get_report_materials` + `get_evidence_graph` | `get_materials` | çµ±åˆ | â³ |
| æ ¡æ­£ç³»6ãƒ„ãƒ¼ãƒ« | `calibrate` | **çµ±åˆ**ï¼ˆ5 actionï¼‰ | âœ… |
| `rollback_calibration` | `calibrate_rollback` | åç§°å¤‰æ›´ãƒ»åˆ†é›¢ | âœ… |
| èªè¨¼ç³»4ãƒ„ãƒ¼ãƒ« | `get_auth_queue` + `resolve_auth` | **çµ±åˆ** | â³ |
| `notify_user` | `notify_user` | ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—å¤‰æ›´ | â³ |
| â€” | `wait_for_user` | **æ–°è¦è¿½åŠ ** | â³ |
| `get_research_context` | â€” | **å»ƒæ­¢** | â³ |
| `decompose_question` | â€” | **å»ƒæ­¢**ï¼ˆCursor AIæ‹…å½“ï¼‰ | â³ |
| `compress_with_chain_of_density` | â€” | **å»ƒæ­¢**ï¼ˆCursor AIæ‹…å½“ï¼‰ | â³ |
| `schedule_job` | â€” | **å†…éƒ¨åŒ–** | â³ |
| `start_authentication_session` | â€” | **å»ƒæ­¢**ï¼ˆÂ§3.6.1ï¼‰ | â³ |
| ä½ãƒ¬ãƒ™ãƒ«6ãƒ„ãƒ¼ãƒ« | â€” | **å†…éƒ¨åŒ–** | â³ |

### M.1.1 ç¾çŠ¶ã®ã‚®ãƒ£ãƒƒãƒ—åˆ†æ

**Â§3.2.1ä»•æ§˜ vs ç¾åœ¨ã®å®Ÿè£…**:

| æ–°ãƒ„ãƒ¼ãƒ« | ä»•æ§˜ | å®Ÿè£… | ã‚®ãƒ£ãƒƒãƒ— |
|---------|:----:|:----:|---------|
| `create_task` | âœ… | âœ… | ãªã—ï¼ˆå­˜ç¶šï¼‰ |
| `get_status` | âœ… | âœ… | ãªã—ï¼ˆçµ±åˆå®Œäº†ï¼‰ |
| `search` | âœ… | âŒ | æœªå®Ÿè£…ï¼ˆçµ±åˆå¿…è¦ï¼‰ |
| `stop_task` | âœ… | âŒ | æœªå®Ÿè£…ï¼ˆåç§°å¤‰æ›´ï¼‰ |
| `get_materials` | âœ… | âŒ | æœªå®Ÿè£…ï¼ˆçµ±åˆå¿…è¦ï¼‰ |
| `calibrate` | âœ… | âœ… | ãªã— |
| `calibrate_rollback` | âœ… | âœ… | ãªã— |
| `get_auth_queue` | âœ… | âŒ | æœªå®Ÿè£…ï¼ˆçµ±åˆå¿…è¦ï¼‰ |
| `resolve_auth` | âœ… | âŒ | æœªå®Ÿè£…ï¼ˆçµ±åˆå¿…è¦ï¼‰ |
| `notify_user` | âœ… | ğŸ”„ | ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—å¤‰æ›´å¿…è¦ |
| `wait_for_user` | âœ… | âŒ | æœªå®Ÿè£…ï¼ˆæ–°è¦ï¼‰ |

**å‰Šé™¤å¯¾è±¡ï¼ˆç¾å­˜ã™ã‚‹ãŒä»•æ§˜ã«ãªã„ãƒ„ãƒ¼ãƒ«ï¼‰**: 23å€‹

- ä½ãƒ¬ãƒ™ãƒ«: `search_serp`, `fetch_url`, `extract_content`, `rank_candidates`, `llm_extract`, `nli_judge`
- èªè¨¼æ—§: `get_pending_authentications`, `start_authentication_session`, `complete_authentication`, `skip_authentication`
- ã‚¿ã‚¹ã‚¯æ—§: `get_task_status`
- ãƒ¬ãƒãƒ¼ãƒˆæ—§: `get_report_materials`, `get_evidence_graph`
- æ¢ç´¢æ—§: `get_research_context`, `execute_subquery`, `get_exploration_status`, `execute_refutation`, `finalize_exploration`
- æ ¡æ­£æ—§: `save_calibration_evaluation`, `get_calibration_evaluations`, `get_reliability_diagram_data`, `add_calibration_sample`, `get_calibration_stats`, `rollback_calibration`
- åˆ†æ: `decompose_question`, `compress_with_chain_of_density`
- ãã®ä»–: `schedule_job`

### M.2 æ–°MCPãƒ„ãƒ¼ãƒ«ä¸€è¦§ï¼ˆ11ãƒ„ãƒ¼ãƒ«ï¼‰

#### M.2-1 ã‚¿ã‚¹ã‚¯ç®¡ç†ï¼ˆ2ãƒ„ãƒ¼ãƒ«ï¼‰

| ãƒ„ãƒ¼ãƒ« | æ©Ÿèƒ½ | ä»•æ§˜å‚ç…§ |
|--------|------|---------|
| `create_task` | ã‚¿ã‚¹ã‚¯ä½œæˆ | Â§3.2.1 |
| `get_status` | ã‚¿ã‚¹ã‚¯ãƒ»æ¢ç´¢çŠ¶æ…‹ã®çµ±åˆå–å¾— | Â§3.2.1 |

#### M.2-2 èª¿æŸ»å®Ÿè¡Œï¼ˆ2ãƒ„ãƒ¼ãƒ«ï¼‰

| ãƒ„ãƒ¼ãƒ« | æ©Ÿèƒ½ | ä»•æ§˜å‚ç…§ |
|--------|------|---------|
| `search` | æ¤œç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œï¼ˆåè¨¼ãƒ¢ãƒ¼ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³å«ã‚€ï¼‰ | Â§3.2.1 |
| `stop_task` | ã‚¿ã‚¹ã‚¯çµ‚äº† | Â§3.2.1 |

#### M.2-3 æˆæœç‰©ï¼ˆ1ãƒ„ãƒ¼ãƒ«ï¼‰

| ãƒ„ãƒ¼ãƒ« | æ©Ÿèƒ½ | ä»•æ§˜å‚ç…§ |
|--------|------|---------|
| `get_materials` | ãƒ¬ãƒãƒ¼ãƒˆç´ æãƒ»ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•å–å¾— | Â§3.2.1 |

#### M.2-4 æ ¡æ­£ï¼ˆ2ãƒ„ãƒ¼ãƒ«ï¼‰

| ãƒ„ãƒ¼ãƒ« | æ©Ÿèƒ½ | ä»•æ§˜å‚ç…§ |
|--------|------|---------|
| `calibrate` | æ ¡æ­£æ“ä½œï¼ˆæ—¥å¸¸æ“ä½œ: add_sample/get_stats/evaluate/get_evaluations/get_diagram_dataï¼‰ | Â§3.2.1, Â§4.6.1 |
| `calibrate_rollback` | æ ¡æ­£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆç ´å£Šçš„æ“ä½œã€æ˜ç¤ºçš„åˆ†é›¢ï¼‰ | Â§3.2.1, Â§4.6.1 |

#### M.2-5 èªè¨¼ã‚­ãƒ¥ãƒ¼ï¼ˆ2ãƒ„ãƒ¼ãƒ«ï¼‰

| ãƒ„ãƒ¼ãƒ« | æ©Ÿèƒ½ | ä»•æ§˜å‚ç…§ |
|--------|------|---------|
| `get_auth_queue` | èªè¨¼å¾…ã¡ãƒªã‚¹ãƒˆå–å¾—ï¼ˆgroup_by: none/domain/typeã€priority_filterå¯¾å¿œï¼‰ | Â§3.2.1, Â§3.6.1 |
| `resolve_auth` | èªè¨¼å®Œäº†/ã‚¹ã‚­ãƒƒãƒ—å ±å‘Šï¼ˆtarget: item/domainã€ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€æ‹¬æ“ä½œå¯¾å¿œï¼‰ | Â§3.2.1, Â§3.6.1 |

#### M.2-6 é€šçŸ¥ï¼ˆ2ãƒ„ãƒ¼ãƒ«ï¼‰

| ãƒ„ãƒ¼ãƒ« | æ©Ÿèƒ½ | ä»•æ§˜å‚ç…§ |
|--------|------|---------|
| `notify_user` | ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥ | Â§3.2.1 |
| `wait_for_user` | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å¾…æ©Ÿ | Â§3.2.1 |

### M.3 å®Ÿè£…ã‚¿ã‚¹ã‚¯

#### M.3-1 MCPã‚µãƒ¼ãƒãƒ¼æ”¹ä¿® ğŸ”„ ğŸ”´å„ªå…ˆ

**æ–¹é‡**: å¾Œæ–¹äº’æ›ã¯è¨­ã‘ãšã€æ—§ãƒ„ãƒ¼ãƒ«ã‹ã‚‰æ–°ãƒ„ãƒ¼ãƒ«ã¸å®Œå…¨ç§»è¡Œã™ã‚‹ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| æ—§ãƒ„ãƒ¼ãƒ«å®šç¾©ã®å‰Šé™¤ | `src/mcp/server.py` ã‹ã‚‰29å€‹ã®æ—§ãƒ„ãƒ¼ãƒ«ã‚’å‰Šé™¤ | â³ |
| æ–°ãƒ„ãƒ¼ãƒ«å®šç¾©ã®è¿½åŠ  | `src/mcp/server.py` ã«11å€‹ã®æ–°ãƒ„ãƒ¼ãƒ«ã‚’å®šç¾© | â³ |
| `_handle_get_status` å®Ÿè£… | `get_task_status` + `get_exploration_status` çµ±åˆ | âœ… |
| `_handle_search` å®Ÿè£… | `execute_subquery` + `execute_refutation` çµ±åˆ | â³ |
| `_handle_stop_task` å®Ÿè£… | `finalize_exploration` ç½®æ› | â³ |
| `_handle_get_materials` å®Ÿè£… | `get_report_materials` + `get_evidence_graph` çµ±åˆ | â³ |
| `_handle_calibrate` å®Ÿè£… | æ ¡æ­£ç³»5ãƒ„ãƒ¼ãƒ«çµ±åˆï¼ˆ5 actionå¯¾å¿œï¼‰ | âœ… |
| `_handle_calibrate_rollback` å®Ÿè£… | ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ“ä½œï¼ˆç ´å£Šçš„ã€æ˜ç¤ºåˆ†é›¢ï¼‰ | âœ… |
| `_handle_get_auth_queue` å®Ÿè£… | èªè¨¼å¾…ã¡ç³»ãƒ„ãƒ¼ãƒ«çµ±åˆï¼ˆgroup_byå¯¾å¿œï¼‰ | â³ |
| `_handle_resolve_auth` å®Ÿè£… | èªè¨¼å®Œäº†ç³»ãƒ„ãƒ¼ãƒ«çµ±åˆï¼ˆtargetå¯¾å¿œï¼‰ | â³ |
| `_handle_wait_for_user` å®Ÿè£… | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å¾…æ©Ÿï¼ˆæ–°è¦ï¼‰ | â³ |
| `_handle_notify_user` æ›´æ–° | ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã‚’Â§3.2.1ã«æº–æ‹  | â³ |
| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³»å®Ÿè£… | Â§3.2.1æº–æ‹ ã®9ã‚³ãƒ¼ãƒ‰ï¼ˆ`src/mcp/errors.py`ï¼‰ | âœ… |
| Cursor AIç„¡å¿œç­”ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | Â§2.1.5æº–æ‹ ï¼ˆ300ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆâ†’çŠ¶æ…‹ä¿å­˜â†’å¾…æ©Ÿï¼‰ | â³ |

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/mcp/server.py`: ãƒ„ãƒ¼ãƒ«å®šç¾©ãƒ»ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å…¨é¢æ”¹ä¿®
- `src/mcp/schemas/`: æ–°ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
- `src/mcp/errors.py`: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å®šç¾© âœ…

#### M.3-2 å†…éƒ¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ•´ç† â³

ä½ãƒ¬ãƒ™ãƒ«æ“ä½œã‚’MCPã‹ã‚‰éš è”½ã—ã€å†…éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦æ•´ç†ã™ã‚‹ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| `SearchPipeline` ã‚¯ãƒ©ã‚¹ä½œæˆ | `src/research/pipeline.py` (æ–°è¦) | â³ |
| `search_serp` å†…éƒ¨åŒ– | `src/search/` ç›´æ¥å‘¼ã³å‡ºã—ã¸ | â³ |
| `fetch_url` å†…éƒ¨åŒ– | `src/crawler/` ç›´æ¥å‘¼ã³å‡ºã—ã¸ | â³ |
| `extract_content` å†…éƒ¨åŒ– | `src/extract/` ç›´æ¥å‘¼ã³å‡ºã—ã¸ | â³ |
| `rank_candidates` å†…éƒ¨åŒ– | `src/filter/` ç›´æ¥å‘¼ã³å‡ºã—ã¸ | â³ |
| `llm_extract` å†…éƒ¨åŒ– | `src/filter/` ç›´æ¥å‘¼ã³å‡ºã—ã¸ | â³ |
| `nli_judge` å†…éƒ¨åŒ– | `src/filter/` ç›´æ¥å‘¼ã³å‡ºã—ã¸ | â³ |

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/research/pipeline.py`: æ¤œç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼

```python
# src/research/pipeline.py æ¦‚è¦
class SearchPipeline:
    """Cursor AIã‹ã‚‰ã®`search`å‘¼ã³å‡ºã—ã‚’å‡¦ç†ã™ã‚‹çµ±åˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³"""
    
    async def execute(
        self, 
        task_id: str, 
        query: str, 
        options: SearchOptions
    ) -> SearchResult:
        # 1. search_serp: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã¸ã®ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
        serp_results = await self.search_provider.search(query, options.engines)
        
        # 2. fetch_url: URLå–å¾—ï¼ˆä¸¦åˆ—ï¼‰
        pages = await self.fetcher.fetch_many(serp_results.urls, options.max_pages)
        
        # 3. extract_content: ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
        contents = await self.extractor.extract_many(pages)
        
        # 4. rank_candidates: ãƒ©ãƒ³ã‚­ãƒ³ã‚°
        ranked = await self.ranker.rank(query, contents)
        
        # 5. llm_extract: äº‹å®Ÿ/ä¸»å¼µæŠ½å‡º
        claims = await self.llm_extractor.extract(ranked[:options.top_k])
        
        # 6. nli_judge: åè¨¼ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ã¿
        if options.refute:
            claims = await self.nli_judger.judge(claims)
        
        # 7. çŠ¶æ…‹æ›´æ–°
        await self.state_manager.update(task_id, claims)
        
        return SearchResult(...)
```

#### M.3-3 ã€Œã‚µãƒ–ã‚¯ã‚¨ãƒªã€ç”¨èªã®é™¤å» â³

ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å…¨ä½“ã‹ã‚‰ã€Œsubqueryã€ã€Œã‚µãƒ–ã‚¯ã‚¨ãƒªã€ã®ç”¨èªã‚’é™¤å»ã—ã€ã€Œsearchã€ã€Œã‚¯ã‚¨ãƒªã€ã«çµ±ä¸€ã™ã‚‹ã€‚

| é …ç›® | å®Ÿè£… | çŠ¶æ…‹ |
|------|------|:----:|
| `SubqueryExecutor` â†’ `SearchPipeline` | `src/research/executor.py` å»ƒæ­¢ | â³ |
| `SubqueryState` â†’ `SearchState` | `src/research/state.py` | â³ |
| `ExplorationState.subqueries` â†’ `searches` | åŒä¸Š | â³ |
| DBã‚¹ã‚­ãƒ¼ãƒã® `subquery` åˆ— â†’ `search` | `src/storage/schema.sql` | â³ |
| ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ç”¨èªçµ±ä¸€ | `tests/` å…¨ä½“ | â³ |

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/research/executor.py`: å‰Šé™¤ï¼ˆpipeline.pyã«ç½®æ›ï¼‰
- `src/research/state.py`: ã‚¯ãƒ©ã‚¹åãƒ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åå¤‰æ›´
- `src/storage/schema.sql`: åˆ—åå¤‰æ›´ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¿…è¦ï¼‰
- `tests/test_*.py`: ç”¨èªå¤‰æ›´

#### M.3-4 å»ƒæ­¢ãƒ„ãƒ¼ãƒ«ã®å‰Šé™¤ â³

| é …ç›® | ç†ç”± | çŠ¶æ…‹ |
|------|------|:----:|
| `get_research_context` | Cursor AIãŒç›´æ¥ã‚¯ã‚¨ãƒªè¨­è¨ˆã™ã‚‹ãŸã‚ä¸è¦ | â³ |
| `decompose_question` | Cursor AIãŒæ‹…å½“ã™ã‚‹ãŸã‚ä¸è¦ | â³ |
| `compress_with_chain_of_density` | Cursor AIãŒæ‹…å½“ã™ã‚‹ãŸã‚ä¸è¦ | â³ |
| `schedule_job` | å†…éƒ¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã«éš è”½ | â³ |
| `start_authentication_session` | Â§3.6.1å®‰å…¨é‹ç”¨æ–¹é‡ï¼ˆDOMæ“ä½œç¦æ­¢ï¼‰ã«ã‚ˆã‚Šä¸è¦ | â³ |
| æ ¡æ­£ç³»6ãƒ„ãƒ¼ãƒ« | `calibrate`ã®actionã«çµ±åˆ | â³ |
| èªè¨¼ç³»4ãƒ„ãƒ¼ãƒ« | `get_auth_queue`/`resolve_auth`ã«çµ±åˆ | â³ |
| ä½ãƒ¬ãƒ™ãƒ«6ãƒ„ãƒ¼ãƒ« | `search`ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…éƒ¨ã«éš è”½ | â³ |

### M.4 ç§»è¡Œè¨ˆç”»ï¼ˆå®Œå…¨ç§»è¡Œãƒ»å¾Œæ–¹äº’æ›ãªã—ï¼‰

**æ–¹é‡**: å¾Œæ–¹äº’æ›æœŸé–“ã¯è¨­ã‘ãšã€ä¸€æ‹¬ã§æ–°ãƒ„ãƒ¼ãƒ«ä½“ç³»ã«ç§»è¡Œã™ã‚‹ã€‚

#### Step 1: æ–°ãƒ„ãƒ¼ãƒ«å®Ÿè£…
- 11å€‹ã®æ–°ãƒ„ãƒ¼ãƒ«å®šç¾©ã¨ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…
- å†…éƒ¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆ`SearchPipeline`ï¼‰ã®ä½œæˆ
- ç”¨èªçµ±ä¸€ï¼ˆsubquery â†’ searchï¼‰

#### Step 2: æ—§ãƒ„ãƒ¼ãƒ«å‰Šé™¤
- 29å€‹ã®æ—§ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’`src/mcp/server.py`ã‹ã‚‰å‰Šé™¤
- æ—§ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ï¼ˆå†…éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å†åˆ©ç”¨å¯èƒ½ãªéƒ¨åˆ†ã¯æ®‹ã™ï¼‰
- å¾Œæ–¹äº’æ›ãƒ†ã‚¹ãƒˆï¼ˆ`TestDeprecatedRollbackCalibration`ç­‰ï¼‰ã‚’å‰Šé™¤

#### Step 3: ãƒ†ã‚¹ãƒˆæ•´å‚™
- æ–°ãƒ„ãƒ¼ãƒ«ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
- æ—§ãƒ„ãƒ¼ãƒ«å‚ç…§ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°
- E2Eã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ›´æ–°

### M.5 ãƒ†ã‚¹ãƒˆæ–¹é‡

**åŸå‰‡**: MCPãƒ„ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆã¯ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ã€‚E2Eãƒ†ã‚¹ãƒˆã¯`tests/scripts/`ã«é…ç½®ã—æ‰‹å‹•å®Ÿè¡Œã€‚

#### ãƒ†ã‚¹ãƒˆåˆ†é¡

| ãƒ†ã‚¹ãƒˆç¨®åˆ¥ | ãƒãƒ¼ã‚«ãƒ¼ | å¯¾è±¡ | å®Ÿè¡Œ | çŠ¶æ…‹ |
|-----------|---------|------|------|:----:|
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | `@pytest.mark.unit` | å„ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ï¼ˆ`_handle_*`ï¼‰ | CI | â³ |
| çµ±åˆãƒ†ã‚¹ãƒˆ | `@pytest.mark.integration` | è¤‡æ•°ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é€£æºãƒ»ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ | CI | â³ |
| E2Eã‚¹ã‚¯ãƒªãƒ—ãƒˆ | â€” | å®Ÿç’°å¢ƒã§ã®MCPãƒ„ãƒ¼ãƒ«å‹•ä½œ | æ‰‹å‹• | â³ |

#### ãƒ†ã‚¹ãƒˆå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã‚’ç›´æ¥å‘¼ã³å‡ºã—ã€ä¾å­˜ï¼ˆDBã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã¯ãƒ¢ãƒƒã‚¯ã§æ³¨å…¥ã™ã‚‹ï¼š

```python
@pytest.mark.asyncio
async def test_calibrate_add_sample(mock_calibrator):
    """
    TC-N-01: calibrate with action="add_sample"
    
    // Given: Valid sample data
    // When: Calling calibrate with action="add_sample"
    // Then: Sample is added and pending_count returned
    """
    from src.mcp.server import _handle_calibrate
    
    with patch("src.utils.calibration.get_calibrator", return_value=mock_calibrator):
        result = await _handle_calibrate({
            "action": "add_sample",
            "data": {"source": "llm_extract", "prediction": 0.8, "actual": 1}
        })
    
    assert result["ok"] is True
    assert "sample_id" in result
```

#### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | å¯¾è±¡ãƒ„ãƒ¼ãƒ« | çŠ¶æ…‹ |
|---------|-----------|:----:|
| `tests/test_mcp_errors.py` | ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³» | âœ… |
| `tests/test_calibrate_rollback.py` | `calibrate_rollback` | âœ… |
| `tests/test_mcp_get_status.py` | `get_status` | âœ… |
| `tests/test_mcp_calibrate.py` | `calibrate`ï¼ˆ5 actionï¼‰ | âœ… |
| `tests/test_mcp_task.py` | `create_task`, `stop_task` | â³ |
| `tests/test_mcp_search.py` | `search`, `get_materials` | â³ |
| `tests/test_mcp_auth.py` | `get_auth_queue`, `resolve_auth` | â³ |
| `tests/test_mcp_notification.py` | `notify_user`, `wait_for_user` | â³ |
| `tests/test_search_pipeline.py` | `SearchPipeline`ï¼ˆå†…éƒ¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰ | â³ |
| `tests/scripts/verify_mcp_tools.py` | E2Eæ¤œè¨¼ | ğŸ”„ æ›´æ–°å¿…è¦ |

#### å‰Šé™¤å¯¾è±¡ãƒ†ã‚¹ãƒˆ âœ…

å¾Œæ–¹äº’æ›ãƒ†ã‚¹ãƒˆã¯ä¸è¦ã®ãŸã‚å‰Šé™¤æ¸ˆã¿ï¼š
- ~~`tests/test_calibrate_rollback.py`: `TestDeprecatedRollbackCalibration` ã‚¯ãƒ©ã‚¹~~ âœ…
- ~~`tests/test_calibrate_rollback.py`: `test_deprecated_rollback_calibration_marked` ãƒ†ã‚¹ãƒˆ~~ âœ…

### M.6 Phase Kã¨ã®é–¢é€£

Phase Kï¼ˆãƒ­ãƒ¼ã‚«ãƒ«LLMå¼·åŒ–ï¼‰ã®ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã¯Phase Mã®æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åˆã‚ã›ã¦æ›´æ–°ãŒå¿…è¦ï¼š

| Phase K ã‚¿ã‚¹ã‚¯ | æ›´æ–°å†…å®¹ |
|---------------|---------|
| K.3-5 MCPå¿œç­”ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆL5ï¼‰ | æ–°ãƒ„ãƒ¼ãƒ«ï¼ˆ`search`, `get_status`ç­‰ï¼‰ã«é©ç”¨ |
| K.3-9 MCPå¿œç­”ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆL7ï¼‰ | æ–°ã‚¹ã‚­ãƒ¼ãƒã«åˆã‚ã›ã¦ã‚¹ã‚­ãƒ¼ãƒå®šç¾©æ›´æ–° |
| K.3-6 ã‚½ãƒ¼ã‚¹æ¤œè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆL6ï¼‰ | `search`å¿œç­”ã«verification_statusã‚’å«ã‚ã‚‹ |

---

## Phase N: E2Eã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼ˆè«–æ–‡æŠ•ç¨¿å‘ã‘ï¼‰â³

è«–æ–‡æŠ•ç¨¿ã«å¿…è¦ãªã€Œå‹•ãã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€ã®å®Ÿè¨¼ã€‚çµ±åˆå‹•ä½œç¢ºèªã¨ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ã®å®Ÿæ–½ãƒ»è¨˜éŒ²ã€‚

### N.1 ç›®çš„

| è¦³ç‚¹ | ç›®çš„ |
|------|------|
| çµ±åˆå‹•ä½œç¢ºèª | Phase A-Hã®æˆæœãŒé€£çµã—ã¦å‹•ä½œã™ã‚‹ã“ã¨ã®å®Ÿè¨¼ |
| ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ | è«–æ–‡ã«è¨˜è¼‰ã™ã‚‹å…·ä½“çš„ãªä½¿ç”¨ä¾‹ã®ä½œæˆ |
| OSSä¾¡å€¤ã®å®Ÿè¨¼ | é€æ˜æ€§ãƒ»ç›£æŸ»å¯èƒ½æ€§ãƒ»å†ç¾æ€§ã®ç¢ºä¿ |

### N.2 ã‚·ãƒŠãƒªã‚ªè¨­è¨ˆ

| ID | ã‚·ãƒŠãƒªã‚ª | å¯¾è±¡ | æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ |
|----|---------|------|-------------|
| CS-1 | åŒ»è–¬å“å®‰å…¨æ€§æƒ…å ±åé›† | FDA/PMDA/EMAæ¨ªæ–­ | è¤‡æ•°ã‚½ãƒ¼ã‚¹çµ±åˆã€ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•æ§‹ç¯‰ |
| CS-2 | è¦åˆ¶å¤‰æ›´è¿½è·¡ï¼ˆä»»æ„ï¼‰ | æ·»ä»˜æ–‡æ›¸å¤‰æ›´å±¥æ­´ | æ™‚ç³»åˆ—æƒ…å ±åé›†ã€Waybacké€£æº |

**ã‚·ãƒŠãƒªã‚ªè©³ç´°ï¼ˆCS-1ï¼‰**:
- å¯¾è±¡: ãƒªãƒ©ã‚°ãƒ«ãƒãƒ‰ï¼ˆLiraglutideï¼‰ã®å®‰å…¨æ€§æƒ…å ±
- ã‚¯ã‚¨ãƒªä¾‹: "liraglutide FDA safety alert", "ãƒªãƒ©ã‚°ãƒ«ãƒãƒ‰ PMDA å®‰å…¨æ€§é€Ÿå ±"
- æœŸå¾…æˆæœ: FDA/PMDA/EMAã‹ã‚‰ã®å®‰å…¨æ€§æƒ…å ±ã‚’åé›†ã—ã€ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•ã§é–¢ä¿‚æ€§ã‚’å¯è¦–åŒ–

### N.3 æˆåŠŸåŸºæº–

| åŸºæº– | é–¾å€¤ | æ¸¬å®šæ–¹æ³• |
|------|------|---------|
| ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œèµ° | å…¨ã‚¹ãƒ†ãƒƒãƒ—æˆåŠŸ | ãƒ­ã‚°ã®cause_idé€£çµç¢ºèª |
| ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•æ§‹ç¯‰ | â‰¥5ä»¶ã®ä¸»å¼µ-æ–­ç‰‡-ã‚½ãƒ¼ã‚¹é–¢ä¿‚ | `get_materials`ã®è¿”å´å€¤ |
| æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å¤šæ§˜åŒ– | â‰¥3ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‚‰çµæœå–å¾— | æ¤œç´¢ãƒ­ã‚° |
| ã‚¨ãƒ©ãƒ¼ãªã—å®Œäº† | æœªå‡¦ç†ä¾‹å¤–ã‚¼ãƒ­ | ãƒ­ã‚°ç¢ºèª |

### N.4 è¨˜éŒ²é …ç›®

| é …ç›® | å½¢å¼ | ç”¨é€” |
|------|------|------|
| å®Ÿè¡Œãƒ­ã‚° | JSONL | å†ç¾æ€§ã€å› æœãƒˆãƒ¬ãƒ¼ã‚¹ |
| ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ | PNG | è«–æ–‡å›³è¡¨ã€ãƒ‡ãƒ¢ |
| ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ• | JSON/GraphML | è«–æ–‡å›³è¡¨ |
| å®Ÿè¡Œæ™‚é–“ãƒ»ãƒªã‚½ãƒ¼ã‚¹ | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | æ€§èƒ½è©•ä¾¡ |
| WARC/PDF | ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– | ç›£æŸ»å¯èƒ½æ€§ã®å®Ÿè¨¼ |

### N.5 å®Ÿæ–½æ‰‹é †

```
1. ç’°å¢ƒæº–å‚™
   - ./scripts/dev.sh up
   - Chrome ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰èµ·å‹•
   - Ollama ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰ç¢ºèª

2. ã‚¿ã‚¹ã‚¯ä½œæˆ
   - Cursor AI: create_task("ãƒªãƒ©ã‚°ãƒ«ãƒãƒ‰ã®å®‰å…¨æ€§æƒ…å ±èª¿æŸ»")

3. æ¤œç´¢ã‚¯ã‚¨ãƒªè¨­è¨ˆãƒ»å®Ÿè¡Œï¼ˆCursor AIä¸»å°ï¼‰
   - search(task_id, "liraglutide FDA safety alert")
   - search(task_id, "ãƒªãƒ©ã‚°ãƒ«ãƒãƒ‰ PMDA å®‰å…¨æ€§é€Ÿå ±")
   - get_status(task_id) ã§é€²æ—ç¢ºèª

4. è¿½åŠ ã‚¯ã‚¨ãƒªãƒ»åè¨¼æ¢ç´¢
   - search(task_id, "liraglutide adverse events", refute=true)

5. æˆæœç‰©å–å¾—
   - get_materials(task_id)
   - ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã‚°ãƒ©ãƒ•ã®å¯è¦–åŒ–

6. è¨˜éŒ²æ•´ç†
   - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¿å­˜
   - ãƒ­ã‚°æŠ½å‡ºãƒ»æ•´å½¢
   - å›³è¡¨ä½œæˆ
```

### N.6 ã‚¿ã‚¹ã‚¯

| é …ç›® | çŠ¶æ…‹ |
|------|:----:|
| CS-1ã‚·ãƒŠãƒªã‚ªè¨­è¨ˆæ›¸ä½œæˆ | â³ |
| E2Eå®Ÿè¡Œç’°å¢ƒç¢ºèª | â³ |
| CS-1å®Ÿæ–½ãƒ»è¨˜éŒ² | â³ |
| CS-2ã‚·ãƒŠãƒªã‚ªè¨­è¨ˆï¼ˆä»»æ„ï¼‰ | â³ |
| è«–æ–‡å‘ã‘å›³è¡¨ä½œæˆ | â³ |

### N.7 OSSä¾¡å€¤ã®å®Ÿè¨¼ãƒã‚¤ãƒ³ãƒˆ

è«–æ–‡ã§å¼·èª¿ã™ã¹ãã€ŒOSS + ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµã€ã®ä¾¡å€¤:

| ä¾¡å€¤ | å®Ÿè¨¼æ–¹æ³• |
|------|---------|
| **é€æ˜æ€§** | å…¨ã‚³ãƒ¼ãƒ‰ãŒGitHubã§å…¬é–‹ã€ç›£æŸ»å¯èƒ½ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | æ¤œç´¢ã‚¯ã‚¨ãƒªãƒ»åé›†æƒ…å ±ãŒå¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãªã„ |
| **å†ç¾æ€§** | åŒä¸€ç’°å¢ƒã§åŒä¸€çµæœãŒå¾—ã‚‰ã‚Œã‚‹ |
| **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§** | ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ãƒ»æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³è¨­å®šãŒå¤‰æ›´å¯èƒ½ |

**å•†ç”¨ãƒ„ãƒ¼ãƒ«ã¨ã®å·®åˆ¥åŒ–**:
- Perplexity/ChatGPT: ã‚¯ã‚¨ãƒªãŒã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã‚‹
- Google Deep Research: åé›†æƒ…å ±ãŒGoogleã«è“„ç©ã•ã‚Œã‚‹
- Lancet: **ã™ã¹ã¦ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµã€ãƒ­ã‚°ã¯æ‰‹å…ƒã«ã®ã¿å­˜åœ¨**

---

## é–‹ç™ºç’°å¢ƒ

### èµ·å‹•æ–¹æ³•

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
./scripts/dev.sh up

# é–‹ç™ºã‚·ã‚§ãƒ«
./scripts/dev.sh shell

# ãƒ­ã‚°ç¢ºèª
./scripts/dev.sh logs

# åœæ­¢
./scripts/dev.sh down
```

### ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆ

- `lancet` - ãƒ¡ã‚¤ãƒ³é–‹ç™ºã‚³ãƒ³ãƒ†ãƒŠ
- `lancet-tor` - Torãƒ—ãƒ­ã‚­ã‚·
- `lancet-ollama` - ãƒ­ãƒ¼ã‚«ãƒ«LLM (GPUå¯¾å¿œ)

**æ³¨æ„**: SearXNGã¯å»ƒæ­¢æ¸ˆã¿ï¼ˆPhase Cå‚ç…§ï¼‰

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆdevã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œï¼‰
podman exec lancet pytest tests/

# ç°¡æ½”ãªå‡ºåŠ›
podman exec lancet pytest tests/ --tb=no -q

# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿
podman exec lancet pytest tests/test_robots.py -v
```

### E2Eæ¤œè¨¼ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆWSL2â†’Windows Chromeï¼‰

1. **å°‚ç”¨Chromeãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**ï¼ˆGoogleã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœªãƒ­ã‚°ã‚¤ãƒ³æ¨å¥¨ï¼‰

2. **ã™ã¹ã¦ã®Chromeã‚’å®Œå…¨çµ‚äº†**
   ```powershell
   Stop-Process -Name chrome -Force -ErrorAction SilentlyContinue
   ```

3. **Chromeã‚’ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•**
   ```powershell
   & "C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222 "--user-data-dir=C:\Users\<USERNAME>\AppData\Local\Google\Chrome\User Data" --profile-directory=Profile-Research
   ```

4. **ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¨­å®š**ï¼ˆåˆå›ã®ã¿ã€ç®¡ç†è€…PowerShellï¼‰
   ```powershell
   netsh interface portproxy add v4tov4 listenaddress=<WSL2_GATEWAY_IP> listenport=9222 connectaddress=127.0.0.1 connectport=9222
   New-NetFirewallRule -DisplayName "Chrome Debug WSL2" -Direction Inbound -LocalPort 9222 -Protocol TCP -Action Allow
   ```

5. **ç’°å¢ƒå¤‰æ•°è¨­å®š**ï¼ˆ`.env`ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
   ```bash
   echo "LANCET_BROWSER__CHROME_HOST=<WSL2_GATEWAY_IP>" >> .env
   ```

6. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
   ```bash
   podman exec lancet python tests/scripts/verify_duckduckgo_search.py
   ```

### å¤–éƒ¨ä¾å­˜

- Ollama (Podmanã‚³ãƒ³ãƒ†ãƒŠã§èµ·å‹•ã€GPUãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼)
- Chrome (Windowså´ã§èµ·å‹•ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°)
- nvidia-container-toolkit (GPUä½¿ç”¨æ™‚ã«å¿…è¦)

---

## æ³¨æ„äº‹é …

### æŠ€è¡“çš„åˆ¶ç´„

- VRAMâ‰¤8GBç¶­æŒï¼ˆRTX 4060 Laptopï¼‰
- WSL2ãƒ¡ãƒ¢ãƒª32GBå†…ã§å‹•ä½œ
- å•†ç”¨API/æœ‰æ–™ã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨ç¦æ­¢

### ãƒªã‚¹ã‚¯è»½æ¸›

- Cloudflare/Turnstile: æ‰‹å‹•èª˜å°UXï¼‹ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³/ã‚¹ã‚­ãƒƒãƒ—è‡ªå‹•åŒ–
- VRAMåœ§è¿«: ãƒã‚¤ã‚¯ãƒ­ãƒãƒƒãƒ/å€™è£œä¸Šé™è‡ªå‹•èª¿æ•´

---
