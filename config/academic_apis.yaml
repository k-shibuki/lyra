# Academic API Configuration for Lyra
# See docs/J2_ACADEMIC_API_INTEGRATION.md §8.1
# Rate limiting per ADR-0013: Worker Resource Contention Control

apis:
  semantic_scholar:
    enabled: true
    base_url: "https://api.semanticscholar.org/graph/v1"
    rate_limit:
      # API limit: 100 requests per 5 minutes = 0.33 req/s
      requests_per_interval: 100
      interval_seconds: 300  # 5 minutes
      # Conservative rate control for cross-API queries + 2 workers
      # Safety calculation: 0.33 req/s / 3 (cross-API multiplier) = 0.11 req/s
      # With margin: 0.1 req/s → 10 seconds interval
      # Compromise: 6 seconds (0.17 req/s) for reasonable throughput
      min_interval_seconds: 6.0  # ~0.17 req/s (50% margin)
      max_parallel: 1  # Global cap: only 1 S2 request at a time across all workers
    timeout_seconds: 30
    priority: 1  # Highest priority (best citation graph coverage)

  openalex:
    enabled: true
    base_url: "https://api.openalex.org"
    rate_limit:
      # OpenAlex polite pool: 10 req/s for identified users
      requests_per_day: 100000
      min_interval_seconds: 0.1  # 10 req/s
      max_parallel: 2  # More lenient than S2
    timeout_seconds: 30
    priority: 2
    headers:
      User-Agent: "Lyra/1.0 (research tool; mailto:lyra@example.com)"

# Default settings
defaults:
  search_apis: ["semantic_scholar", "openalex"]
  citation_graph_api: "semantic_scholar"
  max_citation_depth: 2
  max_papers_per_search: 50
