# Academic API Configuration for Lyra
# See docs/J2_ACADEMIC_API_INTEGRATION.md §8.1
# Rate limiting per ADR-0013: Worker Resource Contention Control
#
# ============================================================================
# AUTHENTICATION / RATE LIMIT IMPROVEMENTS
# ============================================================================
# Configure these in .env (not here) for better rate limits:
#
# Semantic Scholar:
#   LYRA_ACADEMIC_APIS__APIS__SEMANTIC_SCHOLAR__API_KEY=your_api_key
#   LYRA_ACADEMIC_APIS__APIS__SEMANTIC_SCHOLAR__EMAIL=your_email@example.com
#   -> Get free API key at: https://www.semanticscholar.org/product/api
#   -> Benefits: Authenticated access with dedicated rate limits
#
# OpenAlex:
#   LYRA_ACADEMIC_APIS__APIS__OPENALEX__EMAIL=your_email@example.com
#   -> Benefits: "Polite pool" with 10 req/s (vs ~1 req/s anonymous)
#   -> The email is sent as `mailto` query parameter on all requests
#
# Without these settings, the system still works with default rate limits.
# ============================================================================

apis:
  semantic_scholar:
    enabled: true
    base_url: "https://api.semanticscholar.org/graph/v1"
    rate_limit:
      # Official rate limits (https://www.semanticscholar.org/product/api):
      #   - With API key: 1 req/s dedicated (guaranteed)
      #   - Without key: 1000 req/s shared globally across ALL anonymous users
      #     → Effectively unstable during busy periods; key is strongly recommended
      #
      # Lyra uses min_interval_seconds for actual rate control:
      #   2.0s = 0.5 req/s (conservative, well under 1 req/s limit)
      #   This allows headroom for retries and burst absorption.
      min_interval_seconds: 2.0
      max_parallel: 1  # Only 1 S2 request at a time across all workers
    timeout_seconds: 30
    priority: 1  # Highest priority (best citation graph coverage)
    # api_key: Set via LYRA_ACADEMIC_APIS__APIS__SEMANTIC_SCHOLAR__API_KEY in .env
    # email: Set via LYRA_ACADEMIC_APIS__APIS__SEMANTIC_SCHOLAR__EMAIL in .env

  openalex:
    enabled: true
    base_url: "https://api.openalex.org"
    rate_limit:
      # Official rate limits (https://docs.openalex.org/how-to-use-the-api/rate-limits-and-authentication):
      #   - Anonymous: 10 req/s, 100,000 req/day
      #   - Polite pool (with mailto): same limits, but prioritized and more stable
      #
      # Lyra uses min_interval_seconds for actual rate control:
      #   0.2s = 5 req/s (conservative, well under 10 req/s limit)
      #   This allows headroom for retries and 2-worker scenarios.
      min_interval_seconds: 0.2
      max_parallel: 2  # 2 concurrent requests allowed
    timeout_seconds: 30
    priority: 2
    # email: Set via LYRA_ACADEMIC_APIS__APIS__OPENALEX__EMAIL in .env
    # Note: User-Agent is auto-generated with mailto if email is configured

# Default settings
defaults:
  search_apis: ["semantic_scholar", "openalex"]
  citation_graph_api: "semantic_scholar"
  max_citation_depth: 2
  max_papers_per_search: 100
